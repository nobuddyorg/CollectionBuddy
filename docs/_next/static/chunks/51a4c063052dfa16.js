(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67423,(e,r,n)=>{"use strict";function i({widthInt:e,heightInt:r,blurWidth:n,blurHeight:i,blurDataURL:a,objectFit:l}){let o=n?40*n:e,s=i?40*i:r,u=o&&s?`viewBox='0 0 ${o} ${s}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${u}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${u?"none":"contain"===l?"xMidYMid":"cover"===l?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${a}'/%3E%3C/svg%3E`}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getImageBlurSvg",{enumerable:!0,get:function(){return i}})},87690,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={VALID_LOADERS:function(){return l},imageConfigDefault:function(){return o}};for(var a in i)Object.defineProperty(n,a,{enumerable:!0,get:i[a]});let l=["default","imgix","cloudinary","akamai","custom"],o={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},8927,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getImgProps",{enumerable:!0,get:function(){return u}}),e.r(33525);let i=e.r(67423),a=e.r(87690),l=["-moz-initial","fill","none","scale-down",void 0];function o(e){return void 0!==e.default}function s(e){return void 0===e?e:"number"==typeof e?Number.isFinite(e)?e:NaN:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function u({src:e,sizes:r,unoptimized:n=!1,priority:u=!1,preload:c=!1,loading:f,className:d,quality:h,width:m,height:p,fill:g=!1,style:b,overrideSrc:y,onLoad:w,onLoadingComplete:x,placeholder:v="empty",blurDataURL:A,fetchPriority:_,decoding:j="async",layout:C,objectFit:k,objectPosition:E,lazyBoundary:U,lazyRoot:S,...F},N){var I;let T,M,P,{imgConf:R,showAltText:O,blurComplete:B,defaultLoader:L}=N,D=R||a.imageConfigDefault;if("allSizes"in D)T=D;else{let e=[...D.deviceSizes,...D.imageSizes].sort((e,r)=>e-r),r=D.deviceSizes.sort((e,r)=>e-r),n=D.qualities?.sort((e,r)=>e-r);T={...D,allSizes:e,deviceSizes:r,qualities:n}}if(void 0===L)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let z=F.loader||L;delete F.loader,delete F.srcSet;let Q="__next_img_default"in z;if(Q){if("custom"===T.loader)throw Object.defineProperty(Error(`Image with src "${e}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let e=z;z=r=>{let{config:n,...i}=r;return e(i)}}if(C){"fill"===C&&(g=!0);let e={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[C];e&&(b={...b,...e});let n={responsive:"100vw",fill:"100vw"}[C];n&&!r&&(r=n)}let $="",W=s(m),q=s(p);if((I=e)&&"object"==typeof I&&(o(I)||void 0!==I.src)){let r=o(e)?e.default:e;if(!r.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(r)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!r.height||!r.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(r)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(M=r.blurWidth,P=r.blurHeight,A=A||r.blurDataURL,$=r.src,!g)if(W||q){if(W&&!q){let e=W/r.width;q=Math.round(r.height*e)}else if(!W&&q){let e=q/r.height;W=Math.round(r.width*e)}}else W=r.width,q=r.height}let H=!u&&!c&&("lazy"===f||void 0===f);(!(e="string"==typeof e?e:$)||e.startsWith("data:")||e.startsWith("blob:"))&&(n=!0,H=!1),T.unoptimized&&(n=!0),Q&&!T.dangerouslyAllowSVG&&e.split("?",1)[0].endsWith(".svg")&&(n=!0);let G=s(h),K=Object.assign(g?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:k,objectPosition:E}:{},O?{}:{color:"transparent"},b),V=B||"empty"===v?null:"blur"===v?`url("data:image/svg+xml;charset=utf-8,${(0,i.getImageBlurSvg)({widthInt:W,heightInt:q,blurWidth:M,blurHeight:P,blurDataURL:A||"",objectFit:K.objectFit})}")`:`url("${v}")`,X=l.includes(K.objectFit)?"fill"===K.objectFit?"100% 100%":"cover":K.objectFit,Y=V?{backgroundSize:X,backgroundPosition:K.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:V}:{},Z=function({config:e,src:r,unoptimized:n,width:i,quality:a,sizes:l,loader:o}){if(n)return{src:r,srcSet:void 0,sizes:void 0};let{widths:s,kind:u}=function({deviceSizes:e,allSizes:r},n,i){if(i){let n=/(^|\s)(1?\d?\d)vw/g,a=[];for(let e;e=n.exec(i);)a.push(parseInt(e[2]));if(a.length){let n=.01*Math.min(...a);return{widths:r.filter(r=>r>=e[0]*n),kind:"w"}}return{widths:r,kind:"w"}}return"number"!=typeof n?{widths:e,kind:"w"}:{widths:[...new Set([n,2*n].map(e=>r.find(r=>r>=e)||r[r.length-1]))],kind:"x"}}(e,i,l),c=s.length-1;return{sizes:l||"w"!==u?l:"100vw",srcSet:s.map((n,i)=>`${o({config:e,src:r,quality:a,width:n})} ${"w"===u?n:i+1}${u}`).join(", "),src:o({config:e,src:r,quality:a,width:s[c]})}}({config:T,src:e,unoptimized:n,width:W,quality:G,sizes:r,loader:z}),J=H?"lazy":f;return{props:{...F,loading:J,fetchPriority:_,width:W,height:q,decoding:j,className:d,style:{...K,...Y},sizes:Z.sizes,srcSet:Z.srcSet,src:y||Z.src},meta:{unoptimized:n,preload:c||u,placeholder:v,fill:g}}}},98879,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return s}});let i=e.r(71645),a="undefined"==typeof window,l=a?()=>{}:i.useLayoutEffect,o=a?()=>{}:i.useEffect;function s(e){let{headManager:r,reduceComponentsToState:n}=e;function s(){if(r&&r.mountedInstances){let e=i.Children.toArray(Array.from(r.mountedInstances).filter(Boolean));r.updateHead(n(e))}}return a&&(r?.mountedInstances?.add(e.children),s()),l(()=>(r?.mountedInstances?.add(e.children),()=>{r?.mountedInstances?.delete(e.children)})),l(()=>(r&&(r._pendingUpdate=s),()=>{r&&(r._pendingUpdate=s)})),o(()=>(r&&r._pendingUpdate&&(r._pendingUpdate(),r._pendingUpdate=null),()=>{r&&r._pendingUpdate&&(r._pendingUpdate(),r._pendingUpdate=null)})),null}},25633,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={default:function(){return g},defaultHead:function(){return d}};for(var a in i)Object.defineProperty(n,a,{enumerable:!0,get:i[a]});let l=e.r(55682),o=e.r(90809),s=e.r(43476),u=o._(e.r(71645)),c=l._(e.r(98879)),f=e.r(42732);function d(){return[(0,s.jsx)("meta",{charSet:"utf-8"},"charset"),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function h(e,r){return"string"==typeof r||"number"==typeof r?e:r.type===u.default.Fragment?e.concat(u.default.Children.toArray(r.props.children).reduce((e,r)=>"string"==typeof r||"number"==typeof r?e:e.concat(r),[])):e.concat(r)}e.r(33525);let m=["name","httpEquiv","charSet","itemProp"];function p(e){let r,n,i,a;return e.reduce(h,[]).reverse().concat(d().reverse()).filter((r=new Set,n=new Set,i=new Set,a={},e=>{let l=!0,o=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){o=!0;let n=e.key.slice(e.key.indexOf("$")+1);r.has(n)?l=!1:r.add(n)}switch(e.type){case"title":case"base":n.has(e.type)?l=!1:n.add(e.type);break;case"meta":for(let r=0,n=m.length;r<n;r++){let n=m[r];if(e.props.hasOwnProperty(n))if("charSet"===n)i.has(n)?l=!1:i.add(n);else{let r=e.props[n],i=a[n]||new Set;("name"!==n||!o)&&i.has(r)?l=!1:(i.add(r),a[n]=i)}}}return l})).reverse().map((e,r)=>{let n=e.key||r;return u.default.cloneElement(e,{key:n})})}let g=function({children:e}){let r=(0,u.useContext)(f.HeadManagerContext);return(0,s.jsx)(c.default,{reduceComponentsToState:p,headManager:r,children:e})};("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),r.exports=n.default)},18556,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ImageConfigContext",{enumerable:!0,get:function(){return l}});let i=e.r(55682)._(e.r(71645)),a=e.r(87690),l=i.default.createContext(a.imageConfigDefault)},65856,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"RouterContext",{enumerable:!0,get:function(){return i}});let i=e.r(55682)._(e.r(71645)).default.createContext(null)},70965,(e,r,n)=>{"use strict";function i(e,r){let n=e||75;return r?.qualities?.length?r.qualities.reduce((e,r)=>Math.abs(r-n)<Math.abs(e-n)?r:e,0):n}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"findClosestQuality",{enumerable:!0,get:function(){return i}})},1948,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return l}});let i=e.r(70965);function a({config:e,src:r,width:n,quality:a}){if(r.startsWith("/")&&r.includes("?")&&e.localPatterns?.length===1&&"**"===e.localPatterns[0].pathname&&""===e.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${r}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let l=(0,i.findClosestQuality)(a,e);return`${e.path}?url=${encodeURIComponent(r)}&w=${n}&q=${l}${r.startsWith("/_next/static/media/"),""}`}a.__next_img_default=!0;let l=a},18581,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"useMergedRef",{enumerable:!0,get:function(){return a}});let i=e.r(71645);function a(e,r){let n=(0,i.useRef)(null),a=(0,i.useRef)(null);return(0,i.useCallback)(i=>{if(null===i){let e=n.current;e&&(n.current=null,e());let r=a.current;r&&(a.current=null,r())}else e&&(n.current=l(e,i)),r&&(a.current=l(r,i))},[e,r])}function l(e,r){if("function"!=typeof e)return e.current=r,()=>{e.current=null};{let n=e(r);return"function"==typeof n?n:()=>e(null)}}("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),r.exports=n.default)},5500,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"Image",{enumerable:!0,get:function(){return v}});let i=e.r(55682),a=e.r(90809),l=e.r(43476),o=a._(e.r(71645)),s=i._(e.r(74080)),u=i._(e.r(25633)),c=e.r(8927),f=e.r(87690),d=e.r(18556);e.r(33525);let h=e.r(65856),m=i._(e.r(1948)),p=e.r(18581),g={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/CollectionBuddy/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0};function b(e,r,n,i,a,l,o){let s=e?.src;e&&e["data-loaded-src"]!==s&&(e["data-loaded-src"]=s,("decode"in e?e.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(e.parentElement&&e.isConnected){if("empty"!==r&&a(!0),n?.current){let r=new Event("load");Object.defineProperty(r,"target",{writable:!1,value:e});let i=!1,a=!1;n.current({...r,nativeEvent:r,currentTarget:e,target:e,isDefaultPrevented:()=>i,isPropagationStopped:()=>a,persist:()=>{},preventDefault:()=>{i=!0,r.preventDefault()},stopPropagation:()=>{a=!0,r.stopPropagation()}})}i?.current&&i.current(e)}}))}function y(e){return o.use?{fetchPriority:e}:{fetchpriority:e}}"undefined"==typeof window&&(globalThis.__NEXT_IMAGE_IMPORTED=!0);let w=(0,o.forwardRef)(({src:e,srcSet:r,sizes:n,height:i,width:a,decoding:s,className:u,style:c,fetchPriority:f,placeholder:d,loading:h,unoptimized:m,fill:g,onLoadRef:w,onLoadingCompleteRef:x,setBlurComplete:v,setShowAltText:A,sizesInput:_,onLoad:j,onError:C,...k},E)=>{let U=(0,o.useCallback)(e=>{e&&(C&&(e.src=e.src),e.complete&&b(e,d,w,x,v,m,_))},[e,d,w,x,v,C,m,_]),S=(0,p.useMergedRef)(E,U);return(0,l.jsx)("img",{...k,...y(f),loading:h,width:a,height:i,decoding:s,"data-nimg":g?"fill":"1",className:u,style:c,sizes:n,srcSet:r,src:e,ref:S,onLoad:e=>{b(e.currentTarget,d,w,x,v,m,_)},onError:e=>{A(!0),"empty"!==d&&v(!0),C&&C(e)}})});function x({isAppRouter:e,imgAttributes:r}){let n={as:"image",imageSrcSet:r.srcSet,imageSizes:r.sizes,crossOrigin:r.crossOrigin,referrerPolicy:r.referrerPolicy,...y(r.fetchPriority)};return e&&s.default.preload?(s.default.preload(r.src,n),null):(0,l.jsx)(u.default,{children:(0,l.jsx)("link",{rel:"preload",href:r.srcSet?void 0:r.src,...n},"__nimg-"+r.src+r.srcSet+r.sizes)})}let v=(0,o.forwardRef)((e,r)=>{let n=(0,o.useContext)(h.RouterContext),i=(0,o.useContext)(d.ImageConfigContext),a=(0,o.useMemo)(()=>{let e=g||i||f.imageConfigDefault,r=[...e.deviceSizes,...e.imageSizes].sort((e,r)=>e-r),n=e.deviceSizes.sort((e,r)=>e-r),a=e.qualities?.sort((e,r)=>e-r);return{...e,allSizes:r,deviceSizes:n,qualities:a,localPatterns:"undefined"==typeof window?i?.localPatterns:e.localPatterns}},[i]),{onLoad:s,onLoadingComplete:u}=e,p=(0,o.useRef)(s);(0,o.useEffect)(()=>{p.current=s},[s]);let b=(0,o.useRef)(u);(0,o.useEffect)(()=>{b.current=u},[u]);let[y,v]=(0,o.useState)(!1),[A,_]=(0,o.useState)(!1),{props:j,meta:C}=(0,c.getImgProps)(e,{defaultLoader:m.default,imgConf:a,blurComplete:y,showAltText:A});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(w,{...j,unoptimized:C.unoptimized,placeholder:C.placeholder,fill:C.fill,onLoadRef:p,onLoadingCompleteRef:b,setBlurComplete:v,setShowAltText:_,sizesInput:e.sizes,ref:r}),C.preload?(0,l.jsx)(x,{isAppRouter:!n,imgAttributes:j}):null]})});("function"==typeof n.default||"object"==typeof n.default&&null!==n.default)&&void 0===n.default.__esModule&&(Object.defineProperty(n.default,"__esModule",{value:!0}),Object.assign(n.default,n),r.exports=n.default)},94909,(e,r,n)=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={default:function(){return f},getImageProps:function(){return c}};for(var a in i)Object.defineProperty(n,a,{enumerable:!0,get:i[a]});let l=e.r(55682),o=e.r(8927),s=e.r(5500),u=l._(e.r(1948));function c(e){let{props:r}=(0,o.getImgProps)(e,{defaultLoader:u.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/CollectionBuddy/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(r))void 0===n&&delete r[e];return{props:r}}let f=s.Image},57688,(e,r,n)=>{r.exports=e.r(94909)},52683,e=>{"use strict";let r;var n,i,a,l,o=e.i(43476),s=e.i(71645),u=e.i(18566),c=e.i(55890),f=e.i(84407);function d({onClick:e,disabled:r,isCreating:n,label:i}){return(0,o.jsx)("button",{onClick:e,disabled:r,className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:i,children:n?(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):"+"})}function h({onClick:e,label:r}){return(0,o.jsx)("button",{onClick:e,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110",title:r,children:(0,o.jsx)(f.default,{icon:f.IconType.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}function m({onClick:e,disabled:r,label:n}){return(0,o.jsx)("button",{onClick:e,disabled:r,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-red-500 text-white hover:bg-red-600 disabled:opacity-50",title:n,children:(0,o.jsx)(f.default,{icon:f.IconType.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function p({onClick:e,label:r}){return(0,o.jsx)("button",{onClick:e,className:"rounded-xl w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r,title:r,children:(0,o.jsx)(f.default,{icon:f.IconType.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function g({title:e,name:r}){return(0,o.jsxs)("div",{className:"truncate",children:[(0,o.jsx)("h2",{className:"text-base font-semibold mb-1",children:e}),(0,o.jsx)("div",{className:"font-medium truncate",children:r})]})}function b({selectedCat:e,onSelect:r,sortedCats:n,isLoading:i,t:a,setExpanded:l}){return(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsxs)("select",{value:e??"",onChange:e=>{let n=e.target.value||null;r(n),n&&l(!1)},disabled:i,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":a("category_select.select_placeholder"),children:[(0,o.jsx)("option",{value:"",children:a("category_select.select_placeholder")}),n.map(e=>(0,o.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,o.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"▾"})]})}function y({name:e,setName:r,createCategory:n,setExpanded:i,t:a}){return(0,o.jsx)("input",{value:e,onChange:e=>r(e.target.value),placeholder:a("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&n(),"Escape"===e.key&&i(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}var w=e.i(22361);function x({selectedCat:e,onSelect:r}){let{t:n}=(0,c.useI18n)(),{cats:i,isLoading:a,isCreating:l,isDeleting:u,createCategory:f,deleteCategory:x,reload:v}=function(){let{t:e}=(0,c.useI18n)(),[r,n]=(0,s.useState)([]),[i,a]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1),d=(0,s.useCallback)(async()=>{a(!0);try{let{data:e,error:r}=await w.supabase.from("categories").select("id,name");if(r)throw r;let i=e??[];return n(i),i}catch(r){return console.error(r),alert(e("category_select.loadError")),[]}finally{a(!1)}},[e]),h=(0,s.useCallback)(async r=>{if(!r||l)return null;o(!0);try{let{data:e,error:n}=await w.supabase.from("categories").insert({name:r}).select("id,name").single();if(n)throw n;return await d(),e}catch(r){return console.error(r),alert(e("category_select.createError")),null}finally{o(!1)}},[d,e,l]),m=(0,s.useCallback)(async r=>{if(!r||u)return!1;f(!0);try{let{error:e}=await w.supabase.from("categories").delete().eq("id",r);if(e)throw e;return await d(),!0}catch(r){return console.error(r),alert(e("category_select.deleteError")),!1}finally{f(!1)}},[d,e,u]);return{cats:r,isLoading:i,isCreating:l,isDeleting:u,reload:d,createCategory:h,deleteCategory:m}}(),[A,_]=(0,s.useState)(""),[j,C]=(0,s.useState)(!e);(0,s.useEffect)(()=>{C(!e)},[e]),(0,s.useEffect)(()=>{v().then(e=>{1===e.length&&(r(e[0].id),C(!1))})},[v,r]);let k=(0,s.useMemo)(()=>[...i].sort((e,r)=>e.name.localeCompare(r.name,"de",{sensitivity:"base"})),[i]),E=(0,s.useMemo)(()=>e?i.find(r=>r.id===e)??null:null,[i,e]),U=(0,s.useCallback)(async()=>{let e=A.trim();if(!e)return;let n=await f(e);n?.id&&(_(""),r(n.id),C(!1))},[A,f,r]),S=(0,s.useCallback)(async()=>{e&&confirm(n("category_select.confirmDelete"))&&await x(e)&&(r(null),C(!0))},[e,x,r,n]);return!j&&E?(0,o.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,o.jsx)(g,{title:n("category_select.title"),name:E.name}),(0,o.jsx)("div",{className:"flex items-center gap-2",children:(0,o.jsx)(p,{onClick:()=>C(!0),label:n("category_select.open_category")})})]}):(0,o.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,o.jsx)("h2",{className:"text-base font-semibold",children:n("category_select.title")}),(0,o.jsx)(b,{selectedCat:e,onSelect:r,sortedCats:k,isLoading:a,t:n,setExpanded:C}),(0,o.jsxs)("div",{className:"space-y-2",children:[(0,o.jsx)(y,{name:A,setName:_,createCategory:U,setExpanded:C,t:n}),(0,o.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[e&&(0,o.jsx)(m,{onClick:S,disabled:u,label:n("category_select.delete")}),e&&""===A.trim()&&(0,o.jsx)(h,{onClick:()=>{C(!1),r(e)},label:n("category_select.set")}),(!e||""!==A.trim())&&(0,o.jsx)(d,{onClick:U,disabled:""===A.trim()||l,isCreating:l,label:n("category_select.add")})]})]})]})}e.i(47167);var v=e.i(57688);function A({user:e,onSignOut:r}){var n;let i,[a,l]=(0,s.useState)(!1),{t:u}=(0,c.useI18n)(),d=e.email??"";return(0,o.jsx)("header",{className:"sticky top-0 z-[400] backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,o.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(v.default,{src:(i=(n="/logo.png").startsWith("/")?n:`/${n}`,`/CollectionBuddy${i}`),alt:u("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,o.jsx)("span",{className:"font-semibold tracking-tight",children:u("header.title")})]}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsxs)("button",{onClick:()=>l(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition","aria-haspopup":"menu","aria-expanded":a?"true":"false",title:d||u("header.title"),children:[(0,o.jsx)(f.default,{icon:f.IconType.Google,className:"w-5 h-5"}),(0,o.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:d}),(0,o.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"▾"})]}),a&&(0,o.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,o.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:d}),(0,o.jsx)("button",{onClick:r,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",role:"menuitem",children:u("header.sign_out")})]})]})]})})}var _=e.i(74080);function j({value:e,onChange:r}){let n,{t:i,lang:a}=(0,c.useI18n)(),{setQuery:l,focus:u,setFocus:f,results:d,loading:h,activeIdx:m,dropdownRef:p,inputRef:g,menuRef:b,choose:y,onKeyDown:w}=function(e){let[r,n]=(0,s.useState)(""),[i,a]=(0,s.useState)(!1),[l,o]=(0,s.useState)([]),[u,c]=(0,s.useState)(!1),[f,d]=(0,s.useState)(-1),h=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,s.useRef)(null),g=(0,s.useRef)(null),b=(0,s.useMemo)(()=>"de"===e?"de":"en",[e]),y=Intl.DisplayNames,w=(0,s.useMemo)(()=>y?new y([b],{type:"region"}):null,[y,b]),x=(0,s.useCallback)(e=>{let r=e.city||e.town||e.village||e.municipality||e.name||"",n=e.country||(e.countrycode&&w?w.of(e.countrycode.toUpperCase()):void 0),i=[e.state,n].filter(Boolean).join(", "),a=`${r}|||${i}`.toLowerCase().replace(/\s+/g," ").trim();return{city:r,line2:i,key:a}},[w]);(0,s.useEffect)(()=>{if(!i||r.trim().length<3){o([]),d(-1);return}let e=r.trim(),n=setTimeout(async()=>{try{h.current?.abort();let r=new AbortController;h.current=r,c(!0);let n=new URL("https://photon.komoot.io/api/");n.searchParams.set("q",e),n.searchParams.set("limit","5"),n.searchParams.set("lang",b);let i=await fetch(n.toString(),{signal:r.signal});if(!i.ok)throw Error(`HTTP ${i.status}`);let a=await i.json(),l=Array.from(new Map(a.features.map(e=>[e.properties.osm_id,e])).values()),s=new Set,u=[];for(let e of l){let{key:r}=x(e.properties);s.has(r)||(s.add(r),u.push(e))}o(u),d(-1)}catch{o([]),d(-1)}finally{c(!1)}},300);return()=>clearTimeout(n)},[r,i,b,x]),(0,s.useEffect)(()=>{let e=e=>{let r=e.target,n=p.current?.contains(r),i=m.current?.contains(r),l=g.current?.contains(r);n||i||l||a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let v=(0,s.useCallback)(e=>{let{city:r,line2:n}=x(e.properties),i=n.split(", ").pop()||"",l=i?`${r}, ${i}`:r;return o([]),d(-1),a(!1),l},[x]),A=(0,s.useCallback)(e=>{if(l.length)if("ArrowDown"===e.key)e.preventDefault(),d(e=>(e+1)%l.length);else if("ArrowUp"===e.key)e.preventDefault(),d(e=>e<=0?l.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let r=f>=0?l[f]:l[0];if(r)return v(r)}else"Escape"===e.key&&(o([]),d(-1),a(!1))},[l,f,v]);return{query:r,setQuery:n,focus:i,setFocus:a,results:l,loading:u,activeIdx:f,setActiveIdx:d,dropdownRef:m,inputRef:p,menuRef:g,choose:v,onKeyDown:A,formatDisplay:x}}(a);return(0,s.useEffect)(()=>{l(e)},[e,l]),(0,o.jsxs)("div",{className:"relative",ref:p,children:[(0,o.jsx)("input",{ref:g,"aria-label":i("item_create.place_placeholder"),value:e,onChange:e=>{let n=e.target.value;r(n),n.trim().length<3?f(!1):f(!0)},onFocus:()=>{e.trim().length>=3&&f(!0)},onKeyDown:e=>{let n=w(e);"string"==typeof n&&(r(n),f(!1))},placeholder:i("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),u&&(h||d.length>0)&&_.default.createPortal((n=g.current?.getBoundingClientRect())?(0,o.jsxs)("div",{ref:b,className:"fixed rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden z-[2000]",style:{top:n.bottom,left:n.left,width:n.width},children:[h&&(0,o.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:i("item_create.searching")}),!h&&d.map((e,n)=>{let i=e.properties,a=i.city||i.town||i.village||i.municipality||i.name,l=[i.state,i.country].filter(Boolean).join(", ");return(0,o.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{r(y(e)),f(!1)},className:`block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ${n===m?"bg-primary/10 dark:bg-primary/10":""}`,children:[(0,o.jsx)("div",{className:"font-medium",children:a}),(0,o.jsx)("div",{className:"opacity-70",children:l})]},i.osm_id)}),!h&&0===d.length&&(0,o.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:i("item_create.no_results")})]}):null,document.body)]})}function C({submitting:e,disabled:r,label:n,iconMode:i,onClick:a}){return i?(0,o.jsx)("button",{type:"button",disabled:r,onClick:a,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:n,children:e?(0,o.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,o.jsx)(f.default,{icon:f.IconType.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,o.jsx)("button",{type:"button",disabled:r,onClick:a,className:"h-9 px-3 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-60",children:n})}function k({tags:e,setTags:r}){let{t:n}=(0,c.useI18n)(),[i,a]=(0,s.useState)(""),l=(0,s.useCallback)(()=>{let n=i.trim();!n||e.includes(n)||(r([...e,n]),a(""))},[i,e,r]),u=(0,s.useCallback)(n=>r(e.filter(e=>e!==n)),[e,r]);return(0,o.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[e.map(e=>(0,o.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,o.jsx)("button",{type:"button",onClick:()=>u(e),className:"w-4 h-4 flex items-center justify-center rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600",title:n("item_create.remove_tag").replace("{tag}",e),children:(0,o.jsx)(f.default,{icon:f.IconType.Close,className:"w-3 h-3",stroke:"currentColor",strokeWidth:"3",fill:"none"})})]},e)),(0,o.jsx)("input",{value:i,onChange:e=>a(e.target.value),onKeyDown:r=>{"Enter"===r.key||","===r.key?(r.preventDefault(),l()):"Backspace"===r.key&&!i&&e.length>0&&u(e[e.length-1])},placeholder:0===e.length?n("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})}function E({initial:e,submitting:r=!1,submitLabel:n,onSubmit:i,onCancel:a,showIconSubmit:l=!1}){let{t:u}=(0,c.useI18n)(),[d,h]=(0,s.useState)(e.title??""),[m,p]=(0,s.useState)(e.description??""),[g,b]=(0,s.useState)(e.place??""),[y,w]=(0,s.useState)(e.tags??[]);(0,s.useEffect)(()=>{h(e.title??""),p(e.description??""),b(e.place??""),w(e.tags??[])},[e]);let x=(0,s.useMemo)(()=>!!d.trim(),[d]),v="function"==typeof a,A=(0,s.useCallback)(()=>{x&&i({title:d,description:m,place:g,tags:y})},[x,i,d,m,g,y]);return(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,o.jsx)("input",{"aria-label":u("item_create.title"),value:d,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&x&&A(),placeholder:u("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,o.jsx)("input",{"aria-label":u("item_create.description"),value:m,onChange:e=>p(e.target.value),onKeyDown:e=>"Enter"===e.key&&x&&A(),placeholder:u("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,o.jsx)(j,{value:g,onChange:b}),(0,o.jsx)(k,{tags:y,setTags:w})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-2",children:[a&&!l&&(0,o.jsx)("button",{type:"button",onClick:a,className:"h-9 px-3 rounded-xl border shadow-sm hover:bg-muted/50",children:u("item_list.close_modal")}),l?(0,o.jsx)("button",{type:"button",disabled:r||!x,onClick:A,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:n,children:r?(0,o.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):v?(0,o.jsx)(f.default,{icon:f.IconType.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"}):(0,o.jsx)(f.default,{icon:f.IconType.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,o.jsx)(C,{submitting:r,disabled:r||!x,label:n,iconMode:!1,onClick:A})]})]})}function U({open:e,onClick:r}){return(0,o.jsx)("div",{className:`fixed inset-0 z-[500] bg-black/40 backdrop-blur-sm transition-opacity ${e?"opacity-100":"pointer-events-none opacity-0"}`,onClick:r})}function S(e){return e?Array.from(e.querySelectorAll('a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex="-1"])')):[]}function F({open:e,title:r,closeLabel:n,onClose:i,children:a,initialFocusRef:l}){let u=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!e)return;let r=l?.current??S(u.current)[0];r?.focus?.()},[e,l]),(0,s.useEffect)(()=>{if(!e)return;let r=e=>{if("Tab"!==e.key)return;let r=S(u.current);if(0===r.length)return;let n=r[0],i=r[r.length-1],a=document.activeElement;e.shiftKey&&a===n?(e.preventDefault(),i.focus()):e.shiftKey||a!==i||(e.preventDefault(),n.focus())};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[e]),(0,o.jsx)("div",{className:`fixed inset-0 z-[600] flex items-center justify-center p-4 transition-opacity ${e?"opacity-100":"pointer-events-none opacity-0"}`,"aria-hidden":!e,children:(0,o.jsxs)("div",{ref:u,role:"dialog","aria-modal":"true","aria-labelledby":"centered-modal-title",className:"bg-background rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90dvh] flex flex-col overflow-hidden outline-none",onClick:e=>e.stopPropagation(),children:[(0,o.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,o.jsx)("h3",{id:"centered-modal-title",className:"text-base font-semibold",children:r}),(0,o.jsx)("button",{className:"rounded-md px-3 py-1 text-sm border",onClick:i,"aria-label":n??"Close",children:n??"Close"})]}),(0,o.jsx)("div",{className:"p-4 overflow-auto",children:a})]})})}function N({children:e}){return"undefined"==typeof document?null:_.default.createPortal(e,document.body)}function I({open:e,onOpenChange:r,title:n,closeLabel:i="Close",children:a,closeOnBackdrop:l=!0,closeOnEsc:u=!0,initialFocusRef:c}){var f,d;return((0,s.useEffect)(()=>{if(!e||"undefined"==typeof document)return;let{body:r}=document,n=r.style.overflow;return r.style.overflow="hidden",()=>{r.style.overflow=n}},[e]),f=e&&u,d=()=>r(!1),(0,s.useEffect)(()=>{if(!f)return;let e=e=>{"Escape"===e.key&&d()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f,d]),"undefined"==typeof document)?null:(0,o.jsxs)(N,{children:[(0,o.jsx)(U,{open:e,onClick:l?()=>r(!1):void 0}),(0,o.jsx)(F,{open:e,title:n,closeLabel:i,onClose:()=>r(!1),initialFocusRef:c,children:a})]})}function T({value:e,onChange:r}){let{t:n}=(0,c.useI18n)();return(0,o.jsxs)("div",{className:"relative flex w-full items-center",children:[(0,o.jsx)(f.Icon,{icon:f.IconType.Search,className:"pointer-events-none absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400","aria-hidden":!0}),(0,o.jsx)("input",{value:e,onChange:e=>r(e.target.value),placeholder:n("item_list.search_placeholder"),className:"w-full rounded-xl border bg-background py-2 pl-9 pr-10 shadow-sm"}),e&&(0,o.jsx)("button",{onClick:()=>r(""),className:"clear-button absolute right-3 top-1/2 -translate-y-1/2","aria-label":n("item_list.search_clear"),children:(0,o.jsx)(f.Icon,{icon:f.IconType.Close,className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})}function M({categoryId:e,onCreated:r}){let{t:n}=(0,c.useI18n)(),[i,a]=(0,s.useState)(0),{create:l,isCreating:u}=function(e){let{t:r}=(0,c.useI18n)(),[n,i]=(0,s.useState)(!1);return{create:(0,s.useCallback)(async a=>{if(n)return!1;let l=a.title.trim(),o=a.description.trim()||null,s=a.place.trim()||null,u=Array.isArray(a.tags)?a.tags:[];if(!l)return!1;i(!0);let c=null;try{let{data:r,error:n}=await w.supabase.from("items").insert({title:l,description:o,place:s,tags:u}).select("id").single();if(n||!r)throw n??Error("insert failed");c=r.id;let{error:i}=await w.supabase.from("item_categories").insert({item_id:c,category_id:e});if(i)throw i;return!0}catch(e){return c&&await w.supabase.from("items").delete().eq("id",c),console.error(e),alert(r("item_list.no_user_session")),!1}finally{i(!1)}},[e,n,r]),isCreating:n}}(e),f=(0,s.useCallback)(async e=>{await l(e)&&(r(),a(e=>e+1))},[l,r]);return(0,o.jsx)("section",{className:"relative z-[70] p-4 sm:p-5 space-y-3",children:(0,o.jsx)(E,{initial:{title:"",description:"",place:"",tags:[]},submitting:u,submitLabel:n("item_create.add"),onSubmit:f,showIconSubmit:!0},i)})}function P({page:e,setPage:r,totalPages:n}){let{t:i}=(0,c.useI18n)(),a=(0,s.useMemo)(()=>n<=7?Array.from({length:n},(e,r)=>r+1):e<5?[1,2,3,4,5,"...",n]:e>n-4?[1,"...",n-4,n-3,n-2,n-1,n]:[1,"...",e-1,e,e+1,"...",n],[e,n]);return n<=1?null:(0,o.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,o.jsx)("button",{disabled:1===e,onClick:()=>r(e-1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:i("item_list.previous")??"Previous",children:(0,o.jsx)(f.default,{icon:f.IconType.ChevronLeft,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),a.map((n,i)=>"string"==typeof n?(0,o.jsx)("span",{className:"w-9 h-9 flex items-center justify-center",children:n},`ellipsis-${i}`):(0,o.jsx)("button",{onClick:()=>r(n),className:"min-w-9 h-9 px-2 flex items-center justify-center rounded-xl shadow-sm "+(n===e?"bg-primary text-primary-foreground":"bg-primary/60 text-primary-foreground hover:bg-primary"),"aria-current":n===e?"page":void 0,children:n},n)),(0,o.jsx)("button",{disabled:e===n,onClick:()=>r(e+1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:i("item_list.next")??"Next",children:(0,o.jsx)(f.default,{icon:f.IconType.ChevronRight,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function R({isOpen:e,onClose:r,onUpload:n,busy:i,onEdit:a,onDelete:l}){let{t:s}=(0,c.useI18n)();return(0,o.jsxs)("div",{className:["absolute top-3 right-3 flex items-center gap-2 transition-opacity",e?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none","sm:opacity-0 sm:pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto"].join(" "),children:[(0,o.jsx)("button",{className:"sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-card border text-foreground shadow",onClick:r,"aria-label":s("common.close"),children:(0,o.jsx)(f.default,{icon:f.IconType.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none","aria-hidden":"true"})}),(0,o.jsxs)("label",{className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 transition cursor-pointer",title:s("item_list.add_image"),children:[(0,o.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:i,onChange:e=>{let i=e.target.files?.[0];i&&n(i),r()}}),i?(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-primary-foreground/40 border-t-primary-foreground rounded-full animate-spin"}):(0,o.jsx)(f.default,{icon:f.IconType.Add,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),(0,o.jsx)("button",{onClick:()=>{a(),r()},className:"w-9 h-9 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 flex items-center justify-center",title:s("item_list.edit"),children:(0,o.jsx)(f.default,{icon:f.IconType.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),(0,o.jsx)("button",{onClick:()=>{l(),r()},className:"w-9 h-9 rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600 flex items-center justify-center",title:s("item_list.delete"),children:(0,o.jsx)(f.default,{icon:f.IconType.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function O({imgs:e,isOpen:r,onOpenModal:n,onDelete:i,deletingPath:a,busy:l}){let{t:s}=(0,c.useI18n)();return e.length?(0,o.jsx)("div",{className:"grid grid-cols-2 gap-2",children:e.map(e=>(0,o.jsxs)("div",{className:"relative group",onClick:()=>n(e.urlFull),role:"button",tabIndex:0,onKeyDown:r=>{("Enter"===r.key||" "===r.key)&&n(e.urlFull)},children:[(0,o.jsx)(v.default,{src:e.urlThumb||e.urlFull,alt:s("item_list.image_alt").replace("{idx}",""),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer"}),(0,o.jsx)("button",{title:s("item_list.delete"),onClick:r=>{r.stopPropagation(),i(e)},disabled:a===e.pathFull||l,className:[r?"opacity-100":"opacity-0","sm:opacity-0 sm:group-hover:opacity-100 absolute top-1 right-1 w-7 h-7 flex items-center justify-center rounded-lg bg-red-600 text-white shadow disabled:opacity-60 transition"].join(" "),children:a===e.pathFull?(0,o.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,o.jsx)(f.default,{icon:f.IconType.Trash,className:"w-4 h-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]},e.pathFull))}):(0,o.jsx)("div",{className:"text-sm text-muted-foreground",children:s("item_list.no_images")})}function B({item:e,imgs:r,busy:n,deletingPath:i,onUpload:a,onEditItem:l,onDeleteItem:u,onDeleteImage:c,onOpenModal:d,i18n:{t:h}}){let[m,p]=(0,s.useState)(!1);return(0,o.jsxs)("li",{className:"group relative rounded-2xl border bg-card/70 dark:bg-card/60 bg-neutral-100/50 dark:bg-neutral-800/50 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,o.jsx)("div",{className:"font-medium pr-16 truncate",children:e.title}),(0,o.jsx)("button",{className:`absolute top-3 right-3 sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-muted text-foreground shadow ${m?"hidden":""}`,onClick:()=>p(!0),"aria-label":h("item_list.more_actions"),children:(0,o.jsx)(f.default,{icon:f.IconType.More,className:"w-5 h-5",fill:"currentColor","aria-hidden":"true"})}),(0,o.jsx)(R,{isOpen:m,onClose:()=>p(!1),onUpload:a,busy:n,onEdit:l,onDelete:u}),e.description&&(0,o.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:e.description}),e.place&&(0,o.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,o.jsx)(f.default,{icon:f.IconType.Pin,className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true"}),(0,o.jsx)("span",{className:"truncate",children:e.place})]}),!!e.tags.length&&(0,o.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>(0,o.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(0,o.jsx)(O,{imgs:r,isOpen:m,onOpenModal:d,onDelete:c,deletingPath:i,busy:n})]})}function L({url:e,onClose:r}){let{t:n}=(0,c.useI18n)();return e&&"undefined"!=typeof document?_.default.createPortal((0,o.jsxs)("div",{className:"fixed inset-0 z-[500] flex flex-col items-center justify-center bg-background/90 backdrop-blur",onClick:r,children:[(0,o.jsx)(v.default,{src:e,alt:n("item_list.full_size_image_alt"),unoptimized:!0,width:0,height:0,sizes:"100vw",className:"w-auto h-auto max-w-full max-h-full object-contain rounded-xl shadow-lg"}),(0,o.jsx)("button",{className:"mt-4 w-10 h-10 flex items-center justify-center rounded-xl bg-card text-card-foreground hover:bg-card/80 transition",title:n("item_list.close_modal"),children:(0,o.jsx)(f.default,{icon:f.IconType.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]}),document.body):null}function D(e,r){return new Promise(function(n,i){let a;return z(e).then(function(e){try{return a=e,n(new Blob([r.slice(0,2),a,r.slice(2)],{type:"image/jpeg"}))}catch(e){return i(e)}},i)})}let z=e=>new Promise((r,n)=>{let i=new FileReader;i.addEventListener("load",({target:{result:e}})=>{let i=new DataView(e),a=0;if(65496!==i.getUint16(a))return n("not a valid JPEG");for(a+=2;;){let l=i.getUint16(a);if(65498===l)break;let o=i.getUint16(a+2);if(65505===l&&0x45786966===i.getUint32(a+4)){let l,s=a+10;switch(i.getUint16(s)){case 18761:l=!0;break;case 19789:l=!1;break;default:return n("TIFF header contains invalid endian")}if(42!==i.getUint16(s+2,l))return n("TIFF header contains invalid version");let u=i.getUint32(s+4,l),c=s+u+2+12*i.getUint16(s+u,l);for(let e=s+u+2;e<c;e+=12)if(274==i.getUint16(e,l)){if(3!==i.getUint16(e+2,l))return n("Orientation data type is invalid");if(1!==i.getUint32(e+4,l))return n("Orientation data count is invalid");i.setUint16(e+8,1,l);break}return r(e.slice(a,a+2+o))}a+=2+o}return r(new Blob)}),i.readAsArrayBuffer(e)});var Q={};({get exports(){return Q},set exports(t){Q=t}}).exports=a={},a.parse=function(e,r){for(var n=a.bin.readUshort,i=a.bin.readUint,l=0,o={},s=new Uint8Array(e),u=s.length-4;0x6054b50!=i(s,u);)u--;var c=n(s,l=u+4+4);n(s,l+=2);var f=i(s,l+=2),d=i(s,l+=4);l+=4,l=d;for(var h=0;h<c;h++){i(s,l),l+=4,l+=4,l+=4,i(s,l+=4),f=i(s,l+=4);var m=i(s,l+=4),p=n(s,l+=4),g=n(s,l+2),b=n(s,l+4);l+=6;var y=i(s,l+=8);l+=4,l+=p+g+b,a._readLocal(s,y,o,f,m,r)}return o},a._readLocal=function(e,r,n,i,l,o){var s=a.bin.readUshort,u=a.bin.readUint;u(e,r),s(e,r+=4),s(e,r+=2);var c=s(e,r+=2);u(e,r+=2),u(e,r+=4),r+=4;var f=s(e,r+=8),d=s(e,r+=2);r+=2;var h=a.bin.readUTF8(e,r,f);if(r+=f,r+=d,o)n[h]={size:l,csize:i};else{var m=new Uint8Array(e.buffer,r);if(0==c)n[h]=new Uint8Array(m.buffer.slice(r,r+i));else{if(8!=c)throw"unknown compression method: "+c;var p=new Uint8Array(l);a.inflateRaw(m,p),n[h]=p}}},a.inflateRaw=function(e,r){return a.F.inflate(e,r)},a.inflate=function(e,r){return e[0],e[1],a.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),r)},a.deflate=function(e,r){null==r&&(r={level:6});var n=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[n]=120,i[n+1]=156,n+=2,n=a.F.deflateRaw(e,i,n,r.level);var l=a.adler(e,0,e.length);return i[n+0]=l>>>24&255,i[n+1]=l>>>16&255,i[n+2]=l>>>8&255,i[n+3]=l>>>0&255,new Uint8Array(i.buffer,0,n+4)},a.deflateRaw=function(e,r){null==r&&(r={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),i=a.F.deflateRaw(e,n,i,r.level);return new Uint8Array(n.buffer,0,i)},a.encode=function(e,r){null==r&&(r=!1);var n=0,i=a.bin.writeUint,l=a.bin.writeUshort,o={};for(var s in e){var u=!a._noNeed(s)&&!r,c=e[s],f=a.crc.crc(c,0,c.length);o[s]={cpr:u,usize:c.length,crc:f,file:u?a.deflateRaw(c):c}}for(var s in o)n+=o[s].file.length+30+46+2*a.bin.sizeUTF8(s);var d=new Uint8Array(n+=22),h=0,m=[];for(var s in o){var p=o[s];m.push(h),h=a._writeHeader(d,h,s,p,0)}var g=0,b=h;for(var s in o)p=o[s],m.push(h),h=a._writeHeader(d,h,s,p,1,m[g++]);var y=h-b;return i(d,h,0x6054b50),h+=4,l(d,h+=4,g),l(d,h+=2,g),i(d,h+=2,y),i(d,h+=4,b),h+=4,h+=2,d.buffer},a._noNeed=function(e){var r=e.split(".").pop().toLowerCase();return -1!="png,jpg,jpeg,zip".indexOf(r)},a._writeHeader=function(e,r,n,i,l,o){var s=a.bin.writeUint,u=a.bin.writeUshort,c=i.file;return s(e,r,0==l?0x4034b50:0x2014b50),r+=4,1==l&&(r+=2),u(e,r,20),u(e,r+=2,0),u(e,r+=2,8*!!i.cpr),s(e,r+=2,0),s(e,r+=4,i.crc),s(e,r+=4,c.length),s(e,r+=4,i.usize),u(e,r+=4,a.bin.sizeUTF8(n)),u(e,r+=2,0),r+=2,1==l&&(r+=2,r+=2,s(e,r+=6,o),r+=4),r+=a.bin.writeUTF8(e,r,n),0==l&&(e.set(c,r),r+=c.length),r},a.crc={table:function(){for(var e=new Uint32Array(256),r=0;r<256;r++){for(var n=r,i=0;i<8;i++)1&n?n=0xedb88320^n>>>1:n>>>=1;e[r]=n}return e}(),update:function(e,r,n,i){for(var l=0;l<i;l++)e=a.crc.table[255&(e^r[n+l])]^e>>>8;return e},crc:function(e,r,n){return 0xffffffff^a.crc.update(0xffffffff,e,r,n)}},a.adler=function(e,r,n){for(var i=1,a=0,l=r,o=r+n;l<o;){for(var s=Math.min(l+5552,o);l<s;)a+=i+=e[l++];i%=65521,a%=65521}return a<<16|i},a.bin={readUshort:function(e,r){return e[r]|e[r+1]<<8},writeUshort:function(e,r,n){e[r]=255&n,e[r+1]=n>>8&255},readUint:function(e,r){return 0x1000000*e[r+3]+(e[r+2]<<16|e[r+1]<<8|e[r])},writeUint:function(e,r,n){e[r]=255&n,e[r+1]=n>>8&255,e[r+2]=n>>16&255,e[r+3]=n>>24&255},readASCII:function(e,r,n){for(var i="",a=0;a<n;a++)i+=String.fromCharCode(e[r+a]);return i},writeASCII:function(e,r,n){for(var i=0;i<n.length;i++)e[r+i]=n.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,r,n){for(var i,l="",o=0;o<n;o++)l+="%"+a.bin.pad(e[r+o].toString(16));try{i=decodeURIComponent(l)}catch(i){return a.bin.readASCII(e,r,n)}return i},writeUTF8:function(e,r,n){for(var i=n.length,a=0,l=0;l<i;l++){var o=n.charCodeAt(l);if(0==(0xffffff80&o))e[r+a]=o,a++;else if(0==(0xfffff800&o))e[r+a]=192|o>>6,e[r+a+1]=128|63&o,a+=2;else if(0==(0xffff0000&o))e[r+a]=224|o>>12,e[r+a+1]=128|o>>6&63,e[r+a+2]=128|63&o,a+=3;else{if(0!=(0xffe00000&o))throw"e";e[r+a]=240|o>>18,e[r+a+1]=128|o>>12&63,e[r+a+2]=128|o>>6&63,e[r+a+3]=128|63&o,a+=4}}return a},sizeUTF8:function(e){for(var r=e.length,n=0,i=0;i<r;i++){var a=e.charCodeAt(i);if(0==(0xffffff80&a))n++;else if(0==(0xfffff800&a))n+=2;else if(0==(0xffff0000&a))n+=3;else{if(0!=(0xffe00000&a))throw"e";n+=4}}return n}},a.F={},a.F.deflateRaw=function(e,r,n,i){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],o=a.F.U,s=a.F._goodIndex;a.F._hash;var u=a.F._putsE,c=0,f=n<<3,d=0,h=e.length;if(0==i){for(;c<h;)u(r,f,+(c+(C=Math.min(65535,h-c))==h)),f=a.F._copyExact(e,c,C,r,f+8),c+=C;return f>>>3}var m=o.lits,p=o.strt,g=o.prev,b=0,y=0,w=0,x=0,v=0,A=0;for(h>2&&(p[A=a.F._hash(e,0)]=0),c=0;c<h;c++){if(v=A,c+1<h-2){A=a.F._hash(e,c+1);var _=c+1&32767;g[_]=p[A],p[A]=_}if(d<=c){(b>14e3||y>26697)&&h-c>100&&(d<c&&(m[b]=c-d,b+=2,d=c),f=a.F._writeBlock(+(c==h-1||d==h),m,b,x,e,w,c-w,r,f),b=y=x=0,w=c);var j=0;c<h-2&&(j=a.F._bestMatch(e,c,g,v,Math.min(l[2],h-c),l[3]));var C=j>>>16,k=65535&j;if(0!=j){k=65535&j;var E=s(C=j>>>16,o.of0);o.lhst[257+E]++;var U=s(k,o.df0);o.dhst[U]++,x+=o.exb[E]+o.dxb[U],m[b]=C<<23|c-d,m[b+1]=k<<16|E<<8|U,b+=2,d=c+C}else o.lhst[e[c]]++;y++}}for(w==c&&0!=e.length||(d<c&&(m[b]=c-d,b+=2,d=c),f=a.F._writeBlock(1,m,b,x,e,w,c-w,r,f),b=0,y=0,b=y=x=0,w=c);0!=(7&f);)f++;return f>>>3},a.F._bestMatch=function(e,r,n,i,l,o){var s=32767&r,u=n[s],c=s-u+32768&32767;if(u==s||i!=a.F._hash(e,r-c))return 0;for(var f=0,d=0,h=Math.min(32767,r);c<=h&&0!=--o&&u!=s;){if(0==f||e[r+f]==e[r+f-c]){var m=a.F._howLong(e,r,c);if(m>f){if(d=c,(f=m)>=l)break;c+2<m&&(m=c+2);for(var p=0,g=0;g<m-2;g++){var b=r-c+g+32768&32767,y=b-n[b]+32768&32767;y>p&&(p=y,u=b)}}}c+=(s=u)-(u=n[s])+32768&32767}return f<<16|d},a.F._howLong=function(e,r,n){if(e[r]!=e[r-n]||e[r+1]!=e[r+1-n]||e[r+2]!=e[r+2-n])return 0;var i=r,a=Math.min(e.length,r+258);for(r+=3;r<a&&e[r]==e[r-n];)r++;return r-i},a.F._hash=function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<4)&65535},a.saved=0,a.F._writeBlock=function(e,r,n,i,l,o,s,u,c){var f,d,h,m,p,g,b,y,w,x,v,A=a.F.U,_=a.F._putsF,j=a.F._putsE;A.lhst[256]++,m=(h=a.F.getTrees())[0],p=h[1],g=h[2],b=h[3],y=h[4],w=h[5],x=h[6],v=h[7];var C=32+(0==(c+3&7)?0:8-(c+3&7))+(s<<3),k=i+a.F.contSize(A.fltree,A.lhst)+a.F.contSize(A.fdtree,A.dhst),E=i+a.F.contSize(A.ltree,A.lhst)+a.F.contSize(A.dtree,A.dhst);E+=14+3*w+a.F.contSize(A.itree,A.ihst)+(2*A.ihst[16]+3*A.ihst[17]+7*A.ihst[18]);for(var U=0;U<286;U++)A.lhst[U]=0;for(U=0;U<30;U++)A.dhst[U]=0;for(U=0;U<19;U++)A.ihst[U]=0;var S=C<k&&C<E?0:k<E?1:2;if(_(u,c,e),_(u,c+1,S),c+=3,0==S){for(;0!=(7&c);)c++;c=a.F._copyExact(l,o,s,u,c)}else{if(1==S&&(f=A.fltree,d=A.fdtree),2==S){a.F.makeCodes(A.ltree,m),a.F.revCodes(A.ltree,m),a.F.makeCodes(A.dtree,p),a.F.revCodes(A.dtree,p),a.F.makeCodes(A.itree,g),a.F.revCodes(A.itree,g),f=A.ltree,d=A.dtree,j(u,c,b-257),j(u,c+=5,y-1),j(u,c+=5,w-4),c+=4;for(var F=0;F<w;F++)j(u,c+3*F,A.itree[1+(A.ordr[F]<<1)]);c+=3*w,c=a.F._codeTiny(x,A.itree,u,c),c=a.F._codeTiny(v,A.itree,u,c)}for(var N=o,I=0;I<n;I+=2){for(var T=r[I],M=T>>>23,P=N+(8388607&T);N<P;)c=a.F._writeLit(l[N++],f,u,c);if(0!=M){var R=r[I+1],O=R>>16,B=R>>8&255,L=255&R;j(u,c=a.F._writeLit(257+B,f,u,c),M-A.of0[B]),c+=A.exb[B],_(u,c=a.F._writeLit(L,d,u,c),O-A.df0[L]),c+=A.dxb[L],N+=M}}c=a.F._writeLit(256,f,u,c)}return c},a.F._copyExact=function(e,r,n,i,a){var l=a>>>3;return i[l]=n,i[l+1]=n>>>8,i[l+2]=255-i[l],i[l+3]=255-i[l+1],l+=4,i.set(new Uint8Array(e.buffer,r,n),l),a+(n+4<<3)},a.F.getTrees=function(){for(var e=a.F.U,r=a.F._hufTree(e.lhst,e.ltree,15),n=a.F._hufTree(e.dhst,e.dtree,15),i=[],l=a.F._lenCodes(e.ltree,i),o=[],s=a.F._lenCodes(e.dtree,o),u=0;u<i.length;u+=2)e.ihst[i[u]]++;for(u=0;u<o.length;u+=2)e.ihst[o[u]]++;for(var c=a.F._hufTree(e.ihst,e.itree,7),f=19;f>4&&0==e.itree[1+(e.ordr[f-1]<<1)];)f--;return[r,n,c,l,s,f,i,o]},a.F.getSecond=function(e){for(var r=[],n=0;n<e.length;n+=2)r.push(e[n+1]);return r},a.F.nonZero=function(e){for(var r="",n=0;n<e.length;n+=2)0!=e[n+1]&&(r+=(n>>1)+",");return r},a.F.contSize=function(e,r){for(var n=0,i=0;i<r.length;i++)n+=r[i]*e[1+(i<<1)];return n},a.F._codeTiny=function(e,r,n,i){for(var l=0;l<e.length;l+=2){var o=e[l],s=e[l+1];i=a.F._writeLit(o,r,n,i);var u=16==o?2:17==o?3:7;o>15&&(a.F._putsE(n,i,s,u),i+=u)}return i},a.F._lenCodes=function(e,r){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var i=0;i<n;i+=2){var a=e[i+1],l=i+3<n?e[i+3]:-1,o=i+5<n?e[i+5]:-1,s=0==i?-1:e[i-1];if(0==a&&l==a&&o==a){for(var u=i+5;u+2<n&&e[u+2]==a;)u+=2;(c=Math.min(u+1-i>>>1,138))<11?r.push(17,c-3):r.push(18,c-11),i+=2*c-2}else if(a==s&&l==a&&o==a){for(u=i+5;u+2<n&&e[u+2]==a;)u+=2;var c=Math.min(u+1-i>>>1,6);r.push(16,c-3),i+=2*c-2}else r.push(a,0)}return n>>>1},a.F._hufTree=function(e,r,n){var i=[],l=e.length,o=r.length,s=0;for(s=0;s<o;s+=2)r[s]=0,r[s+1]=0;for(s=0;s<l;s++)0!=e[s]&&i.push({lit:s,f:e[s]});var u=i.length,c=i.slice(0);if(0==u)return 0;if(1==u){var f=i[0].lit;return c=+(0==f),r[1+(f<<1)]=1,r[1+(c<<1)]=1,1}i.sort(function(e,r){return e.f-r.f});var d=i[0],h=i[1],m=0,p=1,g=2;for(i[0]={lit:-1,f:d.f+h.f,l:d,r:h,d:0};p!=u-1;)d=m!=p&&(g==u||i[m].f<i[g].f)?i[m++]:i[g++],h=m!=p&&(g==u||i[m].f<i[g].f)?i[m++]:i[g++],i[p++]={lit:-1,f:d.f+h.f,l:d,r:h};var b=a.F.setDepth(i[p-1],0);for(b>n&&(a.F.restrictDepth(c,n,b),b=n),s=0;s<u;s++)r[1+(c[s].lit<<1)]=c[s].d;return b},a.F.setDepth=function(e,r){return -1!=e.lit?(e.d=r,r):Math.max(a.F.setDepth(e.l,r+1),a.F.setDepth(e.r,r+1))},a.F.restrictDepth=function(e,r,n){var i=0,a=1<<n-r,l=0;for(e.sort(function(e,r){return r.d==e.d?e.f-r.f:r.d-e.d}),i=0;i<e.length&&e[i].d>r;i++){var o=e[i].d;e[i].d=r,l+=a-(1<<n-o)}for(l>>>=n-r;l>0;)(o=e[i].d)<r?(e[i].d++,l-=1<<r-o-1):i++;for(;i>=0;i--)e[i].d==r&&l<0&&(e[i].d--,l++);0!=l&&console.log("debt left")},a.F._goodIndex=function(e,r){var n=0;return r[16]<=e&&(n|=16),r[8|n]<=e&&(n|=8),r[4|n]<=e&&(n|=4),r[2|n]<=e&&(n|=2),r[1|n]<=e&&(n|=1),n},a.F._writeLit=function(e,r,n,i){return a.F._putsF(n,i,r[e<<1]),i+r[1+(e<<1)]},a.F.inflate=function(e,r){var n=Uint8Array;if(3==e[0]&&0==e[1])return r||new n(0);var i=a.F,l=i._bitsF,o=i._bitsE,s=i._decodeTiny,u=i.makeCodes,c=i.codes2map,f=i._get17,d=i.U,h=null==r;h&&(r=new n(e.length>>>2<<3));for(var m,p,g=0,b=0,y=0,w=0,x=0,v=0,A=0,_=0,j=0;0==g;)if(g=l(e,j,1),b=l(e,j+1,2),j+=3,0!=b){if(h&&(r=a.F._check(r,_+131072)),1==b&&(m=d.flmap,p=d.fdmap,v=511,A=31),2==b){y=o(e,j,5)+257,w=o(e,j+5,5)+1,x=o(e,j+10,4)+4,j+=14;for(var C=0;C<38;C+=2)d.itree[C]=0,d.itree[C+1]=0;var k=1;for(C=0;C<x;C++){var E=o(e,j+3*C,3);d.itree[1+(d.ordr[C]<<1)]=E,E>k&&(k=E)}j+=3*x,u(d.itree,k),c(d.itree,k,d.imap),m=d.lmap,p=d.dmap,j=s(d.imap,(1<<k)-1,y+w,e,j,d.ttree);var U=i._copyOut(d.ttree,0,y,d.ltree);v=(1<<U)-1;var S=i._copyOut(d.ttree,y,w,d.dtree);A=(1<<S)-1,u(d.ltree,U),c(d.ltree,U,m),u(d.dtree,S),c(d.dtree,S,p)}for(;;){var F=m[f(e,j)&v];j+=15&F;var N=F>>>4;if(N>>>8==0)r[_++]=N;else{if(256==N)break;var I=_+N-254;if(N>264){var T=d.ldef[N-257];I=_+(T>>>3)+o(e,j,7&T),j+=7&T}var M=p[f(e,j)&A];j+=15&M;var P=M>>>4,R=d.ddef[P],O=(R>>>4)+l(e,j,15&R);for(j+=15&R,h&&(r=a.F._check(r,_+131072));_<I;)r[_]=r[_++-O],r[_]=r[_++-O],r[_]=r[_++-O],r[_]=r[_++-O];_=I}}}else{0!=(7&j)&&(j+=8-(7&j));var B=4+(j>>>3),L=e[B-4]|e[B-3]<<8;h&&(r=a.F._check(r,_+L)),r.set(new n(e.buffer,e.byteOffset+B,L),_),j=B+L<<3,_+=L}return r.length==_?r:r.slice(0,_)},a.F._check=function(e,r){var n=e.length;if(r<=n)return e;var i=new Uint8Array(Math.max(n<<1,r));return i.set(e,0),i},a.F._decodeTiny=function(e,r,n,i,l,o){for(var s=a.F._bitsE,u=a.F._get17,c=0;c<n;){var f=e[u(i,l)&r];l+=15&f;var d=f>>>4;if(d<=15)o[c]=d,c++;else{var h=0,m=0;16==d?(m=3+s(i,l,2),l+=2,h=o[c-1]):17==d?(m=3+s(i,l,3),l+=3):18==d&&(m=11+s(i,l,7),l+=7);for(var p=c+m;c<p;)o[c]=h,c++}}return l},a.F._copyOut=function(e,r,n,i){for(var a=0,l=0,o=i.length>>>1;l<n;){var s=e[l+r];i[l<<1]=0,i[1+(l<<1)]=s,s>a&&(a=s),l++}for(;l<o;)i[l<<1]=0,i[1+(l<<1)]=0,l++;return a},a.F.makeCodes=function(e,r){for(var n,i,l,o,s=a.F.U,u=e.length,c=s.bl_count,f=0;f<=r;f++)c[f]=0;for(f=1;f<u;f+=2)c[e[f]]++;var d=s.next_code;for(n=0,c[0]=0,i=1;i<=r;i++)n=n+c[i-1]<<1,d[i]=n;for(l=0;l<u;l+=2)0!=(o=e[l+1])&&(e[l]=d[o],d[o]++)},a.F.codes2map=function(e,r,n){for(var i=e.length,l=a.F.U.rev15,o=0;o<i;o+=2)if(0!=e[o+1])for(var s=o>>1,u=e[o+1],c=s<<4|u,f=r-u,d=e[o]<<f,h=d+(1<<f);d!=h;)n[l[d]>>>15-r]=c,d++},a.F.revCodes=function(e,r){for(var n=a.F.U.rev15,i=15-r,l=0;l<e.length;l+=2){var o=e[l]<<r-e[l+1];e[l]=n[o]>>>i}},a.F._putsE=function(e,r,n){n<<=7&r;var i=r>>>3;e[i]|=n,e[i+1]|=n>>>8},a.F._putsF=function(e,r,n){n<<=7&r;var i=r>>>3;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},a.F._bitsE=function(e,r,n){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<n)-1},a.F._bitsF=function(e,r,n){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<n)-1},a.F._get17=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},a.F._get25=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},a.F.U=(n=Uint16Array,i=Uint32Array,{next_code:new n(16),bl_count:new n(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new n(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new i(32),flmap:new n(512),fltree:[],fdmap:new n(32),fdtree:[],lmap:new n(32768),ltree:[],ttree:[],dmap:new n(32768),dtree:[],imap:new n(512),itree:[],rev15:new n(32768),lhst:new i(286),dhst:new i(30),ihst:new i(19),lits:new i(15e3),strt:new n(65536),prev:new n(32768)}),function(){for(var e=a.F.U,r=0;r<32768;r++){var n=r;n=(0xff00ff00&(n=(0xf0f0f0f0&(n=(0xcccccccc&(n=(0xaaaaaaaa&n)>>>1|(0x55555555&n)<<1))>>>2|(0x33333333&n)<<2))>>>4|(0xf0f0f0f&n)<<4))>>>8|(0xff00ff&n)<<8,e.rev15[r]=(n>>>16|n<<16)>>>17}function i(e,r,n){for(;0!=r--;)e.push(0,n)}for(r=0;r<32;r++)e.ldef[r]=e.of0[r]<<3|e.exb[r],e.ddef[r]=e.df0[r]<<4|e.dxb[r];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),a.F.makeCodes(e.fltree,9),a.F.codes2map(e.fltree,9,e.flmap),a.F.revCodes(e.fltree,9),i(e.fdtree,32,5),a.F.makeCodes(e.fdtree,5),a.F.codes2map(e.fdtree,5,e.fdmap),a.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)}();var $=(l={__proto__:null,default:Q},[Q].forEach(function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach(function(r){if("default"!==r&&!(r in l)){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(l,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})}),Object.freeze(l));let W=function(){let e,r,n;var i={nextZero(e,r){for(;0!=e[r];)r++;return r},readUshort:(e,r)=>e[r]<<8|e[r+1],writeUshort(e,r,n){e[r]=n>>8&255,e[r+1]=255&n},readUint:(e,r)=>0x1000000*e[r]+(e[r+1]<<16|e[r+2]<<8|e[r+3]),writeUint(e,r,n){e[r]=n>>24&255,e[r+1]=n>>16&255,e[r+2]=n>>8&255,e[r+3]=255&n},readASCII(e,r,n){let i="";for(let a=0;a<n;a++)i+=String.fromCharCode(e[r+a]);return i},writeASCII(e,r,n){for(let i=0;i<n.length;i++)e[r+i]=n.charCodeAt(i)},readBytes(e,r,n){let i=[];for(let a=0;a<n;a++)i.push(e[r+a]);return i},pad:e=>e.length<2?`0${e}`:e,readUTF8(e,r,n){let a,l="";for(let a=0;a<n;a++)l+=`%${i.pad(e[r+a].toString(16))}`;try{a=decodeURIComponent(l)}catch(a){return i.readASCII(e,r,n)}return a}};function a(e,r,n,a){let l=r*n,o=Math.ceil(r*u(a)/8),s=new Uint8Array(4*l),c=new Uint32Array(s.buffer),{ctype:f}=a,{depth:d}=a,h=i.readUshort;if(6==f){let r=l<<2;if(8==d)for(var m=0;m<r;m+=4)s[m]=e[m],s[m+1]=e[m+1],s[m+2]=e[m+2],s[m+3]=e[m+3];if(16==d)for(m=0;m<r;m++)s[m]=e[m<<1]}else if(2==f){let r=a.tabs.tRNS;if(null==r){if(8==d)for(m=0;m<l;m++){var p=3*m;c[m]=-0x1000000|e[p+2]<<16|e[p+1]<<8|e[p]}if(16==d)for(m=0;m<l;m++)p=6*m,c[m]=-0x1000000|e[p+4]<<16|e[p+2]<<8|e[p]}else{var g=r[0];let n=r[1],i=r[2];if(8==d)for(m=0;m<l;m++){var b=m<<2;p=3*m,c[m]=-0x1000000|e[p+2]<<16|e[p+1]<<8|e[p],e[p]==g&&e[p+1]==n&&e[p+2]==i&&(s[b+3]=0)}if(16==d)for(m=0;m<l;m++)b=m<<2,p=6*m,c[m]=-0x1000000|e[p+4]<<16|e[p+2]<<8|e[p],h(e,p)==g&&h(e,p+2)==n&&h(e,p+4)==i&&(s[b+3]=0)}}else if(3==f){let i=a.tabs.PLTE,u=a.tabs.tRNS,c=u?u.length:0;if(1==d)for(var y,w=0;w<n;w++){var x=w*o,v=w*r;for(m=0;m<r;m++){b=v+m<<2;var A=3*(y=e[x+(m>>3)]>>7-(7&m)&1);s[b]=i[A],s[b+1]=i[A+1],s[b+2]=i[A+2],s[b+3]=y<c?u[y]:255}}if(2==d)for(w=0;w<n;w++)for(x=w*o,v=w*r,m=0;m<r;m++)b=v+m<<2,A=3*(y=e[x+(m>>2)]>>6-((3&m)<<1)&3),s[b]=i[A],s[b+1]=i[A+1],s[b+2]=i[A+2],s[b+3]=y<c?u[y]:255;if(4==d)for(w=0;w<n;w++)for(x=w*o,v=w*r,m=0;m<r;m++)b=v+m<<2,A=3*(y=e[x+(m>>1)]>>4-((1&m)<<2)&15),s[b]=i[A],s[b+1]=i[A+1],s[b+2]=i[A+2],s[b+3]=y<c?u[y]:255;if(8==d)for(m=0;m<l;m++)b=m<<2,A=3*(y=e[m]),s[b]=i[A],s[b+1]=i[A+1],s[b+2]=i[A+2],s[b+3]=y<c?u[y]:255}else if(4==f){if(8==d)for(m=0;m<l;m++){b=m<<2;var _,j=e[_=m<<1];s[b]=j,s[b+1]=j,s[b+2]=j,s[b+3]=e[_+1]}if(16==d)for(m=0;m<l;m++)b=m<<2,j=e[_=m<<2],s[b]=j,s[b+1]=j,s[b+2]=j,s[b+3]=e[_+2]}else if(0==f)for(g=a.tabs.tRNS?a.tabs.tRNS:-1,w=0;w<n;w++){let n=w*o,i=w*r;if(1==d)for(var C=0;C<r;C++){var k=255*((j=255*(e[n+(C>>>3)]>>>7-(7&C)&1))!=255*g);c[i+C]=k<<24|j<<16|j<<8|j}else if(2==d)for(C=0;C<r;C++)k=255*((j=85*(e[n+(C>>>2)]>>>6-((3&C)<<1)&3))!=85*g),c[i+C]=k<<24|j<<16|j<<8|j;else if(4==d)for(C=0;C<r;C++)k=255*((j=17*(e[n+(C>>>1)]>>>4-((1&C)<<2)&15))!=17*g),c[i+C]=k<<24|j<<16|j<<8|j;else if(8==d)for(C=0;C<r;C++)k=255*((j=e[n+C])!=g),c[i+C]=k<<24|j<<16|j<<8|j;else if(16==d)for(C=0;C<r;C++)j=e[n+(C<<1)],k=255*(h(e,n+(C<<1))!=g),c[i+C]=k<<24|j<<16|j<<8|j}return s}function l(e,r,n,i){let a=new Uint8Array((Math.ceil(n*u(e)/8)+1+e.interlace)*i);return r=e.tabs.CgBI?s(r,a):o(r,a),0==e.interlace?r=c(r,e,0,n,i):1==e.interlace&&(r=function(e,r){let n=r.width,i=r.height,a=u(r),l=a>>3,o=Math.ceil(n*a/8),s=new Uint8Array(i*o),f=0,d=[0,0,4,0,2,0,1],h=[0,4,0,2,0,1,0],m=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],g=0;for(;g<7;){let u=m[g],y=p[g],w=0,x=0,v=d[g];for(;v<i;)v+=u,x++;let A=h[g];for(;A<n;)A+=y,w++;let _=Math.ceil(w*a/8);c(e,r,f,w,x);let j=0,C=d[g];for(;C<i;){let r=h[g],i=f+j*_<<3;for(;r<n;){var b;if(1==a&&(b=(b=e[i>>3])>>7-(7&i)&1,s[C*o+(r>>3)]|=b<<7-(7&r)),2==a&&(b=(b=e[i>>3])>>6-(7&i)&3,s[C*o+(r>>2)]|=b<<6-((3&r)<<1)),4==a&&(b=(b=e[i>>3])>>4-(7&i)&15,s[C*o+(r>>1)]|=b<<4-((1&r)<<2)),a>=8){let n=C*o+r*l;for(let r=0;r<l;r++)s[n+r]=e[(i>>3)+r]}i+=a,r+=y}j++,C+=u}w*x!=0&&(f+=x*(1+_)),g+=1}return s}(r,e)),r}function o(e,r){return s(new Uint8Array(e.buffer,2,e.length-6),r)}var s=((e={}).N=function(r,n){let i=Uint8Array,a,l,o=0,s=0,u=0,c=0,f=0,d=0,h=0,m=0,p=0;if(3==r[0]&&0==r[1])return n||new i(0);let g=e.b,b=e.e,y=e.R,w=e.n,x=e.A,v=e.Z,A=e.m,_=null==n;for(_&&(n=new i(r.length>>>2<<5));0==o;)if(o=g(r,p,1),s=g(r,p+1,2),p+=3,0!=s){if(_&&(n=e.W(n,m+131072)),1==s&&(a=A.J,l=A.h,d=511,h=31),2==s){u=b(r,p,5)+257,c=b(r,p+5,5)+1,f=b(r,p+10,4)+4,p+=14;let n=1;for(var j=0;j<38;j+=2)A.Q[j]=0,A.Q[j+1]=0;for(j=0;j<f;j++){let e=b(r,p+3*j,3);A.Q[1+(A.X[j]<<1)]=e,e>n&&(n=e)}p+=3*f,w(A.Q,n),x(A.Q,n,A.u),a=A.w,l=A.d,p=y(A.u,(1<<n)-1,u+c,r,p,A.v);let i=e.V(A.v,0,u,A.C);d=(1<<i)-1;let o=e.V(A.v,u,c,A.D);h=(1<<o)-1,w(A.C,i),x(A.C,i,a),w(A.D,o),x(A.D,o,l)}for(;;){let e=a[v(r,p)&d];p+=15&e;let i=e>>>4;if(i>>>8==0)n[m++]=i;else{if(256==i)break;{let e=m+i-254;if(i>264){let n=A.q[i-257];e=m+(n>>>3)+b(r,p,7&n),p+=7&n}let a=l[v(r,p)&h];p+=15&a;let o=a>>>4,s=A.c[o],u=(s>>>4)+g(r,p,15&s);for(p+=15&s;m<e;)n[m]=n[m++-u],n[m]=n[m++-u],n[m]=n[m++-u],n[m]=n[m++-u];m=e}}}}else{0!=(7&p)&&(p+=8-(7&p));let a=4+(p>>>3),l=r[a-4]|r[a-3]<<8;_&&(n=e.W(n,m+l)),n.set(new i(r.buffer,r.byteOffset+a,l),m),p=a+l<<3,m+=l}return n.length==m?n:n.slice(0,m)},e.W=function(e,r){let n=e.length;if(r<=n)return e;let i=new Uint8Array(n<<1);return i.set(e,0),i},e.R=function(r,n,i,a,l,o){let s=e.e,u=e.Z,c=0;for(;c<i;){let e=r[u(a,l)&n];l+=15&e;let i=e>>>4;if(i<=15)o[c]=i,c++;else{let e=0,r=0;16==i?(r=3+s(a,l,2),l+=2,e=o[c-1]):17==i?(r=3+s(a,l,3),l+=3):18==i&&(r=11+s(a,l,7),l+=7);let n=c+r;for(;c<n;)o[c]=e,c++}}return l},e.V=function(e,r,n,i){let a=0,l=0,o=i.length>>>1;for(;l<n;){let n=e[l+r];i[l<<1]=0,i[1+(l<<1)]=n,n>a&&(a=n),l++}for(;l<o;)i[l<<1]=0,i[1+(l<<1)]=0,l++;return a},e.n=function(r,n){let i,a,l,o,s=e.m,u=r.length,c=s.j;for(var f=0;f<=n;f++)c[f]=0;for(f=1;f<u;f+=2)c[r[f]]++;let d=s.K;for(i=0,c[0]=0,a=1;a<=n;a++)i=i+c[a-1]<<1,d[a]=i;for(l=0;l<u;l+=2)0!=(o=r[l+1])&&(r[l]=d[o],d[o]++)},e.A=function(r,n,i){let a=r.length,l=e.m.r;for(let e=0;e<a;e+=2)if(0!=r[e+1]){let a=e>>1,o=r[e+1],s=a<<4|o,u=n-o,c=r[e]<<u,f=c+(1<<u);for(;c!=f;)i[l[c]>>>15-n]=s,c++}},e.l=function(r,n){let i=e.m.r,a=15-n;for(let e=0;e<r.length;e+=2){let l=r[e]<<n-r[e+1];r[e]=i[l]>>>a}},e.M=function(e,r,n){n<<=7&r;let i=r>>>3;e[i]|=n,e[i+1]|=n>>>8},e.I=function(e,r,n){n<<=7&r;let i=r>>>3;e[i]|=n,e[i+1]|=n>>>8,e[i+2]|=n>>>16},e.e=function(e,r,n){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<n)-1},e.b=function(e,r,n){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<n)-1},e.Z=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},e.i=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},r=Uint16Array,n=Uint32Array,e.m={K:new r(16),j:new r(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new r(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new n(32),J:new r(512),_:[],h:new r(32),$:[],w:new r(32768),C:[],v:[],d:new r(32768),D:[],u:new r(512),Q:[],r:new r(32768),s:new n(286),Y:new n(30),a:new n(19),t:new n(15e3),k:new r(65536),g:new r(32768)},function(){let r=e.m;for(var n=0;n<32768;n++){let e=n;e=(0xff00ff00&(e=(0xf0f0f0f0&(e=(0xcccccccc&(e=(0xaaaaaaaa&e)>>>1|(0x55555555&e)<<1))>>>2|(0x33333333&e)<<2))>>>4|(0xf0f0f0f&e)<<4))>>>8|(0xff00ff&e)<<8,r.r[n]=(e>>>16|e<<16)>>>17}function i(e,r,n){for(;0!=r--;)e.push(0,n)}for(n=0;n<32;n++)r.q[n]=r.S[n]<<3|r.T[n],r.c[n]=r.p[n]<<4|r.z[n];i(r._,144,8),i(r._,112,9),i(r._,24,7),i(r._,8,8),e.n(r._,9),e.A(r._,9,r.J),e.l(r._,9),i(r.$,32,5),e.n(r.$,5),e.A(r.$,5,r.h),e.l(r.$,5),i(r.Q,19,0),i(r.C,286,0),i(r.D,30,0),i(r.v,320,0)}(),e.N);function u(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function c(e,r,n,i,a){let l,o,s=u(r),c=Math.ceil(i*s/8);s=Math.ceil(s/8);let d=e[n],h=0;if(d>1&&(e[n]=[0,0,1][d-2]),3==d)for(h=s;h<c;h++)e[h+1]=e[h+1]+(e[h+1-s]>>>1)&255;for(let r=0;r<a;r++)if(d=e[(o=(l=n+r*c)+r+1)-1],h=0,0==d)for(;h<c;h++)e[l+h]=e[o+h];else if(1==d){for(;h<s;h++)e[l+h]=e[o+h];for(;h<c;h++)e[l+h]=e[o+h]+e[l+h-s]}else if(2==d)for(;h<c;h++)e[l+h]=e[o+h]+e[l+h-c];else if(3==d){for(;h<s;h++)e[l+h]=e[o+h]+(e[l+h-c]>>>1);for(;h<c;h++)e[l+h]=e[o+h]+(e[l+h-c]+e[l+h-s]>>>1)}else{for(;h<s;h++)e[l+h]=e[o+h]+f(0,e[l+h-c],0);for(;h<c;h++)e[l+h]=e[o+h]+f(e[l+h-s],e[l+h-c],e[l+h-s-c])}return e}function f(e,r,n){let i=e+r-n,a=i-e,l=i-r,o=i-n;return a*a<=l*l&&a*a<=o*o?e:l*l<=o*o?r:n}function d(e,r,n,i,a,l,o,s,u){let c=Math.min(r,a),f=Math.min(n,l),d=0,h=0;for(let n=0;n<f;n++)for(let l=0;l<c;l++)if(o>=0&&s>=0?(d=n*r+l<<2,h=(s+n)*a+o+l<<2):(d=(-s+n)*r-o+l<<2,h=n*a+l<<2),0==u)i[h]=e[d],i[h+1]=e[d+1],i[h+2]=e[d+2],i[h+3]=e[d+3];else if(1==u){var m=e[d+3]*(1/255),p=e[d]*m,g=e[d+1]*m,b=e[d+2]*m,y=i[h+3]*(1/255),w=i[h]*y,x=i[h+1]*y,v=i[h+2]*y;let r=1-m,n=m+y*r,a=0==n?0:1/n;i[h+3]=255*n,i[h+0]=(p+w*r)*a,i[h+1]=(g+x*r)*a,i[h+2]=(b+v*r)*a}else if(2==u)m=e[d+3],p=e[d],g=e[d+1],b=e[d+2],y=i[h+3],w=i[h],x=i[h+1],v=i[h+2],m==y&&p==w&&g==x&&b==v?(i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=0):(i[h]=p,i[h+1]=g,i[h+2]=b,i[h+3]=m);else if(3==u){if(m=e[d+3],p=e[d],g=e[d+1],b=e[d+2],y=i[h+3],w=i[h],x=i[h+1],v=i[h+2],m==y&&p==w&&g==x&&b==v)continue;if(m<220&&y>20)return!1}return!0}return{decode:function(e){let r=new Uint8Array(e),n=8,a=i.readUshort,u=i.readUint,c={tabs:{},frames:[]},f=new Uint8Array(r.length),d,h=0,m=0,p=[137,80,78,71,13,10,26,10];for(var g,b=0;b<8;b++)if(r[b]!=p[b])throw"The input is not a PNG file!";for(;n<r.length;){let e=i.readUint(r,n);n+=4;let p=i.readASCII(r,n,4);if(n+=4,"IHDR"==p)y=n,c.width=i.readUint(r,y),y+=4,c.height=i.readUint(r,y),c.depth=r[y+=4],c.ctype=r[++y],c.compress=r[++y],c.filter=r[++y],c.interlace=r[++y],y++;else if("iCCP"==p){for(var y,w,x=n;0!=r[x];)x++;i.readASCII(r,n,x-n),r[x+1];let a=r.slice(x+2,n+e),l=null;try{l=o(a)}catch(e){l=s(a)}c.tabs[p]=l}else if("CgBI"==p)c.tabs[p]=r.slice(n,n+4);else if("IDAT"==p){for(b=0;b<e;b++)f[h+b]=r[n+b];h+=e}else if("acTL"==p)c.tabs[p]={num_frames:u(r,n),num_plays:u(r,n+4)},d=new Uint8Array(r.length);else if("fcTL"==p){0!=m&&((g=c.frames[c.frames.length-1]).data=l(c,d.slice(0,m),g.rect.width,g.rect.height),m=0);let e={x:u(r,n+12),y:u(r,n+16),width:u(r,n+4),height:u(r,n+8)},i=a(r,n+22),o={rect:e,delay:Math.round(1e3*(i=a(r,n+20)/(0==i?100:i))),dispose:r[n+24],blend:r[n+25]};c.frames.push(o)}else if("fdAT"==p){for(b=0;b<e-4;b++)d[m+b]=r[n+b+4];m+=e-4}else if("pHYs"==p)c.tabs[p]=[i.readUint(r,n),i.readUint(r,n+4),r[n+8]];else if("cHRM"==p)for(b=0,c.tabs[p]=[];b<8;b++)c.tabs[p].push(i.readUint(r,n+4*b));else if("tEXt"==p||"zTXt"==p){null==c.tabs[p]&&(c.tabs[p]={});var v=i.nextZero(r,n),A=i.readASCII(r,n,v-n),_=n+e-v-1;if("tEXt"==p)w=i.readASCII(r,v+1,_);else{var j=o(r.slice(v+2,v+2+_));w=i.readUTF8(j,0,j.length)}c.tabs[p][A]=w}else if("iTXt"==p){null==c.tabs[p]&&(c.tabs[p]={}),v=0,x=n,v=i.nextZero(r,x),A=i.readASCII(r,x,v-x);let a=r[x=v+1];r[x+1],x+=2,v=i.nextZero(r,x),i.readASCII(r,x,v-x),x=v+1,v=i.nextZero(r,x),i.readUTF8(r,x,v-x),_=e-((x=v+1)-n),0==a?w=i.readUTF8(r,x,_):(j=o(r.slice(x,x+_)),w=i.readUTF8(j,0,j.length)),c.tabs[p][A]=w}else if("PLTE"==p)c.tabs[p]=i.readBytes(r,n,e);else if("hIST"==p){let e=c.tabs.PLTE.length/3;for(b=0,c.tabs[p]=[];b<e;b++)c.tabs[p].push(a(r,n+2*b))}else if("tRNS"==p)3==c.ctype?c.tabs[p]=i.readBytes(r,n,e):0==c.ctype?c.tabs[p]=a(r,n):2==c.ctype&&(c.tabs[p]=[a(r,n),a(r,n+2),a(r,n+4)]);else if("gAMA"==p)c.tabs[p]=i.readUint(r,n)/1e5;else if("sRGB"==p)c.tabs[p]=r[n];else if("bKGD"==p)0==c.ctype||4==c.ctype?c.tabs[p]=[a(r,n)]:2==c.ctype||6==c.ctype?c.tabs[p]=[a(r,n),a(r,n+2),a(r,n+4)]:3==c.ctype&&(c.tabs[p]=r[n]);else if("IEND"==p)break;n+=e,i.readUint(r,n),n+=4}return 0!=m&&((g=c.frames[c.frames.length-1]).data=l(c,d.slice(0,m),g.rect.width,g.rect.height)),c.data=l(c,f,c.width,c.height),delete c.compress,delete c.interlace,delete c.filter,c},toRGBA8:function(e){let r=e.width,n=e.height;if(null==e.tabs.acTL)return[a(e.data,r,n,e).buffer];let i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);let l=r*n*4,o=new Uint8Array(l),s=new Uint8Array(l),u=new Uint8Array(l);for(let f=0;f<e.frames.length;f++){let h=e.frames[f],m=h.rect.x,p=h.rect.y,g=h.rect.width,b=h.rect.height,y=a(h.data,g,b,e);if(0!=f)for(var c=0;c<l;c++)u[c]=o[c];if(0==h.blend?d(y,g,b,o,r,n,m,p,0):1==h.blend&&d(y,g,b,o,r,n,m,p,1),i.push(o.buffer.slice(0)),0==h.dispose);else if(1==h.dispose)d(s,g,b,o,r,n,m,p,0);else if(2==h.dispose)for(c=0;c<l;c++)o[c]=u[c]}return i},_paeth:f,_copyTile:d,_bin:i}}();!function(){let{_copyTile:e}=W,{_bin:r}=W,n=W._paeth;var i={table:function(){let e=new Uint32Array(256);for(let r=0;r<256;r++){let n=r;for(let e=0;e<8;e++)1&n?n=0xedb88320^n>>>1:n>>>=1;e[r]=n}return e}(),update(e,r,n,a){for(let l=0;l<a;l++)e=i.table[255&(e^r[n+l])]^e>>>8;return e},crc:(e,r,n)=>0xffffffff^i.update(0xffffffff,e,r,n)};function a(e,r,n,i){r[n]+=e[0]*i>>4,r[n+1]+=e[1]*i>>4,r[n+2]+=e[2]*i>>4,r[n+3]+=e[3]*i>>4}function l(e){return Math.max(0,Math.min(255,e))}function o(e,r){let n=e[0]-r[0],i=e[1]-r[1],a=e[2]-r[2],l=e[3]-r[3];return n*n+i*i+a*a+l*l}function s(e,r,n,i,s,u,c){null==c&&(c=1);let f=i.length,d=[];for(var h,m=0;m<f;m++){let e=i[m];d.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(m=0;m<f;m++){let e=0xffffffff;for(var p=0,g=0;g<f;g++){var b=o(d[m],d[g]);g!=m&&b<e&&(e=b,p=g)}}let y=new Uint32Array(s.buffer),w=new Int16Array(r*n*4),x=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(m=0;m<x.length;m++)x[m]=255*((x[m]+.5)/16-.5);for(let s=0;s<n;s++)for(let v=0;v<r;v++){m=4*(s*r+v),2!=c?h=[l(e[m]+w[m]),l(e[m+1]+w[m+1]),l(e[m+2]+w[m+2]),l(e[m+3]+w[m+3])]:(b=x[4*(3&s)+(3&v)],h=[l(e[m]+b),l(e[m+1]+b),l(e[m+2]+b),l(e[m+3]+b)]),p=0;let A=0xffffff;for(g=0;g<f;g++){let e=o(h,d[g]);e<A&&(A=e,p=g)}let _=d[p],j=[h[0]-_[0],h[1]-_[1],h[2]-_[2],h[3]-_[3]];1==c&&(v!=r-1&&a(j,w,m+4,7),s!=n-1&&(0!=v&&a(j,w,m+4*r-4,3),a(j,w,m+4*r,5),v!=r-1&&a(j,w,m+4*r+4,1))),u[m>>2]=p,y[m>>2]=i[p]}}function u(e,n,a,l,o){null==o&&(o={});let{crc:s}=i,u=r.writeUint,c=r.writeUshort,f=r.writeASCII,d=8,h=e.frames.length>1,m,p=!1,g=33+20*!!h;if(null!=o.sRGB&&(g+=13),null!=o.pHYs&&(g+=21),null!=o.iCCP&&(g+=21+(m=pako.deflate(o.iCCP)).length+4),3==e.ctype){for(var b=e.plte.length,y=0;y<b;y++)e.plte[y]>>>24!=255&&(p=!0);g+=8+3*b+4+(p?8+ +b+4:0)}for(var w=0;w<e.frames.length;w++)h&&(g+=38),g+=(_=e.frames[w]).cimg.length+12,0!=w&&(g+=4);let x=new Uint8Array(g+=12),v=[137,80,78,71,13,10,26,10];for(y=0;y<8;y++)x[y]=v[y];if(u(x,d,13),f(x,d+=4,"IHDR"),u(x,d+=4,n),u(x,d+=4,a),x[d+=4]=e.depth,x[++d]=e.ctype,x[++d]=0,x[++d]=0,x[++d]=0,u(x,++d,s(x,d-17,17)),d+=4,null!=o.sRGB&&(u(x,d,1),f(x,d+=4,"sRGB"),x[d+=4]=o.sRGB,u(x,++d,s(x,d-5,5)),d+=4),null!=o.iCCP){let e=13+m.length;u(x,d,e),f(x,d+=4,"iCCP"),f(x,d+=4,"ICC profile"),d+=11,d+=2,x.set(m,d),u(x,d+=m.length,s(x,d-(e+4),e+4)),d+=4}if(null!=o.pHYs&&(u(x,d,9),f(x,d+=4,"pHYs"),u(x,d+=4,o.pHYs[0]),u(x,d+=4,o.pHYs[1]),x[d+=4]=o.pHYs[2],u(x,++d,s(x,d-13,13)),d+=4),h&&(u(x,d,8),f(x,d+=4,"acTL"),u(x,d+=4,e.frames.length),u(x,d+=4,null!=o.loop?o.loop:0),u(x,d+=4,s(x,d-12,12)),d+=4),3==e.ctype){for(u(x,d,3*(b=e.plte.length)),f(x,d+=4,"PLTE"),d+=4,y=0;y<b;y++){let r=3*y,n=e.plte[y],i=255&n,a=n>>>8&255,l=n>>>16&255;x[d+r+0]=i,x[d+r+1]=a,x[d+r+2]=l}if(u(x,d+=3*b,s(x,d-3*b-4,3*b+4)),d+=4,p){for(u(x,d,b),f(x,d+=4,"tRNS"),d+=4,y=0;y<b;y++)x[d+y]=e.plte[y]>>>24&255;u(x,d+=b,s(x,d-b-4,b+4)),d+=4}}let A=0;for(w=0;w<e.frames.length;w++){var _=e.frames[w];h&&(u(x,d,26),f(x,d+=4,"fcTL"),u(x,d+=4,A++),u(x,d+=4,_.rect.width),u(x,d+=4,_.rect.height),u(x,d+=4,_.rect.x),u(x,d+=4,_.rect.y),c(x,d+=4,l[w]),c(x,d+=2,1e3),x[d+=2]=_.dispose,x[++d]=_.blend,u(x,++d,s(x,d-30,30)),d+=4);let r=_.cimg;u(x,d,(b=r.length)+4*(0!=w));let n=d+=4;f(x,d,0==w?"IDAT":"fdAT"),d+=4,0!=w&&(u(x,d,A++),d+=4),x.set(r,d),u(x,d+=b,s(x,n,d-n)),d+=4}return u(x,d,0),f(x,d+=4,"IEND"),u(x,d+=4,s(x,d-4,4)),d+=4,x.buffer}function c(e,r,i){for(let a=0;a<e.frames.length;a++){let l=e.frames[a];l.rect.width;let o=l.rect.height,s=new Uint8Array(o*l.bpl+o);l.cimg=function(e,r,i,a,l,o,s){let u=[],c,f=[0,1,2,3,4];-1!=o?f=[o]:(r*a>5e5||1==i)&&(f=[0]),s&&(c={level:0});for(var d=0;d<f.length;d++){for(let o=0;o<r;o++)!function(e,r,i,a,l,o){let s=i*a,u=s+i;if(e[u]=o,u++,0==o)if(a<500)for(var c=0;c<a;c++)e[u+c]=r[s+c];else e.set(new Uint8Array(r.buffer,s,a),u);else if(1==o){for(c=0;c<l;c++)e[u+c]=r[s+c];for(c=l;c<a;c++)e[u+c]=r[s+c]-r[s+c-l]+256&255}else if(0==i){for(c=0;c<l;c++)e[u+c]=r[s+c];if(2==o)for(c=l;c<a;c++)e[u+c]=r[s+c];if(3==o)for(c=l;c<a;c++)e[u+c]=r[s+c]-(r[s+c-l]>>1)+256&255;if(4==o)for(c=l;c<a;c++)e[u+c]=r[s+c]-n(r[s+c-l],0,0)+256&255}else{if(2==o)for(c=0;c<a;c++)e[u+c]=r[s+c]+256-r[s+c-a]&255;if(3==o){for(c=0;c<l;c++)e[u+c]=r[s+c]+256-(r[s+c-a]>>1)&255;for(c=l;c<a;c++)e[u+c]=r[s+c]+256-(r[s+c-a]+r[s+c-l]>>1)&255}if(4==o){for(c=0;c<l;c++)e[u+c]=r[s+c]+256-n(0,r[s+c-a],0)&255;for(c=l;c<a;c++)e[u+c]=r[s+c]+256-n(r[s+c-l],r[s+c-a],r[s+c-l-a])&255}}}(l,e,o,a,i,f[d]);u.push($.deflate(l,c))}let h,m=1e9;for(d=0;d<u.length;d++)u[d].length<m&&(h=d,m=u[d].length);return u[h]}(l.img,o,l.bpp,l.bpl,s,r,i)}}function f(r,n,i,a,l){let o=l[0],u=l[1],c=l[2],f=l[3],p=l[4],g=l[5],b=6,y=8,w=255;for(var x=0;x<r.length;x++){let e=new Uint8Array(r[x]);for(var v=e.length,A=0;A<v;A+=4)w&=e[A+3]}let _=255!=w,j=function(r,n,i,a,l,o){let s=[];for(var u,c=0;c<r.length;c++){let u=new Uint8Array(r[c]),d=new Uint32Array(u.buffer),g=0,b=0,y=n,w=i,x=+!!a;if(0!=c){let v=o||a||1==c||0!=s[c-2].dispose?1:2,A=0,_=1e9;for(let e=0;e<v;e++){var f,m=new Uint8Array(r[c-1-e]);let a=new Uint32Array(r[c-1-e]),o=n,s=i,u=-1,h=-1;for(let e=0;e<i;e++)for(let r=0;r<n;r++)d[p=e*n+r]!=a[p]&&(r<o&&(o=r),r>u&&(u=r),e<s&&(s=e),e>h&&(h=e));-1==u&&(o=s=u=h=0),l&&(1==(1&o)&&o--,1==(1&s)&&s--);let x=(u-o+1)*(h-s+1);x<_&&(_=x,A=e,g=o,b=s,y=u-o+1,w=h-s+1)}m=new Uint8Array(r[c-1-A]),1==A&&(s[c-1].dispose=2),e(m,n,i,f=new Uint8Array(y*w*4),y,w,-g,-b,0),1==(x=+!!e(u,n,i,f,y,w,-g,-b,3))?h(u,n,i,f,{x:g,y:b,width:y,height:w}):e(u,n,i,f,y,w,-g,-b,0)}else f=u.slice(0);s.push({rect:{x:g,y:b,width:y,height:w},img:f,blend:x,dispose:0})}if(a)for(c=0;c<s.length;c++){if(1==(u=s[c]).blend)continue;let e=u.rect,a=s[c-1].rect,o=Math.min(e.x,a.x),f=Math.min(e.y,a.y),h={x:o,y:f,width:Math.max(e.x+e.width,a.x+a.width)-o,height:Math.max(e.y+e.height,a.y+a.height)-f};s[c-1].dispose=1,c-1!=0&&d(r,n,i,s,c-1,h,l),d(r,n,i,s,c,h,l)}if(1!=r.length)for(var p=0;p<s.length;p++)(u=s[p]).rect.width,u.rect.height;return s}(r,n,i,o,u,c),C={},k=[],E=[];if(0!=a){let e=[];for(A=0;A<j.length;A++)e.push(j[A].img.buffer);let r=m(function(e){let r=0;for(var n=0;n<e.length;n++)r+=e[n].byteLength;let i=new Uint8Array(r),a=0;for(n=0;n<e.length;n++){let r=new Uint8Array(e[n]),l=r.length;for(let e=0;e<l;e+=4){let n=r[e],l=r[e+1],o=r[e+2],s=r[e+3];0==s&&(n=l=o=0),i[a+e]=n,i[a+e+1]=l,i[a+e+2]=o,i[a+e+3]=s}a+=l}return i.buffer}(e),a);for(A=0;A<r.plte.length;A++)k.push(r.plte[A].est.rgba);let n=0;for(A=0;A<j.length;A++){let e=(S=j[A]).img.length;var U=new Uint8Array(r.inds.buffer,n>>2,e>>2);E.push(U);let i=new Uint8Array(r.abuf,n,e);g&&s(S.img,S.rect.width,S.rect.height,k,i,U),S.img.set(i),n+=e}}else for(x=0;x<j.length;x++){var S=j[x];let e=new Uint32Array(S.img.buffer);var F=S.rect.width;for(U=new Uint8Array(v=e.length),E.push(U),A=0;A<v;A++){let r=e[A];if(0!=A&&r==e[A-1])U[A]=U[A-1];else if(A>F&&r==e[A-F])U[A]=U[A-F];else{let e=C[r];if(null==e&&(C[r]=e=k.length,k.push(r),k.length>=300))break;U[A]=e}}}let N=k.length;for(N<=256&&0==p&&(y=Math.max(y=N<=2?1:N<=4?2:N<=16?4:8,f)),x=0;x<j.length;x++){(S=j[x]).rect.x,S.rect.y,F=S.rect.width;let e=S.rect.height,r=S.img;new Uint32Array(r.buffer);let n=4*F,i=4;if(N<=256&&0==p){var I=new Uint8Array((n=Math.ceil(y*F/8))*e);let a=E[x];for(let r=0;r<e;r++){A=r*n;let e=r*F;if(8==y)for(var T=0;T<F;T++)I[A+T]=a[e+T];else if(4==y)for(T=0;T<F;T++)I[A+(T>>1)]|=a[e+T]<<4-4*(1&T);else if(2==y)for(T=0;T<F;T++)I[A+(T>>2)]|=a[e+T]<<6-2*(3&T);else if(1==y)for(T=0;T<F;T++)I[A+(T>>3)]|=a[e+T]<<7-(7&T)}r=I,b=3,i=1}else if(0==_&&1==j.length){I=new Uint8Array(F*e*3);let a=F*e;for(A=0;A<a;A++){let e=3*A,n=4*A;I[e]=r[n],I[e+1]=r[n+1],I[e+2]=r[n+2]}r=I,b=2,i=3,n=3*F}S.img=r,S.bpl=n,S.bpp=i}return{ctype:b,depth:y,plte:k,frames:j}}function d(r,n,i,a,l,o,s){let u=Uint8Array,c=Uint32Array,f=new u(r[l-1]),d=new c(r[l-1]),m=l+1<r.length?new u(r[l+1]):null,p=new u(r[l]),g=new c(p.buffer),b=n,y=i,w=-1,x=-1;for(let e=0;e<o.height;e++)for(let r=0;r<o.width;r++){let i=o.x+r,s=o.y+e,u=s*n+i,c=g[u];0==c||0==a[l-1].dispose&&d[u]==c&&(null==m||0!=m[4*u+3])||(i<b&&(b=i),i>w&&(w=i),s<y&&(y=s),s>x&&(x=s))}-1==w&&(b=y=w=x=0),s&&(1==(1&b)&&b--,1==(1&y)&&y--),o={x:b,y:y,width:w-b+1,height:x-y+1};let v=a[l];v.rect=o,v.blend=1,v.img=new Uint8Array(o.width*o.height*4),0==a[l-1].dispose?(e(f,n,i,v.img,o.width,o.height,-o.x,-o.y,0),h(p,n,i,v.img,o)):e(p,n,i,v.img,o.width,o.height,-o.x,-o.y,0)}function h(r,n,i,a,l){e(r,n,i,a,l.width,l.height,-l.x,-l.y,2)}function m(e,r){let n,i=new Uint8Array(e),a=i.slice(0),l=new Uint32Array(a.buffer),o=p(a,r),s=o[0],u=o[1],c=i.length,f=new Uint8Array(c>>2);if(i.length<2e7)for(var d=0;d<c;d+=4)n=g(s,h=i[d]*(1/255),m=i[d+1]*(1/255),y=i[d+2]*(1/255),w=i[d+3]*(1/255)),f[d>>2]=n.ind,l[d>>2]=n.est.rgba;else for(d=0;d<c;d+=4){var h=i[d]*(1/255),m=i[d+1]*(1/255),y=i[d+2]*(1/255),w=i[d+3]*(1/255);for(n=s;n.left;)n=0>=b(n.est,h,m,y,w)?n.left:n.right;f[d>>2]=n.ind,l[d>>2]=n.est.rgba}return{abuf:a.buffer,inds:f,plte:u}}function p(e,r,n){null==n&&(n=1e-4);let i=new Uint32Array(e.buffer),a={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};a.bst=w(e,a.i0,a.i1),a.est=x(a.bst);let l=[a];for(;l.length<r;){let r=0,a=0;for(var o=0;o<l.length;o++)l[o].est.L>r&&(r=l[o].est.L,a=o);if(r<n)break;let s=l[a],u=function(e,r,n,i,a,l){for(i-=4;n<i;){for(;y(e,n,a)<=l;)n+=4;for(;y(e,i,a)>l;)i-=4;if(n>=i)break;let o=r[n>>2];r[n>>2]=r[i>>2],r[i>>2]=o,n+=4,i-=4}for(;y(e,n,a)>l;)n-=4;return n+4}(e,i,s.i0,s.i1,s.est.e,s.est.eMq255);if(s.i0>=u||s.i1<=u){s.est.L=0;continue}let c={i0:s.i0,i1:u,bst:null,est:null,tdst:0,left:null,right:null};c.bst=w(e,c.i0,c.i1),c.est=x(c.bst);let f={i0:u,i1:s.i1,bst:null,est:null,tdst:0,left:null,right:null};for(o=0,f.bst={R:[],m:[],N:s.bst.N-c.bst.N};o<16;o++)f.bst.R[o]=s.bst.R[o]-c.bst.R[o];for(o=0;o<4;o++)f.bst.m[o]=s.bst.m[o]-c.bst.m[o];f.est=x(f.bst),s.left=c,s.right=f,l[a]=c,l.push(f)}for(l.sort((e,r)=>r.bst.N-e.bst.N),o=0;o<l.length;o++)l[o].ind=o;return[a,l]}function g(e,r,n,i,a){if(null==e.left){var l;let o,s,u,c;return l=e.est.q,o=r-l[0],s=n-l[1],u=i-l[2],e.tdst=o*o+s*s+u*u+(c=a-l[3])*c,e}let o=b(e.est,r,n,i,a),s=e.left,u=e.right;o>0&&(s=e.right,u=e.left);let c=g(s,r,n,i,a);if(c.tdst<=o*o)return c;let f=g(u,r,n,i,a);return f.tdst<c.tdst?f:c}function b(e,r,n,i,a){let{e:l}=e;return l[0]*r+l[1]*n+l[2]*i+l[3]*a-e.eMq}function y(e,r,n){return e[r]*n[0]+e[r+1]*n[1]+e[r+2]*n[2]+e[r+3]*n[3]}function w(e,r,n){let i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0];for(let l=r;l<n;l+=4){let r=e[l]*(1/255),n=e[l+1]*(1/255),o=e[l+2]*(1/255),s=e[l+3]*(1/255);a[0]+=r,a[1]+=n,a[2]+=o,a[3]+=s,i[0]+=r*r,i[1]+=r*n,i[2]+=r*o,i[3]+=r*s,i[5]+=n*n,i[6]+=n*o,i[7]+=n*s,i[10]+=o*o,i[11]+=o*s,i[15]+=s*s}return i[4]=i[1],i[8]=i[2],i[9]=i[6],i[12]=i[3],i[13]=i[7],i[14]=i[11],{R:i,m:a,N:n-r>>2}}function x(e){let{R:r}=e,{m:n}=e,{N:i}=e,a=n[0],l=n[1],o=n[2],s=n[3],u=0==i?0:1/i,c=[r[0]-a*a*u,r[1]-a*l*u,r[2]-a*o*u,r[3]-a*s*u,r[4]-l*a*u,r[5]-l*l*u,r[6]-l*o*u,r[7]-l*s*u,r[8]-o*a*u,r[9]-o*l*u,r[10]-o*o*u,r[11]-o*s*u,r[12]-s*a*u,r[13]-s*l*u,r[14]-s*o*u,r[15]-s*s*u],f=[Math.random(),Math.random(),Math.random(),Math.random()],d=0,h=0;if(0!=i)for(let e=0;e<16&&(f=v.multVec(c,f),h=Math.sqrt(v.dot(f,f)),f=v.sml(1/h,f),!(0!=e&&1e-9>Math.abs(h-d)));e++)d=h;let m=[a*u,l*u,o*u,s*u];return{Cov:c,q:m,e:f,L:d,eMq255:v.dot(v.sml(255,m),f),eMq:v.dot(f,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|(0|Math.round(255*m[0])))>>>0}}var v={multVec:(e,r)=>[e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],e[4]*r[0]+e[5]*r[1]+e[6]*r[2]+e[7]*r[3],e[8]*r[0]+e[9]*r[1]+e[10]*r[2]+e[11]*r[3],e[12]*r[0]+e[13]*r[1]+e[14]*r[2]+e[15]*r[3]],dot:(e,r)=>e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3],sml:(e,r)=>[e*r[0],e*r[1],e*r[2],e*r[3]]};W.encode=function(e,r,n,i,a,l,o){null==i&&(i=0),null==o&&(o=!1);let s=f(e,r,n,i,[!1,!1,!1,0,o,!1]);return c(s,-1),u(s,r,n,a,l)},W.encodeLL=function(e,r,n,i,a,l,o,s){let f={ctype:0+2*(1!=i)+4*(0!=a),depth:l,frames:[]},d=(i+a)*l,h=d*r;for(let i=0;i<e.length;i++)f.frames.push({rect:{x:0,y:0,width:r,height:n},img:new Uint8Array(e[i]),blend:0,dispose:1,bpp:Math.ceil(d/8),bpl:Math.ceil(h/8)});return c(f,0,!0),u(f,r,n,o,s)},W.encode.compress=f,W.encode.dither=s,W.quantize=m,W.quantize.getKDtree=p,W.quantize.getNearest=g}();let q={toArrayBuffer(e,r){let n=e.width,i=e.height,a=n<<2,l=new Uint32Array(e.getContext("2d").getImageData(0,0,n,i).data.buffer),o=(32*n+31)/32<<2,s=o*i,u=122+s,c=new ArrayBuffer(u),f=new DataView(c),d,h,m,p,g=1048576,b=0,y=0,w=0;function x(e){f.setUint16(y,e,!0),y+=2}function v(e){f.setUint32(y,e,!0),y+=4}x(19778),v(u),y+=4,v(122),v(108),v(n),v(-i>>>0),x(1),x(32),v(3),v(s),v(2835),v(2835),y+=8,v(0xff0000),v(65280),v(255),v(0xff000000),v(0x57696e20),function e(){for(;b<i&&g>0;){for(p=122+b*o,d=0;d<a;)g--,m=(h=l[w++])>>>24,f.setUint32(p+d,h<<8|m),d+=4;b++}w<l.length?(g=1048576,setTimeout(e,q._dly)):r(c)}()},toBlob(e,r){this.toArrayBuffer(e,e=>{r(new Blob([e],{type:"image/bmp"}))})},_dly:9};var H={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},G={[H.CHROME]:16384,[H.FIREFOX]:11180,[H.DESKTOP_SAFARI]:16384,[H.IE]:8192,[H.IOS]:4096,[H.ETC]:8192};let K="undefined"!=typeof window,V="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,X=K&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Y=(K||V)&&(X&&X.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),Z=(K||V)&&(X&&X.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function J(e,r,n=Date.now()){return new Promise(i=>{let a=e.split(","),l=a[0].match(/:(.*?);/)[1],o=globalThis.atob(a[1]),s=o.length,u=new Uint8Array(s);for(;s--;)u[s]=o.charCodeAt(s);let c=new Blob([u],{type:l});c.name=r,c.lastModified=n,i(c)})}function ee(e){return new Promise((r,n)=>{let i=new Z;i.onload=()=>r(i.result),i.onerror=e=>n(e),i.readAsDataURL(e)})}function et(e){return new Promise((r,n)=>{let i=new Image;i.onload=()=>r(i),i.onerror=e=>n(e),i.src=e})}function er(){if(void 0!==er.cachedResult)return er.cachedResult;let e=H.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?e=H.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?e=H.IOS:/Safari/i.test(r)?e=H.DESKTOP_SAFARI:/Firefox/i.test(r)?e=H.FIREFOX:(/MSIE/i.test(r)||!0==!!document.documentMode)&&(e=H.IE),er.cachedResult=e,er.cachedResult}function en(e,r){let n=G[er()],i=e,a=r,l=i*a,o=i>a?a/i:i/a;for(;l>n*n;){let e=(n+i)/2,r=(n+a)/2;e<r?(a=r,i=r*o):(a=e*o,i=e),l=i*a}return{width:i,height:a}}function ei(e,r){let n,i;try{if(i=(n=new OffscreenCanvas(e,r)).getContext("2d"),null===i)throw Error("getContext of OffscreenCanvas returns null")}catch(e){i=(n=document.createElement("canvas")).getContext("2d")}return n.width=e,n.height=r,[n,i]}function ea(e,r){let{width:n,height:i}=en(e.width,e.height),[a,l]=ei(n,i);return r&&/jpe?g/.test(r)&&(l.fillStyle="white",l.fillRect(0,0,a.width,a.height)),l.drawImage(e,0,0,a.width,a.height),a}function el(){return void 0!==el.cachedResult||(el.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),el.cachedResult}function eo(e,r={}){return new Promise(function(n,i){let a,l;var o=function(){try{return l=ea(a,r.fileType||e.type),n([a,l])}catch(e){return i(e)}},s=function(r){try{var n=function(e){try{throw e}catch(e){return i(e)}};try{let r;return ee(e).then(function(e){try{return r=e,et(r).then(function(e){try{return a=e,function(){try{return o()}catch(e){return i(e)}}()}catch(e){return n(e)}},n)}catch(e){return n(e)}},n)}catch(e){n(e)}}catch(e){return i(e)}};try{if(el()||[H.DESKTOP_SAFARI,H.MOBILE_SAFARI].includes(er()))throw Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(e){try{return a=e,o()}catch(e){return s()}},s)}catch(e){s()}})}function es(e,r,n,i,a=1){return new Promise(function(l,o){let s;if("image/png"===r){let l,o;return l=e.getContext("2d"),{data:o}=l.getImageData(0,0,e.width,e.height),(s=new Blob([W.encode([o.buffer],e.width,e.height,4096*a)],{type:r})).name=n,s.lastModified=i,f.call(this)}if("image/bmp"===r)return new Promise(r=>q.toBlob(e,r)).then((function(e){try{return(s=e).name=n,s.lastModified=i,c.call(this)}catch(e){return o(e)}}).bind(this),o);if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:r,quality:a}).then((function(e){try{return(s=e).name=n,s.lastModified=i,u.call(this)}catch(e){return o(e)}}).bind(this),o);return J(e.toDataURL(r,a),n,i).then((function(e){try{return s=e,u.call(this)}catch(e){return o(e)}}).bind(this),o);function u(){return c.call(this)}function c(){return f.call(this)}function f(){return l(s)}})}function eu(e){e.width=0,e.height=0}function ec(){return new Promise(function(e,r){let n,i,a,l;return void 0!==ec.cachedResult?e(ec.cachedResult):J("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,eo(n).then(function(o){try{return i=o[1],es(i,n.type,n.name,n.lastModified).then(function(n){try{return a=n,eu(i),eo(a).then(function(n){try{return l=n[0],ec.cachedResult=1===l.width&&2===l.height,e(ec.cachedResult)}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)})}function ef(e){return new Promise((r,n)=>{let i=new Z;i.onload=e=>{let n=new DataView(e.target.result);if(65496!=n.getUint16(0,!1))return r(-2);let i=n.byteLength,a=2;for(;a<i&&!(8>=n.getUint16(a+2,!1));){let e=n.getUint16(a,!1);if(a+=2,65505==e){if(0x45786966!=n.getUint32(a+=2,!1))return r(-1);let e=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,e);let i=n.getUint16(a,e);a+=2;for(let l=0;l<i;l++)if(274==n.getUint16(a+12*l,e))return r(n.getUint16(a+12*l+8,e))}else{if(65280!=(65280&e))break;a+=n.getUint16(a,!1)}}return r(-1)},i.onerror=e=>n(e),i.readAsArrayBuffer(e)})}function ed(e,r){let{width:n}=e,{height:i}=e,{maxWidthOrHeight:a}=r,l,o=e;return isFinite(a)&&(n>a||i>a)&&([o,l]=ei(n,i),n>i?(o.width=a,o.height=i/n*a):(o.width=n/i*a,o.height=a),l.drawImage(e,0,0,o.width,o.height),eu(e)),o}function eh(e,r){let{width:n}=e,{height:i}=e,[a,l]=ei(n,i);switch(r>4&&r<9?(a.width=i,a.height=n):(a.width=n,a.height=i),r){case 2:l.transform(-1,0,0,1,n,0);break;case 3:l.transform(-1,0,0,-1,n,i);break;case 4:l.transform(1,0,0,-1,0,i);break;case 5:l.transform(0,1,1,0,0,0);break;case 6:l.transform(0,1,-1,0,i,0);break;case 7:l.transform(0,-1,-1,0,i,n);break;case 8:l.transform(0,-1,1,0,0,n)}return l.drawImage(e,0,0,n,i),eu(e),a}function em(e,r,n=0){return new Promise(function(i,a){let l,o,s,u,c,f,d,h,m,p,g,b,y,w,x,v,A,_,j,C;function k(e=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;l+=e,r.onProgress(Math.min(l,100))}function E(e){if(r.signal&&r.signal.aborted)throw r.signal.reason;l=Math.min(Math.max(e,l),100),r.onProgress(l)}return l=n,o=r.maxIteration||10,s=1024*r.maxSizeMB*1024,k(),eo(e,r).then((function(n){try{return[,u]=n,k(),c=ed(u,r),k(),new Promise(function(n,i){var a;if(!(a=r.exifOrientation))return ef(e).then((function(e){try{return a=e,l.call(this)}catch(e){return i(e)}}).bind(this),i);function l(){return n(a)}return l.call(this)}).then((function(n){try{return f=n,k(),ec().then((function(n){try{return d=n?c:eh(c,f),k(),h=r.initialQuality||1,m=r.fileType||e.type,es(d,m,e.name,e.lastModified,h).then((function(n){try{var l;if(p=n,k(),g=p.size>s,b=p.size>e.size,!g&&!b)return E(100),i(p);function f(){if(o--&&(x>s||x>y)){let r,n;return r=C?.95*j.width:j.width,n=C?.95*j.height:j.height,[A,_]=ei(r,n),_.drawImage(j,0,0,r,n),h*="image/png"===m?.85:.95,es(A,m,e.name,e.lastModified,h).then(function(e){try{return v=e,eu(j),j=A,x=v.size,E(Math.min(99,Math.floor((w-x)/(w-s)*100))),f}catch(e){return a(e)}},a)}return[1]}return y=e.size,x=w=p.size,j=d,C=!r.alwaysKeepResolution&&g,(l=(function(e){for(;e;){if(e.then)return void e.then(l,a);try{if(e.pop){if(e.length)return e.pop()?U.call(this):e;e=f}else e=e.call(this)}catch(e){return a(e)}}}).bind(this))(f);function U(){return eu(j),eu(A),eu(c),eu(d),eu(u),E(100),i(v)}}catch(e){return a(e)}}).bind(this),a)}catch(e){return a(e)}}).bind(this),a)}catch(e){return a(e)}}).bind(this),a)}catch(e){return a(e)}}).bind(this),a)})}function ep(e,n){return new Promise(function(i,a){let l,o,s,u,c,f;if(l={...n},s=0,{onProgress:u}=l,l.maxSizeMB=l.maxSizeMB||1/0,c="boolean"!=typeof l.useWebWorker||l.useWebWorker,delete l.useWebWorker,l.onProgress=e=>{s=e,"function"==typeof u&&u(s)},!(e instanceof Blob||e instanceof Y))return a(Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return a(Error("The file given is not an image"));if(f="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!c||"function"!=typeof Worker||f)return em(e,l).then((function(e){try{return o=e,m.call(this)}catch(e){return a(e)}}).bind(this),a);var d=(function(){try{return m.call(this)}catch(e){return a(e)}}).bind(this),h=function(r){try{return em(e,l).then(function(e){try{return o=e,d()}catch(e){return a(e)}},a)}catch(e){return a(e)}};try{return l.libURL=l.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",new Promise((n,i)=>{var a;let o;r||(o=[],"function"==typeof(a="\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n")?o.push(`(${a})()`):o.push(a),r=URL.createObjectURL(new Blob(o)));let s=new Worker(r);s.addEventListener("message",function(e){if(l.signal&&l.signal.aborted)s.terminate();else if(void 0===e.data.progress){if(e.data.error)return i(Error(e.data.error)),void s.terminate();n(e.data.file),s.terminate()}else l.onProgress(e.data.progress)}),s.addEventListener("error",i),l.signal&&l.signal.addEventListener("abort",()=>{i(l.signal.reason),s.terminate()}),s.postMessage({file:e,imageCompressionLibUrl:l.libURL,options:{...l,onProgress:void 0,signal:void 0}})}).then(function(e){try{return o=e,d()}catch(e){return h()}},h)}catch(e){h()}function m(){try{o.name=e.name,o.lastModified=e.lastModified}catch(e){}try{l.preserveExif&&"image/jpeg"===e.type&&(!l.fileType||l.fileType&&l.fileType===e.type)&&(o=D(e,o))}catch(e){}return i(o)}})}ep.getDataUrlFromFile=ee,ep.getFilefromDataUrl=J,ep.loadImage=et,ep.drawImageInCanvas=ea,ep.drawFileInCanvas=eo,ep.canvasToFile=es,ep.getExifOrientation=ef,ep.handleMaxWidthOrHeight=ed,ep.followExifOrientation=eh,ep.cleanupCanvasMemory=eu,ep.isAutoOrientationInBrowser=ec,ep.approximateBelowMaximumCanvasSizeOfBrowser=en,ep.copyExifWithoutOrientation=D,ep.getBrowserName=er,ep.version="2.0.2";var eg=e.i(83287),eb=e.i(28187),ey=e.i(58525);let ew=e=>{if("string"==typeof e)return e;if(e&&"string"==typeof e.src)return e.src;throw Error("Unsupported image import format")},ex=({markers:r,currentLocation:n,command:i})=>{let a=(0,s.useRef)(null),l=(0,s.useRef)(null),u=(0,s.useRef)(null),c=(0,s.useRef)(null),f=(0,s.useRef)(null),d=(0,s.useRef)(r),h=(0,s.useRef)(n),[m,p]=(0,s.useState)(!1),g=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{f.current=i??null},[i]),(0,s.useEffect)(()=>{d.current=r},[r]),(0,s.useEffect)(()=>{h.current=n},[n]),(0,s.useEffect)(()=>{let r=!1;return(async()=>{if(!a.current||u.current)return;let n=(await e.A(71400)).default;if(r)return;l.current=n,delete n.Icon.Default.prototype._getIconUrl,n.Icon.Default.mergeOptions({iconRetinaUrl:ew(eg.default),iconUrl:ew(eb.default),shadowUrl:ew(ey.default)});let i=n.map(a.current).setView([51.505,-.09],13);u.current=i,i.createPane("currentLocation");let o=i.getPane("currentLocation");o&&(o.style.zIndex="650"),n.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i),c.current=n.layerGroup().addTo(i),p(!0),requestAnimationFrame(()=>i.invalidateSize());let s=l.current,m=f.current;s&&m&&requestAnimationFrame(()=>{if("fitAll"===m){let e=[];d.current.forEach(r=>e.push([r.lat,r.lng]));let r=h.current;if(r&&e.push([r.lat,r.lng]),e.length>0){let r=s.latLngBounds(e).pad(.015);r.isValid()&&i.fitBounds(r,{padding:[8,8]})}}else if("fitCurrent"===m){let e=h.current;if(!e)return;let r=s.latLng(e.lat,e.lng).toBounds(1e5);i.fitBounds(r,{padding:[8,8]})}})})(),()=>{r=!0}},[]),(0,s.useEffect)(()=>{let e=l.current;if(!m||!e||!u.current||!c.current)return;c.current.clearLayers();let i=[];if(r.forEach(r=>{e.marker([r.lat,r.lng]).addTo(c.current).bindPopup(r.popupText),i.push([r.lat,r.lng])}),n){let{lat:r,lng:a}=n,l=e.circleMarker([r,a],{radius:8,weight:2,color:"#b91c1c",fillColor:"#ef4444",fillOpacity:1,pane:"currentLocation"}).addTo(c.current);n.popupText&&l.bindPopup(n.popupText),i.push([r,a])}if(!g.current&&i.length>0){let r=e.latLngBounds(i).pad(.015);r.isValid()&&u.current.fitBounds(r,{padding:[8,8]}),g.current=!0}},[r,n,m]),(0,s.useEffect)(()=>{let e=l.current,r=u.current;if(m&&e&&r&&i){if("fitAll"===i){let n=[];d.current.forEach(e=>n.push([e.lat,e.lng]));let i=h.current;if(i&&n.push([i.lat,i.lng]),n.length>0){let i=e.latLngBounds(n).pad(.015);i.isValid()&&r.fitBounds(i,{padding:[8,8]})}}else if("fitCurrent"===i){let n=h.current;if(!n)return;let i=e.latLng(n.lat,n.lng).toBounds(1e5);r.fitBounds(i,{padding:[8,8]})}}},[i,m]),(0,o.jsx)("div",{ref:a,style:{height:"400px",width:"100%"}})};function ev({categoryId:e}){let{t:r}=(0,c.useI18n)(),[n,i]=function(e,r){let[n,i]=(0,s.useState)(r);return(0,s.useEffect)(()=>{try{let r=localStorage.getItem(e);"1"===r&&i(!0),"0"===r&&i(!1)}catch{}},[e]),(0,s.useEffect)(()=>{try{localStorage.setItem(e,n?"1":"0")}catch{}},[e,n]),[n,i]}(`cb_open_${e}`,!1),[a,l]=(0,s.useState)(!1),{places:u,loading:d}=function(e){let[r,n]=(0,s.useState)([]),[i,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{let{data:e,error:r}=await w.supabase.from("items").select("place").eq("user_id",(await w.supabase.auth.getUser()).data.user?.id).not("place","is",null).neq("place","");if(r)throw r;let i=Array.from(new Set(e.map(e=>e.place))),a=await Promise.all(i.map(async e=>{try{let r=new URL("https://photon.komoot.io/api/");r.searchParams.set("q",e),r.searchParams.set("limit","1");let n=await fetch(r.toString());if(!n.ok)return null;let i=await n.json();if(i.features&&i.features.length>0){let[r,n]=i.features[0].geometry.coordinates;return{name:e,lat:n,lng:r}}return null}catch{return null}}));n(a.filter(e=>null!==e))}catch{n([])}finally{a(!1)}})()},[e]),{places:r,loading:i}}(e),[h,m]=(0,s.useState)("fitAll"),[p,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!a||!navigator.geolocation)return;let e=!1;navigator.geolocation.getCurrentPosition(r=>{e||g({lat:r.coords.latitude,lng:r.coords.longitude})},()=>{},{enableHighAccuracy:!0,timeout:12e3,maximumAge:0});let r=navigator.geolocation.watchPosition(r=>{e||g({lat:r.coords.latitude,lng:r.coords.longitude})},()=>{},{enableHighAccuracy:!0,timeout:2e4,maximumAge:0}),n=window.setTimeout(()=>{null!=r&&navigator.geolocation.clearWatch(r)},1e4);return()=>{e=!0,window.clearTimeout(n),null!=r&&navigator.geolocation.clearWatch(r)}},[a]);let[b,y]=(0,s.useState)(""),[x,v]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=setTimeout(()=>v(b.trim()),200);return()=>clearTimeout(e)},[b]);let{items:A,page:_,setPage:j,totalPages:C,reload:k,setItems:U}=function(e,r){let[n,i]=(0,s.useState)([]),[a,l]=(0,s.useState)(0),[o,u]=(0,s.useState)(1),[c,f]=(0,s.useState)(!1),d=(0,s.useRef)(0);(0,s.useEffect)(()=>u(1),[e,r]);let h=(0,s.useMemo)(()=>Math.ceil(a/6),[a]),m=(0,s.useCallback)(async()=>{let n=++d.current;f(!0);let a=(o-1)*6,s=r.trim(),u=w.supabase.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",e);if(s){let e=s.replace(/\\/g,"\\\\").replace(/[%_]/g,"\\$&"),r=`%${e}%`;u=u.or(`title.ilike.${r},description.ilike.${r},place.ilike.${r},tags_text.ilike.${r}`)}let{data:c,error:h,count:m}=await u.order("created_at",{ascending:!1}).range(a,a+6-1).returns();n!==d.current||(f(!1),h||(i((c??[]).map(e=>({id:e.id,title:e.title,description:e.description,place:e.place??null,tags:e.tags??[]}))),l(m||0)))},[e,o,r]);return(0,s.useEffect)(()=>{m()},[m]),{items:n,loading:c,page:o,setPage:u,totalPages:h,reload:m,setItems:i}}(e,x),S=(0,s.useCallback)(()=>{i(!1),k()},[i,k]),{images:F,refreshAllImages:N,uploadImage:R,deleteImage:O,busy:D,deletingPath:z}=function(){let{t:e}=(0,c.useI18n)(),[r,n]=(0,s.useState)(null),[i,a]=(0,s.useState)(null),[l,o]=(0,s.useState)({}),u=(0,s.useCallback)(async e=>{let{data:r}=await w.supabase.auth.getUser(),n=r.user?.id;if(!n)return;let i=`${n}/${e}`,{data:a,error:l}=await w.supabase.storage.from("item-images").list(i,{limit:48,sortBy:{column:"created_at",order:"desc"}});if(l)return console.error("Failed to list images",l),[];if(!a?.length)return[];let o=new Map;for(let e of a){let r=e.name,n=r.endsWith(".thumb.webp")?r.replace(/\.thumb\.webp$/,""):r.replace(/\.webp$/,""),i=o.get(n)??{};r.endsWith(".thumb.webp")?i.thumb={name:r}:(r.endsWith(".webp"),i.full={name:r}),o.set(n,i)}let s=new Map;for(let[e,{full:r,thumb:n}]of o){if(!r)continue;let a=`${i}/${r.name}`,l=n?`${i}/${n.name}`:void 0;s.set(e,{pathFull:a,pathThumb:l})}let u=Array.from(s.values()).flatMap(e=>e.pathThumb?[e.pathFull,e.pathThumb]:[e.pathFull]);if(0===u.length)return[];let{data:c,error:f}=await w.supabase.storage.from("item-images").createSignedUrls(u,3600);if(f)return console.error("Failed to create signed URLs",f),[];let d=new Map(c.map(e=>[e.path,e.signedUrl])),h=[];for(let e of s.values()){let r=d.get(e.pathFull);r&&h.push({pathFull:e.pathFull,urlFull:r,pathThumb:e.pathThumb,urlThumb:e.pathThumb?d.get(e.pathThumb):void 0})}return h},[]),f=(0,s.useCallback)(async e=>{let r=await u(e);void 0!==r&&o(n=>({...n,[e]:r}))},[u]),d=(0,s.useCallback)(async e=>{let r=(await Promise.all(e.map(async e=>{let r=await u(e);return[e,r]}))).filter(e=>void 0!==e[1]);if(r.length>0){let e=Object.fromEntries(r);o(r=>({...r,...e}))}},[u]),h=(0,s.useCallback)(async(r,i)=>{try{n(r);let{data:a}=await w.supabase.auth.getUser(),l=a.user?.id;if(!l)throw Error(e("item_list.no_user_session"));let o=await ep(i,{maxWidthOrHeight:1e3,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),s=await ep(i,{maxWidthOrHeight:250,initialQuality:.75,fileType:"image/webp",useWebWorker:!0}),u=crypto.randomUUID(),c=`${l}/${r}/${u}`,d=`${c}.webp`,h=`${c}.thumb.webp`,m=await w.supabase.storage.from("item-images").upload(d,o);if(m.error)throw m.error;let p=await w.supabase.storage.from("item-images").upload(h,s);p.error&&console.warn("Thumbnail upload failed:",p.error),await f(r)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{n(null)}},[f,e]);return{images:l,refreshItemImages:f,refreshAllImages:d,uploadImage:h,deleteImage:(0,s.useCallback)(async(e,r)=>{try{a(r.pathFull);let n=[r.pathFull,...r.pathThumb?[r.pathThumb]:[]],{error:i}=await w.supabase.storage.from("item-images").remove(n);if(i)return void alert(i.message);o(n=>({...n,[e]:(n[e]||[]).filter(e=>e.pathFull!==r.pathFull)}))}finally{a(null)}},[]),busy:r,deletingPath:i}}();(0,s.useEffect)(()=>{A.length&&N(A.map(e=>e.id))},[A,N]);let[Q,$]=(0,s.useState)(!1),[W,q]=(0,s.useState)(null),[H,G]=(0,s.useState)(!1),[K,V]=(0,s.useState)(null),X=async e=>{if(W&&!H){G(!0);try{let r={title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags},{error:n}=await w.supabase.from("items").update(r).eq("id",W.id);if(n)return void alert(n.message);U(e=>e.map(e=>e.id===W.id?{...e,...r}:e)),$(!1),q(null)}finally{G(!1)}}},Y=async e=>{confirm(r("item_list.confirm_delete"))&&(await w.supabase.from("items").delete().eq("id",e),await k())};return(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,o.jsx)("button",{type:"button",onClick:()=>i(!0),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r("item_create.new_entry"),title:r("item_create.new_entry"),children:(0,o.jsx)(f.default,{icon:f.IconType.Plus,className:"w-4 h-4"})}),(0,o.jsx)("button",{type:"button",onClick:()=>l(!0),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary/10 text-primary/80 shadow-sm hover:brightness-110","aria-label":r("item_list.open_map"),title:r("item_list.open_map"),children:(0,o.jsx)(f.default,{icon:f.IconType.Map,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),(0,o.jsx)("div",{className:"flex-1 min-w-[6rem] sm:min-w-[12rem]",children:(0,o.jsx)(T,{value:b,onChange:y})})]}),(0,o.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-2 gap-3",children:A.map(e=>(0,o.jsx)(B,{item:e,imgs:F[e.id]??[],busy:D===e.id,deletingPath:z,onUpload:r=>R(e.id,r),onEditItem:()=>{q({id:e.id,values:{title:e.title,description:e.description??"",place:e.place??"",tags:e.tags??[]}}),$(!0)},onDeleteItem:()=>void Y(e.id),onDeleteImage:r=>void O(e.id,r),onOpenModal:V,i18n:{t:r}},e.id))}),(0,o.jsx)(P,{page:_,setPage:j,totalPages:C}),(0,o.jsx)(L,{url:K,onClose:()=>V(null)}),(0,o.jsx)(I,{open:Q,onOpenChange:e=>{$(e),e||q(null)},title:r("item_list.edit_item"),closeLabel:r("common.close_x"),children:(0,o.jsx)("section",{className:"relative z-[50]",children:(0,o.jsx)(E,{initial:W?.values??{title:"",description:"",place:"",tags:[]},submitLabel:r("common.save"),submitting:H,onSubmit:X,onCancel:()=>{$(!1),q(null)},showIconSubmit:!0},W?.id)})}),(0,o.jsx)(I,{open:a,onOpenChange:l,title:r("item_list.map_title"),closeLabel:r("common.close_x"),children:d?(0,o.jsx)("p",{children:r("common.loading")}):a?(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)(ex,{command:h,markers:u.map(e=>({lat:e.lat,lng:e.lng,popupText:e.name})),currentLocation:p?{lat:p.lat,lng:p.lng,popupText:r("item_list.you_are_here")}:void 0}),(0,o.jsxs)("div",{className:"absolute top-2 right-2 z-[1000] bg-white/50 backdrop-blur rounded-lg flex gap-1 p-1",children:[(0,o.jsx)("button",{type:"button",onClick:()=>{p&&(m("fitCurrent"),setTimeout(()=>m(null),0))},className:"w-9 h-9 flex items-center justify-center rounded-lg bg-primary/10 text-primary/80 shadow-sm hover:brightness-110 disabled:opacity-50","aria-label":r("item_list.zoom_to_current_location"),title:r("item_list.zoom_to_current_location"),disabled:!p,children:(0,o.jsx)(f.default,{icon:f.IconType.Gps,className:"w-5 h-5"})}),(0,o.jsx)("button",{type:"button",onClick:()=>{m("fitAll"),setTimeout(()=>m(null),0)},className:"w-9 h-9 flex items-center justify-center rounded-lg bg-primary/10 text-primary/80 shadow-sm hover:brightness-110","aria-label":r("item_list.frame_all_pins"),title:r("item_list.frame_all_pins"),children:(0,o.jsx)(f.default,{icon:f.IconType.Frame,className:"w-5 h-5"})})]})]}):null}),(0,o.jsx)(I,{open:n,onOpenChange:i,title:r("item_create.new_entry"),closeLabel:r("common.close_x"),children:(0,o.jsx)(M,{categoryId:e,onCreated:S})})]})}var eA=e.i(16825);function e_(){let{user:e,loading:r}=function(){let[e,r]=(0,s.useState)(null),[n,i]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0;(async()=>{let{data:n}=await w.supabase.auth.getUser();if(!e)return;let a=n.user;r(a?{id:a.id,email:a.email??null,name:a.user_metadata?.name??null}:null),i(!1)})();let{data:n}=w.supabase.auth.onAuthStateChange((e,n)=>{let i=n?.user;r(i?{id:i.id,email:i.email??null,name:i.user_metadata?.name??null}:null)});return()=>{e=!1,n.subscription.unsubscribe()}},[]),{user:e,loading:n}}(),n=(0,u.useRouter)(),{t:i}=(0,c.useI18n)(),[a,l]=(0,s.useState)(null),f=(0,s.useCallback)(async()=>{try{let{error:e}=await w.supabase.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message)}catch(e){console.error("Unexpected error during sign-out:",e)}finally{n.replace("/login")}},[n]);if(r)return(0,o.jsx)(eA.default,{label:i("item_list.loading")});if(!e)return null;let d=!!a,h={...e,email:e.email??""};return(0,o.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,o.jsx)(A,{user:h,onSignOut:f}),(0,o.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,o.jsx)(x,{selectedCat:a,onSelect:l}),d?(0,o.jsxs)("section",{className:"relative z-50 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,o.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,o.jsx)("h2",{className:"text-base font-semibold",children:i("page.entries")})}),(0,o.jsx)(ev,{categoryId:a})]}):(0,o.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,o.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,o.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"🧺"}),(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold",children:i("page.choose_category")}),(0,o.jsx)("p",{className:"text-sm opacity-70",children:i("page.add_collectibles")})]})]})})]}),(0,o.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:i("page.footer")})]})}e.s(["default",()=>e_],52683)}]);