(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{101:(e,t,r)=>{"use strict";r.d(t,{g:()=>i,I18nProvider:()=>n});var a=r(5155),s=r(2115);let l={de:JSON.parse('{"page":{"entries":"Eintr\xe4ge","choose_category":"Kategorie w\xe4hlen","add_collectibles":"Dann kannst du neue Sammlerst\xfccke hinzuf\xfcgen und Bilder hochladen.","footer":"Sammeln • Ordnen • Behalten"},"header":{"title":"CollectionBuddy","sign_out":"Abmelden"},"category_select":{"title":"Kategorie","select_placeholder":"Kategorie w\xe4hlen oder erstellen","new_category":"Neue Kategorie","add":"Hinzuf\xfcgen","delete":"Kategorie l\xf6schen","confirm_delete":"Diese Kategorie wirklich l\xf6schen?","load_error":"Kategorien konnten nicht geladen werden.","create_error":"Kategorie konnte nicht erstellt werden.","delete_error":"Kategorie konnte nicht gel\xf6scht werden.","open_category":"Kategorie \xf6ffnen","set":"Festlegen","cancel":"Abbrechen"},"item_create":{"new_entry":"Neuer Eintrag","title":"Titel","description":"Beschreibung","place_placeholder":"Ort (z. B. K\xf6ln)","searching":"Suche…","no_results":"Keine Treffer","remove_tag":"Tag {tag} entfernen","tags_placeholder":"Tags eingeben… (Enter/Komma)","adding":"F\xfcge hinzu…","add":"Hinzuf\xfcgen"},"item_list":{"confirm_delete":"Diesen Gegenstand l\xf6schen?","delete":"L\xf6schen","no_user_session":"Keine Benutzersitzung","uploading":"Lade hoch…","add_image":"Bild hinzuf\xfcgen","image_alt":"Bild {idx}","loading":"Wird geladen…","no_images":"Keine Bilder","previous":"Zur\xfcck","next":"Weiter"},"google_sign_in_button":{"sign_in_with_google":"Mit Google anmelden"},"login_page":{"circle_text":"CollectionBuddy • Sammeln • Ordnen • Behalten • Deine Sch\xe4tze im Blick • ","checking_login":"Anmeldung wird gepr\xfcft…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Dein digitales Sammelalbum f\xfcr M\xfcnzen, Pl\xfcschtiere, Briefmarken und alles, was dir am Herzen liegt."},"layout":{"description":"Sammeln • Ordnen • Behalten"}}'),en:JSON.parse('{"page":{"entries":"Entries","choose_category":"Choose category","add_collectibles":"Then you can add new collectibles and upload pictures.","footer":"Collect • Organize • Keep"},"header":{"title":"CollectionBuddy","sign_out":"Sign out"},"category_select":{"title":"Category","select_placeholder":"Select or create category","new_category":"New category","add":"Add","delete":"Delete category","confirm_delete":"Really delete this category?","load_error":"Could not load categories.","create_error":"Could not create category.","delete_error":"Could not delete category.","open_category":"Open category","set":"Set","cancel":"Cancel"},"item_create":{"new_entry":"New entry","title":"Title","description":"Description","place_placeholder":"City (e.g. Cologne)","searching":"Searching…","no_results":"No results","remove_tag":"Remove tag {tag}","tags_placeholder":"Enter tags… (Enter/Comma)","adding":"Adding…","add":"Add"},"item_list":{"confirm_delete":"Delete this item?","delete":"Delete","no_user_session":"No user session","uploading":"Uploading…","add_image":"Add image","image_alt":"Image {idx}","loading":"Loading…","no_images":"No images","previous":"Previous","next":"Next"},"google_sign_in_button":{"sign_in_with_google":"Sign in with Google"},"login_page":{"circle_text":"CollectionBuddy • Collect • Organize • Keep • Your treasures at a glance • ","checking_login":"Checking login…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Your digital scrapbook for coins, stuffed animals, stamps and everything you love."},"layout":{"description":"Collect • Organize • Keep"}}')},i=(0,s.createContext)(void 0),n=e=>{let{children:t}=e,[r,n]=(0,s.useState)("de");(0,s.useEffect)(()=>{let e=navigator.language.split("-")[0];e in l&&n(e)},[]);let o=(0,s.useCallback)(e=>{let t=e.split("."),a=l[r];for(let r of t)if("object"!=typeof a||null===a||!(r in a))return e;else{let t=a[r];if("string"==typeof t)a=t;else{if("object"!=typeof t||null===t)return e;a=t}}return"string"==typeof a?a:e},[r]);return(0,a.jsx)(i.Provider,{value:{lang:r,setLang:n,t:o},children:t})}},2184:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(5155),s=r(5875);function l(e){let{label:t}=e,{t:r}=(0,s.s)();return(0,a.jsxs)("div",{className:"fixed inset-0 z-100 flex flex-col items-center justify-center gap-3 bg-black/60 backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"animate-spin h-8 w-8 rounded-full border-2 border-white/80 border-t-transparent"}),(0,a.jsx)("span",{className:"text-white text-lg font-medium",children:null!=t?t:r("item_list.loading")})]})}},5875:(e,t,r)=>{"use strict";r.d(t,{s:()=>l});var a=r(2115),s=r(101);let l=()=>{let e=(0,a.useContext)(s.g);if(!e)throw Error("useI18n must be used within an I18nProvider");return e}},5983:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(2354).UU)("https://mopbqdyfjvdfpffhetyf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vcGJxZHlmanZkZnBmZmhldHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MzQ2NDUsImV4cCI6MjA3MDQxMDY0NX0.qtzuwQn1QB3tOtN2u7mnEigMa2VBIyAxu_eU6cEXc68")},9109:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var a=r(5155),s=r(2115),l=r(5983),i=r(5695),n=r(2184),o=r(5875);function c(e){let{selectedCat:t,onSelect:r,sortedCats:s,isLoading:l,t:i,setExpanded:n}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;r(t),t&&n(!1)},disabled:l,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":i("category_select.select_placeholder"),children:[(0,a.jsx)("option",{value:"",children:i("category_select.select_placeholder")}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"▾"})]})}function d(e){let{name:t,setName:r,createCategory:s,setExpanded:l,t:i}=e;return(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:i("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&s(),"Escape"===e.key&&l(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}function u(e){let{onClick:t,disabled:r,isCreating:s,label:l}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center bg-primary text-primary-foreground hover:brightness-110 active:scale-[0.99] disabled:opacity-60",children:s?"…":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,a.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),(0,a.jsx)("span",{className:"hidden sm:inline",children:l})]})})}function m(e){let{onClick:t,label:r}=e;return(0,a.jsxs)("button",{onClick:t,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center border bg-card/60 dark:bg-card/70 hover:bg-primary/10 dark:hover:bg-primary/10",children:[(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M20 6L9 17l-5-5"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:r})]})}function g(e){let{title:t,name:r}=e;return(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,a.jsx)("div",{className:"font-medium truncate",children:r})]})}function h(e){let{onClick:t,disabled:r,label:s}=e;return(0,a.jsxs)("button",{onClick:t,disabled:r,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center border text-destructive border-destructive/40 bg-card/60 dark:bg-card/70 hover:bg-destructive/10 dark:hover:bg-destructive/10 disabled:opacity-60",children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M3 6h18"}),(0,a.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,a.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,a.jsx)("path",{d:"M10 11v6M14 11v6"})]}),(0,a.jsx)("span",{className:"hidden sm:inline",children:s})]})}function p(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"rounded-full w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center border bg-card/60 dark:bg-card/70 hover:bg-primary/10 dark:hover:bg-primary/10","aria-label":r,title:r,children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})})}function x(e){let{selectedCat:t,onSelect:r}=e,{t:i}=(0,o.s)(),[n,x]=(0,s.useState)([]),[f,b]=(0,s.useState)(""),[y,v]=(0,s.useState)(!1),[j,k]=(0,s.useState)(!1),[w,_]=(0,s.useState)(!1),[N,C]=(0,s.useState)(!t);(0,s.useEffect)(()=>{C(!t)},[t]);let S=(0,s.useMemo)(()=>[...n].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[n]),E=(0,s.useMemo)(()=>{var e;return t&&null!=(e=n.find(e=>e.id===t))?e:null},[n,t]),B=(0,s.useCallback)(async()=>{v(!0);try{let{data:e,error:t}=await l.N.from("categories").select("id,name");if(t)throw t;x(null!=e?e:[])}catch(e){console.error(e),alert(i("category_select.loadError"))}finally{v(!1)}},[i]);(0,s.useEffect)(()=>{B()},[B]);let z=async()=>{let e=f.trim();if(e&&!j){k(!0);try{let{data:t,error:a}=await l.N.from("categories").insert({name:e}).select("id,name").single();if(a)throw a;b(""),await B(),(null==t?void 0:t.id)&&(r(t.id),C(!1))}catch(e){console.error(e),alert(i("category_select.createError"))}finally{k(!1)}}},M=async()=>{if(t&&!w&&confirm(i("category_select.confirmDelete"))){_(!0);try{let{error:e}=await l.N.from("categories").delete().eq("id",t);if(e)throw e;r(null),await B(),C(!0)}catch(e){console.error(e),alert(i("category_select.deleteError"))}finally{_(!1)}}};return!N&&E?(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,a.jsx)(g,{title:i("category_select.title"),name:E.name}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(p,{onClick:()=>C(!0),label:i("category_select.open_category")})})]}):(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:i("category_select.title")}),(0,a.jsx)(c,{selectedCat:t,onSelect:r,sortedCats:S,isLoading:y,t:i,setExpanded:C}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{name:f,setName:b,createCategory:z,setExpanded:C,t:i}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&""!==t&&(0,a.jsx)(h,{onClick:M,disabled:w,label:i("category_select.delete")}),t&&""!==t&&""===f.trim()&&(0,a.jsx)(m,{onClick:()=>{C(!1),r(t)},label:i("category_select.set")}),(!t||""!==f.trim())&&(0,a.jsx)(u,{onClick:z,disabled:""===f.trim()||j,isCreating:j,label:i("category_select.add")})]})]})]})}function f(e){let{categoryId:t,onCreated:r}=e,[i,n]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[g,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)([]),[f,b]=(0,s.useState)(!1),[y,v]=(0,s.useState)(-1),j=(0,s.useRef)(null),k=(0,s.useRef)(null),w=(0,s.useRef)(null),[_,N]=(0,s.useState)([]),[C,S]=(0,s.useState)(""),[E,B]=(0,s.useState)(!1),{t:z}=(0,o.s)(),M=e=>N(t=>t.filter(t=>t!==e));(0,s.useEffect)(()=>{if(!g||u.trim().length<3){x([]),v(-1);return}let e=u.trim(),t=setTimeout(async()=>{try{var t;null==(t=j.current)||t.abort();let r=new AbortController;j.current=r,b(!0);let a=new URL("https://photon.komoot.io/api/");a.searchParams.set("q",e),a.searchParams.set("limit","5"),a.searchParams.set("lang","de");let s=await fetch(a.toString(),{signal:r.signal});if(!s.ok)throw Error("HTTP ".concat(s.status));let l=await s.json(),i=Array.from(new Map(l.features.map(e=>[e.properties.osm_id,e])).values());x(i),v(-1)}catch(e){x([]),v(-1)}finally{b(!1)}},300);return()=>clearTimeout(t)},[u,g]),(0,s.useEffect)(()=>{let e=e=>{k.current&&!k.current.contains(e.target)&&w.current&&!w.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let D=e=>{let t=e.properties,r=t.city||t.town||t.village||t.municipality||t.name;m((t.country?"".concat(r,", ").concat(t.country):r)||""),x([]),v(-1),h(!1)},L=(0,s.useCallback)(async()=>{let e=i.trim();if(e&&!E){B(!0);try{let{data:a,error:s}=await l.N.from("items").insert({title:e,description:c.trim()||null,place:u.trim()||null,tags:_}).select("id").single();if(s||!a)return;let{error:i}=await l.N.from("item_categories").insert({item_id:a.id,category_id:t});if(i)return;n(""),d(""),m(""),N([]),S(""),r()}finally{B(!1)}}},[i,c,u,_,t,E,r]),A=(0,s.useMemo)(()=>!!i.trim(),[i]);return(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur p-4 sm:p-5 shadow-sm space-y-3 z-70 relative",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-1",children:z("item_create.new_entry")}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsx)("input",{"aria-label":z("item_create.title"),value:i,onChange:e=>n(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),placeholder:z("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,a.jsx)("input",{"aria-label":z("item_create.description"),value:c,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),placeholder:z("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"relative",ref:k,children:[(0,a.jsx)("input",{ref:w,"aria-label":z("item_create.place_placeholder"),value:u,onChange:e=>{let t=e.target.value;m(t),""===t.trim()&&(x([]),v(-1),h(!0))},onFocus:()=>h(!0),onKeyDown:e=>{if(p.length)if("ArrowDown"===e.key)e.preventDefault(),v(e=>(e+1)%p.length);else if("ArrowUp"===e.key)e.preventDefault(),v(e=>e<=0?p.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=y>=0?p[y]:p[0];t&&D(t)}else"Escape"===e.key&&(x([]),v(-1),h(!1))},placeholder:z("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),g&&(f||p.length>0)&&(0,a.jsxs)("div",{className:"absolute mt-1 w-full rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden",children:[f&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:z("item_create.searching")}),!f&&p.map((e,t)=>{let r=e.properties,s=r.city||r.town||r.village||r.municipality||r.name,l=[r.state,r.country].filter(Boolean).join(", ");return(0,a.jsxs)("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>D(e),className:"block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ".concat(t===y?"bg-primary/10 dark:bg-primary/10":""),children:[(0,a.jsx)("div",{className:"font-medium",children:s}),(0,a.jsx)("div",{className:"opacity-70",children:l})]},r.osm_id)}),!f&&0===p.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:z("item_create.no_results")})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[_.map(e=>(0,a.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>M(e),className:"text-muted-foreground hover:text-foreground","aria-label":z("item_create.remove_tag").replace("{tag}",e),children:"\xd7"})]},e)),(0,a.jsx)("input",{value:C,onChange:e=>S(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=C.trim();!t||_.includes(t)||(N(e=>[...e,t]),S(""))}else"Backspace"===e.key&&!C&&_.length>0&&M(_[_.length-1])},placeholder:0===_.length?z("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:L,disabled:E||!A,className:"rounded-xl px-4 py-2 bg-primary text-primary-foreground hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center gap-2",children:E?z("item_create.adding"):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,a.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),(0,a.jsx)("span",{className:"hidden sm:inline",children:z("item_create.add")})]})})})]})}var b=r(6766),y=r(1802),v=r(7650);function j(e){let{categoryId:t}=e,[r,i]=(0,s.useState)([]),[n,c]=(0,s.useState)(1),[d,u]=(0,s.useState)(0),[m,g]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[x,f]=(0,s.useState)({}),[j,k]=(0,s.useState)(!1),{t:w}=(0,o.s)(),[_,N]=(0,s.useState)(null);(0,s.useEffect)(()=>{l.N.auth.getUser().then(e=>{var t,r;let{data:a}=e;return g(null!=(r=null==(t=a.user)?void 0:t.id)?r:null)})},[]),(0,s.useEffect)(()=>{c(1)},[t]);let C=(0,s.useCallback)(async()=>{k(!0);let e=(n-1)*6,{data:r,error:a,count:s}=await l.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",t).order("created_at",{ascending:!1}).range(e,e+6-1).returns();k(!1),a||(i((null!=r?r:[]).map(e=>{var t,r;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(r=e.tags)?r:[]}})),u(s||0))},[t,n]);(0,s.useEffect)(()=>{C()},[C]);let S=(0,s.useCallback)(async e=>{var t;let{data:r}=await l.N.auth.getUser(),a=null==(t=r.user)?void 0:t.id;if(!a)return;let s="".concat(a,"/").concat(e),{data:i,error:n}=await l.N.storage.from("item-images").list(s,{limit:12,sortBy:{column:"created_at",order:"desc"}});if(n)return;if(!(null==i?void 0:i.length))return void f(t=>({...t,[e]:[]}));let o=i.map(e=>"".concat(s,"/").concat(e.name)),c=await Promise.all(o.map(async e=>{let{data:t,error:r}=await l.N.storage.from("item-images").createSignedUrl(e,3600);return r?"":(null==t?void 0:t.signedUrl)||""}));f(t=>({...t,[e]:c.filter(Boolean)}))},[]),E=(0,s.useCallback)(async e=>{await Promise.all(e.map(e=>S(e)))},[S]);(0,s.useEffect)(()=>{r.length&&m&&E(r.map(e=>e.id))},[r,m,E]);let B=(0,s.useCallback)(async e=>{confirm(w("item_list.confirm_delete"))&&(await l.N.from("items").delete().eq("id",e),await C())},[C,w]),z=(0,s.useCallback)(async(e,t)=>{try{var r;p(e);let{data:a}=await l.N.auth.getUser(),s=null==(r=a.user)?void 0:r.id;if(!s)throw Error(w("item_list.no_user_session"));let i=await (0,y.A)(t,{maxWidthOrHeight:500,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),n="".concat(s,"/").concat(e,"/").concat(crypto.randomUUID(),"-").concat(i.name),{error:o}=await l.N.storage.from("item-images").upload(n,i);if(o)throw o;await S(e)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{p(null)}},[S,w]),M=(0,s.useMemo)(()=>Math.ceil(d/6),[d]);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(e=>{var t;return(0,a.jsxs)("li",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.title}),(0,a.jsxs)("button",{onClick:()=>B(e.id),className:"rounded-lg border px-2 py-1 text-destructive border-destructive/40 hover:bg-destructive/10 dark:hover:bg-destructive/10 flex items-center justify-center gap-2",children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M3 6h18"}),(0,a.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,a.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,a.jsx)("path",{d:"M10 11v6M14 11v6"})]}),(0,a.jsx)("span",{className:"hidden sm:inline",children:w("item_list.delete")})]})]}),e.description&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:e.description}),e.place&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true",children:[(0,a.jsx)("path",{d:"M12 21s-7-6.2-7-11a7 7 0 1 1 14 0c0 4.8-7 11-7 11z",fill:"none",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("circle",{cx:"12",cy:"10",r:"2",fill:"currentColor"})]}),(0,a.jsx)("span",{className:"truncate",children:e.place})]}),Array.isArray(e.tags)&&e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("label",{className:"inline-flex cursor-pointer items-center rounded-xl border px-3 py-2 hover:bg-primary/10 dark:hover:bg-primary/10 transition",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:!m||h===e.id,onChange:t=>{var r;let a=null==(r=t.target.files)?void 0:r[0];a&&(f(t=>({...t,[e.id]:[URL.createObjectURL(a),...t[e.id]||[]]})),z(e.id,a))}}),h===e.id?(0,a.jsx)("span",{className:"text-sm",children:w("item_list.uploading")}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M4 4h16v16H4z"}),(0,a.jsx)("path",{d:"M12 8v8M8 12h8"})]}),(0,a.jsx)("span",{className:"hidden sm:inline text-sm",children:w("item_list.add_image")})]})]})}),(null==(t=x[e.id])?void 0:t.length)?(0,a.jsx)("div",{className:"grid grid-cols-4 gap-2",children:x[e.id].map((e,t)=>(0,a.jsx)(b.default,{src:e,alt:w("item_list.image_alt").replace("{idx}","".concat(t+1)),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer",onClick:()=>N(e)},t))}):(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:j?w("item_list.loading"):w("item_list.no_images")})]},e.id)})}),M>1&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,a.jsx)("button",{disabled:1===n,onClick:()=>c(e=>e-1),className:"rounded-xl border px-3 py-1 disabled:opacity-50",children:w("item_list.previous")}),Array.from({length:M},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>c(e),className:"rounded-xl border px-3 py-1 min-w-9 "+(e===n?"bg-primary text-primary-foreground":"hover:bg-primary/10 dark:hover:bg-primary/10"),children:e},e)),(0,a.jsx)("button",{disabled:n===M,onClick:()=>c(e=>e+1),className:"rounded-xl border px-3 py-1 disabled:opacity-50",children:w("item_list.next")})]}),_&&(0,v.createPortal)((0,a.jsxs)("div",{className:"fixed inset-0 z-90 flex flex-col items-center justify-center bg-background/90",onClick:()=>N(null),children:[(0,a.jsx)(b.default,{src:_,alt:"Full size",unoptimized:!0,width:0,height:0,sizes:"100vw",className:"max-w-[500px] max-h-[500px] w-auto h-auto object-contain rounded-xl shadow-lg"}),(0,a.jsx)("button",{onClick:()=>N(null),className:"mt-4 w-10 h-10 flex items-center justify-center rounded-full bg-card text-card-foreground hover:bg-card/80 transition",children:"✕"})]}),document.body)]})}function k(e){let{user:t,onSignOut:r}=e,[l,i]=(0,s.useState)(!1),{t:n}=(0,o.s)();return(0,a.jsx)("header",{className:"sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,a.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(b.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:n("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,a.jsx)("span",{className:"font-semibold tracking-tight",children:n("header.title")})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>i(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",className:"w-5 h-5",children:[(0,a.jsx)("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,a.jsx)("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,a.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,a.jsx)("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),(0,a.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:t.email}),(0,a.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"▾"})]}),l&&(0,a.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,a.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:t.email}),(0,a.jsx)("button",{onClick:r,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",children:n("header.sign_out")})]})]})]})})}function w(){let{user:e,loading:t}=function(){let e=(0,i.useRouter)(),[t,r]=(0,s.useState)(null),[a,n]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0,t=t=>{var a;e&&(r(null!=(a=null==t?void 0:t.user)?a:null),n(!1))};(async()=>{try{let{data:e,error:r}=await l.N.auth.getSession();r?(console.error("Error fetching session:",r.message),t(null)):t(e.session)}catch(e){console.error("Unexpected error fetching session:",e),t(null)}})();let{data:a}=l.N.auth.onAuthStateChange((e,r)=>t(r));return()=>{e=!1,a.subscription.unsubscribe()}},[]),(0,s.useEffect)(()=>{a||t||(console.warn("Session invalid or expired. Redirecting to login."),e.replace("/login"))},[t,a,e]),{user:t,loading:a}}(),[r,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(0),{t:m}=(0,o.s)(),g=(0,i.useRouter)(),h=(0,s.useCallback)(async()=>{try{let{error:e}=await l.N.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message),setTimeout(()=>{g.replace("/login")},100)}catch(e){console.error("Unexpected error during sign-out:",e),g.replace("/login")}},[g]);return t?(0,a.jsx)(n.A,{}):e?(0,a.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,a.jsx)(k,{user:e,onSignOut:h}),(0,a.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,a.jsx)(x,{selectedCat:r,onSelect:c}),r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f,{categoryId:r,onCreated:()=>u(e=>e+1)}),(0,a.jsxs)("section",{className:"relative z-60 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-3",children:m("page.entries")}),(0,a.jsx)(j,{categoryId:r},d)]})]}):(0,a.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:m("page.choose_category")}),(0,a.jsx)("p",{className:"text-sm opacity-70",children:m("page.add_collectibles")})]})]})})]}),(0,a.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:m("page.footer")})]}):null}},9870:(e,t,r)=>{Promise.resolve().then(r.bind(r,9109))}},e=>{e.O(0,[192,145,441,964,358],()=>e(e.s=9870)),_N_E=e.O()}]);