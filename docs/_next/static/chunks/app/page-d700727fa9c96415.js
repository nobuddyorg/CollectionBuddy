(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6707:(e,t,a)=>{Promise.resolve().then(a.bind(a,8939))},8939:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var l=a(5155),r=a(2115);let s=(0,a(2354).UU)("https://mopbqdyfjvdfpffhetyf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vcGJxZHlmanZkZnBmZmhldHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MzQ2NDUsImV4cCI6MjA3MDQxMDY0NX0.qtzuwQn1QB3tOtN2u7mnEigMa2VBIyAxu_eU6cEXc68");function i(e){let{selectedCat:t,onSelect:a}=e,[i,n]=(0,r.useState)([]),[c,d]=(0,r.useState)("");(0,r.useEffect)(()=>{o()},[]);let o=async()=>{let{data:e,error:t}=await s.from("categories").select("id,name").order("name");if(t)throw t;n(e||[])},x=async()=>{if(!c.trim())return;let{data:e,error:t}=await s.from("categories").insert({name:c.trim()}).select("id").single();if(t)throw t;d(""),await o(),e&&a(e.id)},u=async e=>{confirm("Delete this category?")&&(await s.from("categories").delete().eq("id",e),a(null),await o())};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsxs)("select",{value:t||"",onChange:e=>a(e.target.value||null),className:"border rounded px-2 py-1 flex-1",children:[(0,l.jsx)("option",{value:"",children:"-- Select category --"}),i.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),t&&(0,l.jsx)("button",{onClick:()=>u(t),className:"px-3 py-1 rounded border border-red-500 text-red-500",children:"Delete"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{value:c,onChange:e=>d(e.target.value),placeholder:"New category",className:"border rounded px-2 py-1 flex-1"}),(0,l.jsx)("button",{onClick:x,className:"px-3 py-1 rounded bg-black text-white",children:"Add"})]})]})}function n(e){let{categoryId:t,onCreated:a}=e,[i,n]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[o,x]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),h=async()=>{if(!i.trim())return;let e=""!==o.trim()&&""!==u.trim()?"SRID=4326;POINT(".concat(Number(u)," ").concat(Number(o),")"):null,{data:l,error:r}=await s.from("items").insert({title:i.trim(),description:c.trim()||null,location:e}).select("id").single();if(r||!l)throw null!=r?r:Error("Insert returned no row");let h=l.id;await s.from("item_categories").insert({item_id:h,category_id:t}),n(""),d(""),x(""),m(""),a()};return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{value:i,onChange:e=>n(e.target.value),placeholder:"Title",className:"border rounded px-2 py-1 flex-1"}),(0,l.jsx)("input",{value:c,onChange:e=>d(e.target.value),placeholder:"Description",className:"border rounded px-2 py-1 flex-1"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{value:o,onChange:e=>x(e.target.value),placeholder:"Lat (optional)",className:"border rounded px-2 py-1 flex-1"}),(0,l.jsx)("input",{value:u,onChange:e=>m(e.target.value),placeholder:"Lng (optional)",className:"border rounded px-2 py-1 flex-1"})]}),(0,l.jsx)("button",{onClick:h,className:"px-3 py-1 rounded bg-black text-white",children:"Add"})]})}var c=a(6766);function d(e){let{categoryId:t}=e,[a,i]=(0,r.useState)([]),[n,d]=(0,r.useState)(1),[o,x]=(0,r.useState)(0),[u,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(null),[f,g]=(0,r.useState)({});(0,r.useEffect)(()=>{s.auth.getUser().then(e=>{var t,a;let{data:l}=e;return m(null!=(a=null==(t=l.user)?void 0:t.id)?a:null)})},[]);let y=(0,r.useCallback)(async()=>{let e=(n-1)*5,{data:a,error:l,count:r}=await s.from("items").select("id,title,description,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",t).order("created_at",{ascending:!1}).range(e,e+5-1).returns();if(l)throw l;i((null!=a?a:[]).map(e=>({id:e.id,title:e.title,description:e.description}))),x(r||0)},[t,n]);(0,r.useEffect)(()=>{y()},[y]);let j=(0,r.useCallback)(async e=>{var t;let{data:a}=await s.auth.getUser(),l=null==(t=a.user)?void 0:t.id;if(!l)return;let r="".concat(l,"/").concat(e),{data:i,error:n}=await s.storage.from("item-images").list(r,{limit:12,sortBy:{column:"created_at",order:"desc"}});if(n)return;if(!(null==i?void 0:i.length))return void g(t=>({...t,[e]:[]}));let c=i.map(e=>"".concat(r,"/").concat(e.name)),d=await Promise.all(c.map(async e=>{let{data:t,error:a}=await s.storage.from("item-images").createSignedUrl(e,3600);return a?"":(null==t?void 0:t.signedUrl)||""}));g(t=>({...t,[e]:d.filter(Boolean)}))},[]),b=(0,r.useCallback)(async e=>{await Promise.all(e.map(e=>j(e)))},[j]);(0,r.useEffect)(()=>{a.length&&u&&b(a.map(e=>e.id))},[a,u,b]);let v=async e=>{confirm("Delete this item?")&&(await s.from("items").delete().eq("id",e).throwOnError(),await y())},w=async(e,t)=>{try{var a;p(e);let{data:l}=await s.auth.getUser(),r=null==(a=l.user)?void 0:a.id;if(!r)throw Error("No user session");let i="".concat(r,"/").concat(e,"/").concat(crypto.randomUUID(),"-").concat(t.name),{error:n}=await s.storage.from("item-images").upload(i,t);if(n)throw n;await j(e)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{p(null)}},N=Math.ceil(o/5);return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("ul",{className:"space-y-3",children:a.map(e=>{var t;return(0,l.jsxs)("li",{className:"border rounded p-3 space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("div",{className:"font-medium",children:e.title}),(0,l.jsx)("button",{onClick:()=>v(e.id),className:"px-2 py-1 rounded border border-red-500 text-red-500",children:"Delete"})]}),(0,l.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,l.jsx)("input",{type:"file",accept:"image/*",disabled:!u||h===e.id,onChange:t=>{var a;let l=null==(a=t.target.files)?void 0:a[0];l&&(g(t=>({...t,[e.id]:[URL.createObjectURL(l),...t[e.id]||[]]})),w(e.id,l))}}),h===e.id&&(0,l.jsx)("span",{className:"text-sm",children:"Uploading…"})]}),(null==(t=f[e.id])?void 0:t.length)?(0,l.jsx)("div",{className:"grid grid-cols-4 gap-2",children:f[e.id].map((e,t)=>(0,l.jsx)(c.default,{src:e,alt:"",width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded"},t))}):(0,l.jsx)("div",{className:"text-sm opacity-60",children:"No images"})]},e.id)})}),N>1&&(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("button",{disabled:1===n,onClick:()=>d(e=>e-1),className:"px-2 py-1 rounded border disabled:opacity-50",children:"Prev"}),(0,l.jsxs)("span",{className:"text-sm",children:["Page ",n," / ",N]}),(0,l.jsx)("button",{disabled:n===N,onClick:()=>d(e=>e+1),className:"px-2 py-1 rounded border disabled:opacity-50",children:"Next"})]})]})}let o=["\uD83E\uDDF8","\uD83E\uDE99","\uD83D\uDCEE","\uD83C\uDF9F️","\uD83D\uDC8E","\uD83D\uDC1A","\uD83C\uDF81","\uD83C\uDF96️","\uD83E\uDDE9","\uD83D\uDCC0"],x=["#4285F4","#EA4335","#FBBC05","#34A853"];function u(e){let{onClick:t}=e,[a,s]=(0,r.useState)(!1),i=async()=>{s(!0);try{await t()}catch(e){s(!1),console.error("Sign in failed:",e)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{onClick:i,disabled:a,"aria-label":"Mit Google anmelden",className:"relative flex items-center rounded-md bg-white border border-[#747775] hover:bg-[#f8f9fa] active:bg-[#f1f3f4] px-4 h-12 shadow-sm hover:shadow-md transition-all duration-200 disabled:opacity-60 disabled:cursor-not-allowed dark:border-neutral-500",style:{fontFamily:"Roboto, sans-serif",fontWeight:500},children:[!a&&(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",className:"w-5 h-5 mr-3",children:[(0,l.jsx)("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,l.jsx)("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,l.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,l.jsx)("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),(0,l.jsx)("span",{className:"text-[#3c4043] text-sm",children:a?"Wird geladen...":"Mit Google anmelden"})]}),a&&(0,l.jsxs)("div",{className:"loading-overlay",children:[(0,l.jsx)("div",{className:"spinner text-white mb-4"}),(0,l.jsx)("span",{className:"text-white text-lg font-medium",children:"Wird geladen..."})]})]})}function m(e){let{delay:t,color:a,emoji:r,x:s,y:i}=e;return(0,l.jsx)("div",{className:"absolute collectible flex items-center justify-center rounded-full text-lg text-white/95 shadow",style:{width:"32px",height:"32px",backgroundColor:a,"--delay":"".concat(t,"s"),"--x":s,"--y":i},children:r})}function h(e){let{text:t,cta:a}=e;return(0,l.jsxs)("div",{className:"relative w-[340px] h-[340px] sm:w-[380px] sm:h-[380px]",children:[(0,l.jsxs)("svg",{viewBox:"0 0 380 380",className:"w-full h-full",children:[(0,l.jsx)("defs",{children:(0,l.jsx)("path",{id:"rimTextPath",d:"M190,190 m-160,0 a160,160 0 1,1 320,0 a160,160 0 1,1 -320,0"})}),(0,l.jsx)("circle",{cx:"190",cy:"190",r:"180",fill:"none",className:"stroke-neutral-300 dark:stroke-neutral-700",strokeWidth:"3",strokeDasharray:"6 4",opacity:"0.85"}),(0,l.jsx)("circle",{cx:"190",cy:"190",r:"160",fill:"none",className:"stroke-neutral-300 dark:stroke-neutral-700",strokeWidth:"1.5",strokeDasharray:"3 3",opacity:"0.6"}),(0,l.jsx)("text",{fontSize:"16",className:"fill-neutral-400 dark:fill-neutral-500",style:{letterSpacing:4,fontFamily:"'Courier New', monospace"},opacity:"0.9",children:(0,l.jsx)("textPath",{href:"#rimTextPath",startOffset:"50%",textAnchor:"middle",children:t})}),(0,l.jsxs)("g",{transform:"translate(190,140) scale(0.75)",fill:"none",strokeLinejoin:"round",strokeLinecap:"round",opacity:"0.9",className:"stroke-neutral-300 dark:stroke-neutral-700",children:[(0,l.jsx)("path",{d:"M-128 0 L0 -64 L128 0 Z"}),(0,l.jsx)("line",{x1:"-140",y1:"0",x2:"140",y2:"0"}),(0,l.jsx)("line",{x1:"-140",y1:"10",x2:"140",y2:"10"}),(0,l.jsx)("rect",{x:"-90",y:"10",width:"36",height:"120",rx:"4"}),(0,l.jsx)("rect",{x:"-18",y:"10",width:"36",height:"120",rx:"4"}),(0,l.jsx)("rect",{x:"54",y:"10",width:"36",height:"120",rx:"4"}),(0,l.jsx)("line",{x1:"-82",y1:"20",x2:"-82",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"-72",y1:"20",x2:"-72",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"-62",y1:"20",x2:"-62",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"-10",y1:"20",x2:"-10",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"0",y1:"20",x2:"0",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"10",y1:"20",x2:"10",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"62",y1:"20",x2:"62",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"72",y1:"20",x2:"72",y2:"122",opacity:".5"}),(0,l.jsx)("line",{x1:"82",y1:"20",x2:"82",y2:"122",opacity:".5"}),(0,l.jsx)("rect",{x:"-150",y:"132",width:"300",height:"22"}),(0,l.jsx)("rect",{x:"-160",y:"154",width:"320",height:"14"}),(0,l.jsx)("line",{x1:"-170",y1:"168",x2:"170",y2:"168"})]})]}),(0,l.jsx)("div",{className:"absolute inset-0 grid place-items-center",children:a})]})}function p(){let[e,t]=(0,r.useState)(null),[a,c]=(0,r.useState)(null),[p,f]=(0,r.useState)(0);(0,r.useEffect)(()=>{s.auth.getUser().then(e=>{var a;t(null!=(a=e.data.user)?a:null)});let{data:e}=s.auth.onAuthStateChange((e,a)=>{var l;t(null!=(l=null==a?void 0:a.user)?l:null)});return()=>e.subscription.unsubscribe()},[]);let g=(0,r.useMemo)(()=>(function(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1337,l=(t=a>>>0,()=>(t=1664525*t+0x3c6ef35f>>>0)/0x100000000);return Array.from({length:e},()=>({x:"".concat(520*l()-260,"px"),y:"".concat(520*l()-260,"px")}))})(16),[]);return e?(0,l.jsxs)("main",{className:"min-h-screen p-8 flex flex-col gap-8 max-w-2xl mx-auto bg-white text-neutral-900 dark:bg-neutral-950 dark:text-neutral-100",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"text-sm opacity-70",children:e.email}),(0,l.jsx)("button",{onClick:()=>s.auth.signOut(),className:"px-3 py-1 rounded border border-neutral-300 dark:border-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-900",children:"Sign out"})]}),(0,l.jsx)(i,{selectedCat:a,onSelect:c}),a&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n,{categoryId:a,onCreated:()=>f(e=>e+1)}),(0,l.jsx)(d,{categoryId:a},p)]})]}):(0,l.jsxs)("main",{className:"relative min-h-screen flex flex-col items-center justify-center overflow-hidden px-4 bg-white text-neutral-900 dark:bg-neutral-950 dark:text-neutral-100",children:[g.map((e,t)=>(0,l.jsx)(m,{delay:.35*t,color:x[t%x.length],emoji:o[t%o.length],x:e.x,y:e.y},t)),(0,l.jsxs)("h1",{className:"text-5xl sm:text-6xl font-extrabold tracking-tight mb-4",children:[(0,l.jsx)("span",{className:"text-neutral-900 dark:text-neutral-100",children:"Collection"}),(0,l.jsx)("span",{className:"text-neutral-500 dark:text-neutral-400",children:"Buddy"})]}),(0,l.jsx)("div",{className:"h-[3px] w-36 bg-gradient-to-r from-neutral-900 to-neutral-500 dark:from-neutral-100 dark:to-neutral-400 rounded-full mb-6"}),(0,l.jsx)(h,{text:"CollectionBuddy • Sammeln • Ordnen • Behalten • Deine Sch\xe4tze im Blick • ".repeat(2),cta:(0,l.jsx)(u,{onClick:()=>s.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin).concat(window.location.pathname)}})})}),(0,l.jsx)("p",{className:"fade-up mt-6 text-base sm:text-lg text-neutral-600 dark:text-neutral-300 text-center max-w-xl",children:"Dein digitales Sammelalbum f\xfcr M\xfcnzen, Pl\xfcschtiere, Briefmarken und alles, was dir am Herzen liegt."})]})}}},e=>{e.O(0,[91,441,964,358],()=>e(e.s=6707)),_N_E=e.O()}]);