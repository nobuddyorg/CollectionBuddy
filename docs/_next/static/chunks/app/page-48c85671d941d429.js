(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9834:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>z});var a=r(5155),l=r(2115),s=r(5695),n=r(2653),i=r(4426);function o(e){let{onClick:t,disabled:r,isCreating:l,label:s}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:s,children:l?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):"+"})}function c(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110",title:r,children:(0,a.jsx)(i.Ay,{icon:i.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}function d(e){let{onClick:t,disabled:r,label:l}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-red-500 text-white hover:bg-red-600 disabled:opacity-50",title:l,children:(0,a.jsx)(i.Ay,{icon:i.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function u(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"rounded-xl w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r,title:r,children:(0,a.jsx)(i.Ay,{icon:i.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function m(e){let{title:t,name:r}=e;return(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,a.jsx)("div",{className:"font-medium truncate",children:r})]})}function h(e){let{selectedCat:t,onSelect:r,sortedCats:l,isLoading:s,t:n,setExpanded:i}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;r(t),t&&i(!1)},disabled:s,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":n("category_select.select_placeholder"),children:[(0,a.jsx)("option",{value:"",children:n("category_select.select_placeholder")}),l.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"â–¾"})]})}function p(e){let{name:t,setName:r,createCategory:l,setExpanded:s,t:n}=e;return(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:n("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&l(),"Escape"===e.key&&s(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}var f=r(7243);function x(e){let{selectedCat:t,onSelect:r}=e,{t:s}=(0,n.s)(),{cats:i,isLoading:x,isCreating:b,isDeleting:g,createCategory:y,deleteCategory:w,reload:v}=function(){let{t:e}=(0,n.s)(),[t,r]=(0,l.useState)([]),[a,s]=(0,l.useState)(!1),[i,o]=(0,l.useState)(!1),[c,d]=(0,l.useState)(!1),u=(0,l.useCallback)(async()=>{s(!0);try{let{data:e,error:t}=await f.N.from("categories").select("id,name");if(t)throw t;let a=null!=e?e:[];return r(a),a}catch(t){return console.error(t),alert(e("category_select.loadError")),[]}finally{s(!1)}},[e]),m=(0,l.useCallback)(async t=>{if(!t||i)return null;o(!0);try{let{data:e,error:r}=await f.N.from("categories").insert({name:t}).select("id,name").single();if(r)throw r;return await u(),e}catch(t){return console.error(t),alert(e("category_select.createError")),null}finally{o(!1)}},[u,e,i]),h=(0,l.useCallback)(async t=>{if(!t||c)return!1;d(!0);try{let{error:e}=await f.N.from("categories").delete().eq("id",t);if(e)throw e;return await u(),!0}catch(t){return console.error(t),alert(e("category_select.deleteError")),!1}finally{d(!1)}},[u,e,c]);return{cats:t,isLoading:a,isCreating:i,isDeleting:c,reload:u,createCategory:m,deleteCategory:h}}(),[j,k]=(0,l.useState)(""),[N,C]=(0,l.useState)(!t);(0,l.useEffect)(()=>{C(!t)},[t]),(0,l.useEffect)(()=>{v().then(e=>{1===e.length&&(r(e[0].id),C(!1))})},[v,r]);let _=(0,l.useMemo)(()=>[...i].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[i]),S=(0,l.useMemo)(()=>{var e;return t&&null!=(e=i.find(e=>e.id===t))?e:null},[i,t]),A=(0,l.useCallback)(async()=>{let e=j.trim();if(!e)return;let t=await y(e);(null==t?void 0:t.id)&&(k(""),r(t.id),C(!1))},[j,y,r]),E=(0,l.useCallback)(async()=>{t&&confirm(s("category_select.confirmDelete"))&&await w(t)&&(r(null),C(!0))},[t,w,r,s]);return!N&&S?(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,a.jsx)(m,{title:s("category_select.title"),name:S.name}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(u,{onClick:()=>C(!0),label:s("category_select.open_category")})})]}):(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:s("category_select.title")}),(0,a.jsx)(h,{selectedCat:t,onSelect:r,sortedCats:_,isLoading:x,t:s,setExpanded:C}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(p,{name:j,setName:k,createCategory:A,setExpanded:C,t:s}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&(0,a.jsx)(d,{onClick:E,disabled:g,label:s("category_select.delete")}),t&&""===j.trim()&&(0,a.jsx)(c,{onClick:()=>{C(!1),r(t)},label:s("category_select.set")}),(!t||""!==j.trim())&&(0,a.jsx)(o,{onClick:A,disabled:""===j.trim()||b,isCreating:b,label:s("category_select.add")})]})]})]})}function b(e){let{open:t,onClick:r}=e;return(0,a.jsx)("div",{className:"fixed inset-0 z-[500] bg-black/40 backdrop-blur-sm transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),onClick:r})}function g(e){return e?Array.from(e.querySelectorAll('a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex="-1"])')):[]}function y(e){let{open:t,title:r,closeLabel:s,onClose:n,children:i,initialFocusRef:o}=e,c=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e,r;if(!t)return;let a=null!=(r=null==o?void 0:o.current)?r:g(c.current)[0];null==a||null==(e=a.focus)||e.call(a)},[t,o]),(0,l.useEffect)(()=>{if(!t)return;let e=e=>{if("Tab"!==e.key)return;let t=g(c.current);if(0===t.length)return;let r=t[0],a=t[t.length-1],l=document.activeElement;e.shiftKey&&l===r?(e.preventDefault(),a.focus()):e.shiftKey||l!==a||(e.preventDefault(),r.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t]),(0,a.jsx)("div",{className:"fixed inset-0 z-[600] flex items-center justify-center p-4 transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!t,children:(0,a.jsxs)("div",{ref:c,role:"dialog","aria-modal":"true","aria-labelledby":"centered-modal-title",className:"bg-background rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90dvh] flex flex-col overflow-hidden outline-none",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,a.jsx)("h3",{id:"centered-modal-title",className:"text-base font-semibold",children:r}),(0,a.jsx)("button",{className:"rounded-md px-3 py-1 text-sm border",onClick:n,"aria-label":null!=s?s:"Close",children:null!=s?s:"Close"})]}),(0,a.jsx)("div",{className:"p-4 overflow-auto",children:i})]})})}var w=r(7650);function v(e){let{children:t}=e;return"undefined"==typeof document?null:w.createPortal(t,document.body)}function j(e){var t,r;let{open:s,onOpenChange:n,title:i,closeLabel:o="Close",children:c,closeOnBackdrop:d=!0,closeOnEsc:u=!0,initialFocusRef:m}=e;return((0,l.useEffect)(()=>{if(!s||"undefined"==typeof document)return;let{body:e}=document,t=e.style.overflow;return e.style.overflow="hidden",()=>{e.style.overflow=t}},[s]),t=s&&u,r=()=>n(!1),(0,l.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,r]),"undefined"==typeof document)?null:(0,a.jsxs)(v,{children:[(0,a.jsx)(b,{open:s,onClick:d?()=>n(!1):void 0}),(0,a.jsx)(y,{open:s,title:i,closeLabel:o,onClose:()=>n(!1),initialFocusRef:m,children:c})]})}var k=r(6766);function N(e){var t;let{user:r,onSignOut:s}=e,[o,c]=(0,l.useState)(!1),{t:d}=(0,n.s)(),u=null!=(t=r.email)?t:"";return(0,a.jsx)("header",{className:"sticky top-0 z-[400] backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,a.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:d("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,a.jsx)("span",{className:"font-semibold tracking-tight",children:d("header.title")})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>c(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition","aria-haspopup":"menu","aria-expanded":o?"true":"false",title:u||d("header.title"),children:[(0,a.jsx)(i.Ay,{icon:i.AT.Google,className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:u}),(0,a.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"â–¾"})]}),o&&(0,a.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,a.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:u}),(0,a.jsx)("button",{onClick:s,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",role:"menuitem",children:d("header.sign_out")})]})]})]})})}function C(e){let{value:t,onChange:r}=e,{t:s,lang:i}=(0,n.s)(),{setQuery:o,focus:c,setFocus:d,results:u,loading:m,activeIdx:h,dropdownRef:p,inputRef:f,menuRef:x,choose:b,onKeyDown:g}=function(e){let[t,r]=(0,l.useState)(""),[a,s]=(0,l.useState)(!1),[n,i]=(0,l.useState)([]),[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(-1),m=(0,l.useRef)(null),h=(0,l.useRef)(null),p=(0,l.useRef)(null),f=(0,l.useRef)(null),x=(0,l.useMemo)(()=>"de"===e?"de":"en",[e]),b=Intl.DisplayNames,g=(0,l.useMemo)(()=>b?new b([x],{type:"region"}):null,[b,x]),y=(0,l.useCallback)(e=>{let t=e.city||e.town||e.village||e.municipality||e.name||"",r=e.country||(e.countrycode&&g?g.of(e.countrycode.toUpperCase()):void 0),a=[e.state,r].filter(Boolean).join(", "),l="".concat(t,"|||").concat(a).toLowerCase().replace(/\s+/g," ").trim();return{city:t,line2:a,key:l}},[g]);(0,l.useEffect)(()=>{if(!a||t.trim().length<3){i([]),u(-1);return}let e=t.trim(),r=setTimeout(async()=>{try{var t;null==(t=m.current)||t.abort();let r=new AbortController;m.current=r,c(!0);let a=new URL("https://photon.komoot.io/api/");a.searchParams.set("q",e),a.searchParams.set("limit","5"),a.searchParams.set("lang",x);let l=await fetch(a.toString(),{signal:r.signal});if(!l.ok)throw Error("HTTP ".concat(l.status));let s=await l.json(),n=Array.from(new Map(s.features.map(e=>[e.properties.osm_id,e])).values()),o=new Set,d=[];for(let e of n){let{key:t}=y(e.properties);o.has(t)||(o.add(t),d.push(e))}i(d),u(-1)}catch(e){i([]),u(-1)}finally{c(!1)}},300);return()=>clearTimeout(r)},[t,a,x,y]),(0,l.useEffect)(()=>{let e=e=>{var t,r,a;let l=e.target,n=null==(t=p.current)?void 0:t.contains(l),i=null==(r=h.current)?void 0:r.contains(l),o=null==(a=f.current)?void 0:a.contains(l);n||i||o||s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let w=(0,l.useCallback)(e=>{let{city:t,line2:r}=y(e.properties),a=r.split(", ").pop()||"",l=a?"".concat(t,", ").concat(a):t;return i([]),u(-1),s(!1),l},[y]),v=(0,l.useCallback)(e=>{if(n.length)if("ArrowDown"===e.key)e.preventDefault(),u(e=>(e+1)%n.length);else if("ArrowUp"===e.key)e.preventDefault(),u(e=>e<=0?n.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=d>=0?n[d]:n[0];if(t)return w(t)}else"Escape"===e.key&&(i([]),u(-1),s(!1))},[n,d,w]);return{query:t,setQuery:r,focus:a,setFocus:s,results:n,loading:o,activeIdx:d,setActiveIdx:u,dropdownRef:h,inputRef:p,menuRef:f,choose:w,onKeyDown:v,formatDisplay:y}}(i);return(0,l.useEffect)(()=>{o(t)},[t,o]),(0,a.jsxs)("div",{className:"relative",ref:p,children:[(0,a.jsx)("input",{ref:f,"aria-label":s("item_create.place_placeholder"),value:t,onChange:e=>{let t=e.target.value;r(t),t.trim().length<3?d(!1):d(!0)},onFocus:()=>{t.trim().length>=3&&d(!0)},onKeyDown:e=>{let t=g(e);"string"==typeof t&&(r(t),d(!1))},placeholder:s("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),c&&(m||u.length>0)&&w.createPortal((()=>{var e;let t=null==(e=f.current)?void 0:e.getBoundingClientRect();return t?(0,a.jsxs)("div",{ref:x,className:"fixed rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden z-[2000]",style:{top:t.bottom,left:t.left,width:t.width},children:[m&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:s("item_create.searching")}),!m&&u.map((e,t)=>{let l=e.properties,s=l.city||l.town||l.village||l.municipality||l.name,n=[l.state,l.country].filter(Boolean).join(", ");return(0,a.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{r(b(e)),d(!1)},className:"block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ".concat(t===h?"bg-primary/10 dark:bg-primary/10":""),children:[(0,a.jsx)("div",{className:"font-medium",children:s}),(0,a.jsx)("div",{className:"opacity-70",children:n})]},l.osm_id)}),!m&&0===u.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:s("item_create.no_results")})]}):null})(),document.body)]})}function _(e){let{submitting:t,disabled:r,label:l,iconMode:s,onClick:n}=e;return s?(0,a.jsx)("button",{type:"button",disabled:r,onClick:n,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:l,children:t?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,a.jsx)(i.Ay,{icon:i.AT.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,a.jsx)("button",{type:"button",disabled:r,onClick:n,className:"h-9 px-3 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-60",children:l})}function S(e){let{tags:t,setTags:r}=e,{t:s}=(0,n.s)(),[o,c]=(0,l.useState)(""),d=(0,l.useCallback)(()=>{let e=o.trim();!e||t.includes(e)||(r([...t,e]),c(""))},[o,t,r]),u=(0,l.useCallback)(e=>r(t.filter(t=>t!==e)),[t,r]);return(0,a.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[t.map(e=>(0,a.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>u(e),className:"w-4 h-4 flex items-center justify-center rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600",title:s("item_create.remove_tag").replace("{tag}",e),children:(0,a.jsx)(i.Ay,{icon:i.AT.Close,className:"w-3 h-3",stroke:"currentColor",strokeWidth:"3",fill:"none"})})]},e)),(0,a.jsx)("input",{value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key||","===e.key?(e.preventDefault(),d()):"Backspace"===e.key&&!o&&t.length>0&&u(t[t.length-1])},placeholder:0===t.length?s("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})}function A(e){var t,r,s,o;let{initial:c,submitting:d=!1,submitLabel:u,onSubmit:m,onCancel:h,showIconSubmit:p=!1}=e,{t:f}=(0,n.s)(),[x,b]=(0,l.useState)(null!=(t=c.title)?t:""),[g,y]=(0,l.useState)(null!=(r=c.description)?r:""),[w,v]=(0,l.useState)(null!=(s=c.place)?s:""),[j,k]=(0,l.useState)(null!=(o=c.tags)?o:[]);(0,l.useEffect)(()=>{var e,t,r,a;b(null!=(e=c.title)?e:""),y(null!=(t=c.description)?t:""),v(null!=(r=c.place)?r:""),k(null!=(a=c.tags)?a:[])},[c]);let N=(0,l.useMemo)(()=>!!x.trim(),[x]),A="function"==typeof h,E=(0,l.useCallback)(()=>{N&&m({title:x,description:g,place:w,tags:j})},[N,m,x,g,w,j]);return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsx)("input",{"aria-label":f("item_create.title"),value:x,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&N&&E(),placeholder:f("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,a.jsx)("input",{"aria-label":f("item_create.description"),value:g,onChange:e=>y(e.target.value),onKeyDown:e=>"Enter"===e.key&&N&&E(),placeholder:f("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsx)(C,{value:w,onChange:v}),(0,a.jsx)(S,{tags:j,setTags:k})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[h&&!p&&(0,a.jsx)("button",{type:"button",onClick:h,className:"h-9 px-3 rounded-xl border shadow-sm hover:bg-muted/50",children:f("item_list.close_modal")}),p?(0,a.jsx)("button",{type:"button",disabled:d||!N,onClick:E,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:u,children:d?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):A?(0,a.jsx)(i.Ay,{icon:i.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"}):(0,a.jsx)(i.Ay,{icon:i.AT.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,a.jsx)(_,{submitting:d,disabled:d||!N,label:u,iconMode:!1,onClick:E})]})]})}function E(e){let{categoryId:t,onCreated:r}=e,{t:s}=(0,n.s)(),[i,o]=(0,l.useState)(0),{create:c,isCreating:d}=function(e){let{t}=(0,n.s)(),[r,a]=(0,l.useState)(!1);return{create:(0,l.useCallback)(async l=>{if(r)return!1;let s=l.title.trim(),n=l.description.trim()||null,i=l.place.trim()||null,o=Array.isArray(l.tags)?l.tags:[];if(!s)return!1;a(!0);let c=null;try{let{data:t,error:r}=await f.N.from("items").insert({title:s,description:n,place:i,tags:o}).select("id").single();if(r||!t)throw null!=r?r:Error("insert failed");c=t.id;let{error:a}=await f.N.from("item_categories").insert({item_id:c,category_id:e});if(a)throw a;return!0}catch(e){return c&&await f.N.from("items").delete().eq("id",c),console.error(e),alert(t("item_list.no_user_session")),!1}finally{a(!1)}},[e,r,t]),isCreating:r}}(t),u=(0,l.useCallback)(async e=>{await c(e)&&(r(),o(e=>e+1))},[c,r]);return(0,a.jsx)("section",{className:"relative z-[70] p-4 sm:p-5 space-y-3",children:(0,a.jsx)(A,{initial:{title:"",description:"",place:"",tags:[]},submitting:d,submitLabel:s("item_create.add"),onSubmit:u,showIconSubmit:!0},i)})}function T(e){let{value:t,onChange:r}=e,{t:l}=(0,n.s)();return(0,a.jsxs)("div",{className:"relative flex w-full items-center",children:[(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:l("item_list.search_placeholder"),className:"w-full rounded-xl border bg-background py-2 pl-3 pr-10 shadow-sm"}),(0,a.jsx)("button",{onClick:()=>r(""),className:"clear-button absolute right-3 top-1/2 -translate-y-1/2","aria-label":l("item_list.search_clear"),children:(0,a.jsx)(i.In,{icon:i.AT.Close,className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})}function D(e){var t,r;let{page:l,setPage:s,totalPages:o}=e,{t:c}=(0,n.s)();return o<=1?null:(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,a.jsx)("button",{disabled:1===l,onClick:()=>s(l-1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:null!=(t=c("item_list.previous"))?t:"Previous",children:(0,a.jsx)(i.Ay,{icon:i.AT.ChevronLeft,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),Array.from({length:o},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>s(e),className:"min-w-9 h-9 px-2 flex items-center justify-center rounded-xl shadow-sm "+(e===l?"bg-primary text-primary-foreground":"bg-primary/60 text-primary-foreground hover:bg-primary"),"aria-current":e===l?"page":void 0,children:e},e)),(0,a.jsx)("button",{disabled:l===o,onClick:()=>s(l+1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:null!=(r=c("item_list.next"))?r:"Next",children:(0,a.jsx)(i.Ay,{icon:i.AT.ChevronRight,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function W(e){var t;let{isOpen:r,onClose:l,onUpload:s,busy:o,onEdit:c,onDelete:d}=e,{t:u}=(0,n.s)();return(0,a.jsxs)("div",{className:["absolute top-3 right-3 flex items-center gap-2 transition-opacity",r?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none","sm:opacity-0 sm:pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto"].join(" "),children:[(0,a.jsx)("button",{className:"sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-card border text-foreground shadow",onClick:l,"aria-label":null!=(t=u("common.close"))?t:"Close",children:(0,a.jsx)(i.Ay,{icon:i.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none","aria-hidden":"true"})}),(0,a.jsxs)("label",{className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 transition cursor-pointer",title:u("item_list.add_image"),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:o,onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];r&&s(r),l()}}),o?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-primary-foreground/40 border-t-primary-foreground rounded-full animate-spin"}):(0,a.jsx)(i.Ay,{icon:i.AT.Add,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),(0,a.jsx)("button",{onClick:()=>{c(),l()},className:"w-9 h-9 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 flex items-center justify-center",title:u("item_list.edit"),children:(0,a.jsx)(i.Ay,{icon:i.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),(0,a.jsx)("button",{onClick:()=>{d(),l()},className:"w-9 h-9 rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600 flex items-center justify-center",title:u("item_list.delete"),children:(0,a.jsx)(i.Ay,{icon:i.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function P(e){let{imgs:t,isOpen:r,onOpenModal:l,onDelete:s,deletingPath:o,busy:c}=e,{t:d}=(0,n.s)();return t.length?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:t.map(e=>(0,a.jsxs)("div",{className:"relative group",onClick:()=>l(e.urlFull),role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&l(e.urlFull)},children:[(0,a.jsx)(k.default,{src:e.urlThumb||e.urlFull,alt:d("item_list.image_alt").replace("{idx}",""),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer"}),(0,a.jsx)("button",{title:d("item_list.delete"),onClick:t=>{t.stopPropagation(),s(e)},disabled:o===e.pathFull||c,className:[r?"opacity-100":"opacity-0","sm:opacity-0 sm:group-hover:opacity-100 absolute top-1 right-1 w-7 h-7 flex items-center justify-center rounded-lg bg-red-600 text-white shadow disabled:opacity-60 transition"].join(" "),children:o===e.pathFull?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,a.jsx)(i.Ay,{icon:i.AT.Trash,className:"w-4 h-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]},e.pathFull))}):(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:d("item_list.no_images")})}function L(e){var t;let{item:r,imgs:s,busy:n,deletingPath:o,onUpload:c,onEditItem:d,onDeleteItem:u,onDeleteImage:m,onOpenModal:h,i18n:{t:p}}=e,[f,x]=(0,l.useState)(!1);return(0,a.jsxs)("li",{className:"group relative rounded-2xl border bg-card/70 dark:bg-card/60 bg-neutral-100/50 dark:bg-neutral-800/50 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,a.jsx)("div",{className:"font-medium pr-16 truncate",children:r.title}),(0,a.jsx)("button",{className:"absolute top-3 right-3 sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-muted text-foreground shadow ".concat(f?"hidden":""),onClick:()=>x(!0),"aria-label":null!=(t=p("item_list.more_actions"))?t:"More actions",children:(0,a.jsx)(i.Ay,{icon:i.AT.More,className:"w-5 h-5",fill:"currentColor","aria-hidden":"true"})}),(0,a.jsx)(W,{isOpen:f,onClose:()=>x(!1),onUpload:c,busy:n,onEdit:d,onDelete:u}),r.description&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:r.description}),r.place&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(i.Ay,{icon:i.AT.Pin,className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true"}),(0,a.jsx)("span",{className:"truncate",children:r.place})]}),!!r.tags.length&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:r.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(0,a.jsx)(P,{imgs:s,isOpen:f,onOpenModal:h,onDelete:m,deletingPath:o,busy:n})]})}function M(e){let{url:t,onClose:r}=e,{t:l}=(0,n.s)();return t&&"undefined"!=typeof document?w.createPortal((0,a.jsxs)("div",{className:"fixed inset-0 z-[500] flex flex-col items-center justify-center bg-background/90 backdrop-blur",onClick:r,children:[(0,a.jsx)(k.default,{src:t,alt:l("item_list.full_size_image_alt"),unoptimized:!0,width:0,height:0,sizes:"100vw",className:"w-auto h-auto max-w-full max-h-full object-contain rounded-xl shadow-lg"}),(0,a.jsx)("button",{className:"mt-4 w-10 h-10 flex items-center justify-center rounded-xl bg-card text-card-foreground hover:bg-card/80 transition",title:l("item_list.close_modal"),children:(0,a.jsx)(i.Ay,{icon:i.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]}),document.body):null}var U=r(1802);function I(e){var t;let{categoryId:r}=e,{t:s}=(0,n.s)(),[i,o]=(0,l.useState)(""),[c,d]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=setTimeout(()=>d(i.trim()),200);return()=>clearTimeout(e)},[i]);let{items:u,page:m,setPage:h,totalPages:p,reload:x,setItems:b}=function(e,t){let[r,a]=(0,l.useState)([]),[s,n]=(0,l.useState)(0),[i,o]=(0,l.useState)(1),[c,d]=(0,l.useState)(!1),u=(0,l.useRef)(0);(0,l.useEffect)(()=>o(1),[e,t]);let m=(0,l.useMemo)(()=>Math.ceil(s/6),[s]),h=(0,l.useCallback)(async()=>{let r=++u.current;d(!0);let l=(i-1)*6,s=t.trim(),o=f.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",e);if(s){let e=s.replace(/[%_]/g,"\\$&"),t="%".concat(e,"%");o=o.or("title.ilike.".concat(t,",description.ilike.").concat(t,",place.ilike.").concat(t,",tags_text.ilike.").concat(t))}let{data:c,error:m,count:h}=await o.order("created_at",{ascending:!1}).range(l,l+6-1).returns();r===u.current&&(d(!1),m||(a((null!=c?c:[]).map(e=>{var t,r;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(r=e.tags)?r:[]}})),n(h||0)))},[e,i,t]);return(0,l.useEffect)(()=>{h()},[h]),{items:r,loading:c,page:i,setPage:o,totalPages:m,reload:h,setItems:a}}(r,c),{images:g,refreshAllImages:y,uploadImage:w,deleteImage:v,busy:k,deletingPath:N}=function(){let{t:e}=(0,n.s)(),[t,r]=(0,l.useState)(null),[a,s]=(0,l.useState)(null),[i,o]=(0,l.useState)({}),c=(0,l.useCallback)(async e=>{var t,r,a,l;let{data:s}=await f.N.auth.getUser(),n=null==(t=s.user)?void 0:t.id;if(!n)return;let i="".concat(n,"/").concat(e),{data:c,error:d}=await f.N.storage.from("item-images").list(i,{limit:48,sortBy:{column:"created_at",order:"desc"}});if(d)return;if(!(null==c?void 0:c.length))return void o(t=>({...t,[e]:[]}));let u=new Map;for(let e of c){let t=e.name,a=t.endsWith(".thumb.webp")?t.replace(/\.thumb\.webp$/,""):t.replace(/\.webp$/,""),l=null!=(r=u.get(a))?r:{};t.endsWith(".thumb.webp")?l.thumb={name:t}:(t.endsWith(".webp"),l.full={name:t}),u.set(a,l)}let m=[];for(let[,{full:e,thumb:t}]of u){let r,s;if(!e)continue;let n="".concat(i,"/").concat(e.name),{data:o}=await f.N.storage.from("item-images").createSignedUrl(n,3600),c=null!=(a=null==o?void 0:o.signedUrl)?a:"";if(t){r="".concat(i,"/").concat(t.name);let{data:e}=await f.N.storage.from("item-images").createSignedUrl(r,3600);s=null!=(l=null==e?void 0:e.signedUrl)?l:void 0}m.push({pathFull:n,urlFull:c,pathThumb:r,urlThumb:s})}o(t=>({...t,[e]:m}))},[]),d=(0,l.useCallback)(async e=>{await Promise.all(e.map(c))},[c]),u=(0,l.useCallback)(async(t,a)=>{try{var l;r(t);let{data:s}=await f.N.auth.getUser(),n=null==(l=s.user)?void 0:l.id;if(!n)throw Error(e("item_list.no_user_session"));let i=await (0,U.A)(a,{maxWidthOrHeight:1e3,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),o=await (0,U.A)(a,{maxWidthOrHeight:250,initialQuality:.75,fileType:"image/webp",useWebWorker:!0}),d=crypto.randomUUID(),u="".concat(n,"/").concat(t,"/").concat(d),m=await f.N.storage.from("item-images").upload("".concat(u,".webp"),i);if(m.error)throw m.error;let h=await f.N.storage.from("item-images").upload("".concat(u,".thumb.webp"),o);h.error&&console.warn("Thumbnail upload failed:",h.error),await c(t)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{r(null)}},[c,e]);return{images:i,refreshItemImages:c,refreshAllImages:d,uploadImage:u,deleteImage:(0,l.useCallback)(async(e,t)=>{try{s(t.pathFull);let r=[t.pathFull,...t.pathThumb?[t.pathThumb]:[]],{error:a}=await f.N.storage.from("item-images").remove(r);if(a)return void alert(a.message);o(r=>({...r,[e]:(r[e]||[]).filter(e=>e.pathFull!==t.pathFull)}))}finally{s(null)}},[]),busy:t,deletingPath:a}}();(0,l.useEffect)(()=>{u.length&&y(u.map(e=>e.id))},[u,y]);let[C,_]=(0,l.useState)(!1),[S,E]=(0,l.useState)(null),[W,P]=(0,l.useState)(!1),[I,F]=(0,l.useState)(null),z=async e=>{if(S&&!W){P(!0);try{let t={title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags},{error:r}=await f.N.from("items").update(t).eq("id",S.id);if(r)return void alert(r.message);b(e=>e.map(e=>e.id===S.id?{...e,...t}:e)),_(!1),E(null)}finally{P(!1)}}},O=async e=>{confirm(s("item_list.confirm_delete"))&&(await f.N.from("items").delete().eq("id",e),await x())};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(T,{value:i,onChange:o}),(0,a.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-2 gap-3",children:u.map(e=>{var t;return(0,a.jsx)(L,{item:e,imgs:null!=(t=g[e.id])?t:[],busy:k===e.id,deletingPath:N,onUpload:t=>w(e.id,t),onEditItem:()=>{var t,r,a;E({id:e.id,values:{title:e.title,description:null!=(t=e.description)?t:"",place:null!=(r=e.place)?r:"",tags:null!=(a=e.tags)?a:[]}}),_(!0)},onDeleteItem:()=>void O(e.id),onDeleteImage:t=>void v(e.id,t),onOpenModal:F,i18n:{t:s}},e.id)})}),(0,a.jsx)(D,{page:m,setPage:h,totalPages:p}),(0,a.jsx)(M,{url:I,onClose:()=>F(null)}),(0,a.jsx)(j,{open:C,onOpenChange:e=>{_(e),e||E(null)},title:s("item_list.edit_item"),closeLabel:"X",children:(0,a.jsx)("section",{className:"relative z-[50]",children:(0,a.jsx)(A,{initial:null!=(t=null==S?void 0:S.values)?t:{title:"",description:"",place:"",tags:[]},submitLabel:s("common.save"),submitting:W,onSubmit:z,onCancel:()=>{_(!1),E(null)},showIconSubmit:!0},null==S?void 0:S.id)})})]})}var F=r(9669);function z(){let{user:e,loading:t}=function(){let[e,t]=(0,l.useState)(null),[r,a]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=!0;(async()=>{var r,l,s;let{data:n}=await f.N.auth.getUser();if(!e)return;let i=n.user;t(i?{id:i.id,email:null!=(l=i.email)?l:null,name:null!=(s=null==(r=i.user_metadata)?void 0:r.name)?s:null}:null),a(!1)})();let{data:r}=f.N.auth.onAuthStateChange((e,r)=>{var a,l,s;let n=null==r?void 0:r.user;t(n?{id:n.id,email:null!=(l=n.email)?l:null,name:null!=(s=null==(a=n.user_metadata)?void 0:a.name)?s:null}:null)});return()=>{e=!1,r.subscription.unsubscribe()}},[]),{user:e,loading:r}}(),r=(0,s.useRouter)(),{t:i}=(0,n.s)(),[o,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(0),[m,h]=function(e,t){let[r,a]=(0,l.useState)(t);return(0,l.useEffect)(()=>{try{let t=localStorage.getItem(e);"1"===t&&a(!0),"0"===t&&a(!1)}catch(e){}},[e]),(0,l.useEffect)(()=>{try{localStorage.setItem(e,r?"1":"0")}catch(e){}},[e,r]),[r,a]}(o?"cb_open_".concat(o):"cb_open_none",!1),p=(0,l.useCallback)(async()=>{try{let{error:e}=await f.N.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message)}catch(e){console.error("Unexpected error during sign-out:",e)}finally{r.replace("/login")}},[r]),b=(0,l.useCallback)(()=>{h(!1),u(e=>e+1)},[h]);if(t)return(0,a.jsx)(F.A,{label:i("item_list.loading")});if(!e)return null;let g=!!o;return(0,a.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,a.jsx)(N,{user:e,onSignOut:p}),(0,a.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,a.jsx)(x,{selectedCat:o,onSelect:c}),g?(0,a.jsxs)("section",{className:"relative z-50 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:i("page.entries")}),(0,a.jsx)("button",{onClick:()=>h(!0),className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":i("item_create.new_entry"),children:"+"})]}),(0,a.jsx)(I,{categoryId:o},d)]}):(0,a.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:i("page.choose_category")}),(0,a.jsx)("p",{className:"text-sm opacity-70",children:i("page.add_collectibles")})]})]})})]}),g&&(0,a.jsx)(j,{open:m,onOpenChange:h,title:i("item_create.new_entry"),closeLabel:"X",children:(0,a.jsx)(E,{categoryId:o,onCreated:b})}),(0,a.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:i("page.footer")})]})}},9870:(e,t,r)=>{Promise.resolve().then(r.bind(r,9834))}},e=>{e.O(0,[192,145,846,441,964,358],()=>e(e.s=9870)),_N_E=e.O()}]);