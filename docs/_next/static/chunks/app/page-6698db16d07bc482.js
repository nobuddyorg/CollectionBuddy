(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6707:(e,t,r)=>{Promise.resolve().then(r.bind(r,7099))},7099:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>K});var l=r(5155),a=r(2115),n=r(5695),i=r(2653),s=r(4426);function o(e){let{onClick:t,disabled:r,isCreating:a,label:n}=e;return(0,l.jsx)("button",{onClick:t,disabled:r,className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:n,children:a?(0,l.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):"+"})}function c(e){let{onClick:t,label:r}=e;return(0,l.jsx)("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110",title:r,children:(0,l.jsx)(s.Ay,{icon:s.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}function d(e){let{onClick:t,disabled:r,label:a}=e;return(0,l.jsx)("button",{onClick:t,disabled:r,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-red-500 text-white hover:bg-red-600 disabled:opacity-50",title:a,children:(0,l.jsx)(s.Ay,{icon:s.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function u(e){let{onClick:t,label:r}=e;return(0,l.jsx)("button",{onClick:t,className:"rounded-xl w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r,title:r,children:(0,l.jsx)(s.Ay,{icon:s.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function m(e){let{title:t,name:r}=e;return(0,l.jsxs)("div",{className:"truncate",children:[(0,l.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,l.jsx)("div",{className:"font-medium truncate",children:r})]})}function p(e){let{selectedCat:t,onSelect:r,sortedCats:a,isLoading:n,t:i,setExpanded:s}=e;return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;r(t),t&&s(!1)},disabled:n,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":i("category_select.select_placeholder"),children:[(0,l.jsx)("option",{value:"",children:i("category_select.select_placeholder")}),a.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"▾"})]})}function h(e){let{name:t,setName:r,createCategory:a,setExpanded:n,t:i}=e;return(0,l.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:i("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&a(),"Escape"===e.key&&n(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}var f=r(7243);function g(e){let{selectedCat:t,onSelect:r}=e,{t:n}=(0,i.s)(),{cats:s,isLoading:g,isCreating:x,isDeleting:b,createCategory:y,deleteCategory:w,reload:v}=function(){let{t:e}=(0,i.s)(),[t,r]=(0,a.useState)([]),[l,n]=(0,a.useState)(!1),[s,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),u=(0,a.useCallback)(async()=>{n(!0);try{let{data:e,error:t}=await f.N.from("categories").select("id,name");if(t)throw t;let l=null!=e?e:[];return r(l),l}catch(t){return console.error(t),alert(e("category_select.loadError")),[]}finally{n(!1)}},[e]),m=(0,a.useCallback)(async t=>{if(!t||s)return null;o(!0);try{let{data:e,error:r}=await f.N.from("categories").insert({name:t}).select("id,name").single();if(r)throw r;return await u(),e}catch(t){return console.error(t),alert(e("category_select.createError")),null}finally{o(!1)}},[u,e,s]),p=(0,a.useCallback)(async t=>{if(!t||c)return!1;d(!0);try{let{error:e}=await f.N.from("categories").delete().eq("id",t);if(e)throw e;return await u(),!0}catch(t){return console.error(t),alert(e("category_select.deleteError")),!1}finally{d(!1)}},[u,e,c]);return{cats:t,isLoading:l,isCreating:s,isDeleting:c,reload:u,createCategory:m,deleteCategory:p}}(),[j,k]=(0,a.useState)(""),[N,_]=(0,a.useState)(!t);(0,a.useEffect)(()=>{_(!t)},[t]),(0,a.useEffect)(()=>{v().then(e=>{1===e.length&&(r(e[0].id),_(!1))})},[v,r]);let C=(0,a.useMemo)(()=>[...s].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[s]),A=(0,a.useMemo)(()=>{var e;return t&&null!=(e=s.find(e=>e.id===t))?e:null},[s,t]),S=(0,a.useCallback)(async()=>{let e=j.trim();if(!e)return;let t=await y(e);(null==t?void 0:t.id)&&(k(""),r(t.id),_(!1))},[j,y,r]),E=(0,a.useCallback)(async()=>{t&&confirm(n("category_select.confirmDelete"))&&await w(t)&&(r(null),_(!0))},[t,w,r,n]);return!N&&A?(0,l.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,l.jsx)(m,{title:n("category_select.title"),name:A.name}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(u,{onClick:()=>_(!0),label:n("category_select.open_category")})})]}):(0,l.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,l.jsx)("h2",{className:"text-base font-semibold",children:n("category_select.title")}),(0,l.jsx)(p,{selectedCat:t,onSelect:r,sortedCats:C,isLoading:g,t:n,setExpanded:_}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(h,{name:j,setName:k,createCategory:S,setExpanded:_,t:n}),(0,l.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&(0,l.jsx)(d,{onClick:E,disabled:b,label:n("category_select.delete")}),t&&""===j.trim()&&(0,l.jsx)(c,{onClick:()=>{_(!1),r(t)},label:n("category_select.set")}),(!t||""!==j.trim())&&(0,l.jsx)(o,{onClick:S,disabled:""===j.trim()||x,isCreating:x,label:n("category_select.add")})]})]})]})}var x=r(6766);function b(e){var t;let{user:r,onSignOut:n}=e,[o,c]=(0,a.useState)(!1),{t:d}=(0,i.s)(),u=null!=(t=r.email)?t:"";return(0,l.jsx)("header",{className:"sticky top-0 z-[400] backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,l.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(x.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:d("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,l.jsx)("span",{className:"font-semibold tracking-tight",children:d("header.title")})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("button",{onClick:()=>c(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition","aria-haspopup":"menu","aria-expanded":o?"true":"false",title:u||d("header.title"),children:[(0,l.jsx)(s.Ay,{icon:s.AT.Google,className:"w-5 h-5"}),(0,l.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:u}),(0,l.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"▾"})]}),o&&(0,l.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,l.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:u}),(0,l.jsx)("button",{onClick:n,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",role:"menuitem",children:d("header.sign_out")})]})]})]})})}var y=r(7650);function w(e){let{value:t,onChange:r}=e,{t:n,lang:s}=(0,i.s)(),{setQuery:o,focus:c,setFocus:d,results:u,loading:m,activeIdx:p,dropdownRef:h,inputRef:f,menuRef:g,choose:x,onKeyDown:b}=function(e){let[t,r]=(0,a.useState)(""),[l,n]=(0,a.useState)(!1),[i,s]=(0,a.useState)([]),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(-1),m=(0,a.useRef)(null),p=(0,a.useRef)(null),h=(0,a.useRef)(null),f=(0,a.useRef)(null),g=(0,a.useMemo)(()=>"de"===e?"de":"en",[e]),x=Intl.DisplayNames,b=(0,a.useMemo)(()=>x?new x([g],{type:"region"}):null,[x,g]),y=(0,a.useCallback)(e=>{let t=e.city||e.town||e.village||e.municipality||e.name||"",r=e.country||(e.countrycode&&b?b.of(e.countrycode.toUpperCase()):void 0),l=[e.state,r].filter(Boolean).join(", "),a="".concat(t,"|||").concat(l).toLowerCase().replace(/\s+/g," ").trim();return{city:t,line2:l,key:a}},[b]);(0,a.useEffect)(()=>{if(!l||t.trim().length<3){s([]),u(-1);return}let e=t.trim(),r=setTimeout(async()=>{try{var t;null==(t=m.current)||t.abort();let r=new AbortController;m.current=r,c(!0);let l=new URL("https://photon.komoot.io/api/");l.searchParams.set("q",e),l.searchParams.set("limit","5"),l.searchParams.set("lang",g);let a=await fetch(l.toString(),{signal:r.signal});if(!a.ok)throw Error("HTTP ".concat(a.status));let n=await a.json(),i=Array.from(new Map(n.features.map(e=>[e.properties.osm_id,e])).values()),o=new Set,d=[];for(let e of i){let{key:t}=y(e.properties);o.has(t)||(o.add(t),d.push(e))}s(d),u(-1)}catch(e){s([]),u(-1)}finally{c(!1)}},300);return()=>clearTimeout(r)},[t,l,g,y]),(0,a.useEffect)(()=>{let e=e=>{var t,r,l;let a=e.target,i=null==(t=h.current)?void 0:t.contains(a),s=null==(r=p.current)?void 0:r.contains(a),o=null==(l=f.current)?void 0:l.contains(a);i||s||o||n(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let w=(0,a.useCallback)(e=>{let{city:t,line2:r}=y(e.properties),l=r.split(", ").pop()||"",a=l?"".concat(t,", ").concat(l):t;return s([]),u(-1),n(!1),a},[y]),v=(0,a.useCallback)(e=>{if(i.length)if("ArrowDown"===e.key)e.preventDefault(),u(e=>(e+1)%i.length);else if("ArrowUp"===e.key)e.preventDefault(),u(e=>e<=0?i.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=d>=0?i[d]:i[0];if(t)return w(t)}else"Escape"===e.key&&(s([]),u(-1),n(!1))},[i,d,w]);return{query:t,setQuery:r,focus:l,setFocus:n,results:i,loading:o,activeIdx:d,setActiveIdx:u,dropdownRef:p,inputRef:h,menuRef:f,choose:w,onKeyDown:v,formatDisplay:y}}(s);return(0,a.useEffect)(()=>{o(t)},[t,o]),(0,l.jsxs)("div",{className:"relative",ref:h,children:[(0,l.jsx)("input",{ref:f,"aria-label":n("item_create.place_placeholder"),value:t,onChange:e=>{let t=e.target.value;r(t),t.trim().length<3?d(!1):d(!0)},onFocus:()=>{t.trim().length>=3&&d(!0)},onKeyDown:e=>{let t=b(e);"string"==typeof t&&(r(t),d(!1))},placeholder:n("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),c&&(m||u.length>0)&&y.createPortal((()=>{var e;let t=null==(e=f.current)?void 0:e.getBoundingClientRect();return t?(0,l.jsxs)("div",{ref:g,className:"fixed rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden z-[2000]",style:{top:t.bottom,left:t.left,width:t.width},children:[m&&(0,l.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:n("item_create.searching")}),!m&&u.map((e,t)=>{let a=e.properties,n=a.city||a.town||a.village||a.municipality||a.name,i=[a.state,a.country].filter(Boolean).join(", ");return(0,l.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{r(x(e)),d(!1)},className:"block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ".concat(t===p?"bg-primary/10 dark:bg-primary/10":""),children:[(0,l.jsx)("div",{className:"font-medium",children:n}),(0,l.jsx)("div",{className:"opacity-70",children:i})]},a.osm_id)}),!m&&0===u.length&&(0,l.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:n("item_create.no_results")})]}):null})(),document.body)]})}function v(e){let{submitting:t,disabled:r,label:a,iconMode:n,onClick:i}=e;return n?(0,l.jsx)("button",{type:"button",disabled:r,onClick:i,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:a,children:t?(0,l.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,l.jsx)(s.Ay,{icon:s.AT.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,l.jsx)("button",{type:"button",disabled:r,onClick:i,className:"h-9 px-3 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-60",children:a})}function j(e){let{tags:t,setTags:r}=e,{t:n}=(0,i.s)(),[o,c]=(0,a.useState)(""),d=(0,a.useCallback)(()=>{let e=o.trim();!e||t.includes(e)||(r([...t,e]),c(""))},[o,t,r]),u=(0,a.useCallback)(e=>r(t.filter(t=>t!==e)),[t,r]);return(0,l.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[t.map(e=>(0,l.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,l.jsx)("button",{type:"button",onClick:()=>u(e),className:"w-4 h-4 flex items-center justify-center rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600",title:n("item_create.remove_tag").replace("{tag}",e),children:(0,l.jsx)(s.Ay,{icon:s.AT.Close,className:"w-3 h-3",stroke:"currentColor",strokeWidth:"3",fill:"none"})})]},e)),(0,l.jsx)("input",{value:o,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key||","===e.key?(e.preventDefault(),d()):"Backspace"===e.key&&!o&&t.length>0&&u(t[t.length-1])},placeholder:0===t.length?n("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})}function k(e){var t,r,n,o;let{initial:c,submitting:d=!1,submitLabel:u,onSubmit:m,onCancel:p,showIconSubmit:h=!1}=e,{t:f}=(0,i.s)(),[g,x]=(0,a.useState)(null!=(t=c.title)?t:""),[b,y]=(0,a.useState)(null!=(r=c.description)?r:""),[k,N]=(0,a.useState)(null!=(n=c.place)?n:""),[_,C]=(0,a.useState)(null!=(o=c.tags)?o:[]);(0,a.useEffect)(()=>{var e,t,r,l;x(null!=(e=c.title)?e:""),y(null!=(t=c.description)?t:""),N(null!=(r=c.place)?r:""),C(null!=(l=c.tags)?l:[])},[c]);let A=(0,a.useMemo)(()=>!!g.trim(),[g]),S="function"==typeof p,E=(0,a.useCallback)(()=>{A&&m({title:g,description:b,place:k,tags:_})},[A,m,g,b,k,_]);return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,l.jsx)("input",{"aria-label":f("item_create.title"),value:g,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&A&&E(),placeholder:f("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,l.jsx)("input",{"aria-label":f("item_create.description"),value:b,onChange:e=>y(e.target.value),onKeyDown:e=>"Enter"===e.key&&A&&E(),placeholder:f("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,l.jsx)(w,{value:k,onChange:N}),(0,l.jsx)(j,{tags:_,setTags:C})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[p&&!h&&(0,l.jsx)("button",{type:"button",onClick:p,className:"h-9 px-3 rounded-xl border shadow-sm hover:bg-muted/50",children:f("item_list.close_modal")}),h?(0,l.jsx)("button",{type:"button",disabled:d||!A,onClick:E,className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:u,children:d?(0,l.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):S?(0,l.jsx)(s.Ay,{icon:s.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"}):(0,l.jsx)(s.Ay,{icon:s.AT.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none"})}):(0,l.jsx)(v,{submitting:d,disabled:d||!A,label:u,iconMode:!1,onClick:E})]})]})}function N(e){let{open:t,onClick:r}=e;return(0,l.jsx)("div",{className:"fixed inset-0 z-[500] bg-black/40 backdrop-blur-sm transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),onClick:r})}function _(e){return e?Array.from(e.querySelectorAll('a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex="-1"])')):[]}function C(e){let{open:t,title:r,closeLabel:n,onClose:i,children:s,initialFocusRef:o}=e,c=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e,r;if(!t)return;let l=null!=(r=null==o?void 0:o.current)?r:_(c.current)[0];null==l||null==(e=l.focus)||e.call(l)},[t,o]),(0,a.useEffect)(()=>{if(!t)return;let e=e=>{if("Tab"!==e.key)return;let t=_(c.current);if(0===t.length)return;let r=t[0],l=t[t.length-1],a=document.activeElement;e.shiftKey&&a===r?(e.preventDefault(),l.focus()):e.shiftKey||a!==l||(e.preventDefault(),r.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t]),(0,l.jsx)("div",{className:"fixed inset-0 z-[600] flex items-center justify-center p-4 transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!t,children:(0,l.jsxs)("div",{ref:c,role:"dialog","aria-modal":"true","aria-labelledby":"centered-modal-title",className:"bg-background rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90dvh] flex flex-col overflow-hidden outline-none",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,l.jsx)("h3",{id:"centered-modal-title",className:"text-base font-semibold",children:r}),(0,l.jsx)("button",{className:"rounded-md px-3 py-1 text-sm border",onClick:i,"aria-label":null!=n?n:"Close",children:null!=n?n:"Close"})]}),(0,l.jsx)("div",{className:"p-4 overflow-auto",children:s})]})})}function A(e){let{children:t}=e;return"undefined"==typeof document?null:y.createPortal(t,document.body)}function S(e){var t,r;let{open:n,onOpenChange:i,title:s,closeLabel:o="Close",children:c,closeOnBackdrop:d=!0,closeOnEsc:u=!0,initialFocusRef:m}=e;return((0,a.useEffect)(()=>{if(!n||"undefined"==typeof document)return;let{body:e}=document,t=e.style.overflow;return e.style.overflow="hidden",()=>{e.style.overflow=t}},[n]),t=n&&u,r=()=>i(!1),(0,a.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&r()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,r]),"undefined"==typeof document)?null:(0,l.jsxs)(A,{children:[(0,l.jsx)(N,{open:n,onClick:d?()=>i(!1):void 0}),(0,l.jsx)(C,{open:n,title:s,closeLabel:o,onClose:()=>i(!1),initialFocusRef:m,children:c})]})}function E(e){let{value:t,onChange:r}=e,{t:a}=(0,i.s)();return(0,l.jsxs)("div",{className:"relative flex w-full items-center",children:[(0,l.jsx)(s.In,{icon:s.AT.Search,className:"pointer-events-none absolute left-3 top-1/2 h-5 w-5 -translate-y-1/2 text-gray-400","aria-hidden":!0}),(0,l.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:a("item_list.search_placeholder"),className:"w-full rounded-xl border bg-background py-2 pl-9 pr-10 shadow-sm"}),t&&(0,l.jsx)("button",{onClick:()=>r(""),className:"clear-button absolute right-3 top-1/2 -translate-y-1/2","aria-label":a("item_list.search_clear"),children:(0,l.jsx)(s.In,{icon:s.AT.Close,className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})}function T(e){let{categoryId:t,onCreated:r}=e,{t:n}=(0,i.s)(),[s,o]=(0,a.useState)(0),{create:c,isCreating:d}=function(e){let{t}=(0,i.s)(),[r,l]=(0,a.useState)(!1);return{create:(0,a.useCallback)(async a=>{if(r)return!1;let n=a.title.trim(),i=a.description.trim()||null,s=a.place.trim()||null,o=Array.isArray(a.tags)?a.tags:[];if(!n)return!1;l(!0);let c=null;try{let{data:t,error:r}=await f.N.from("items").insert({title:n,description:i,place:s,tags:o}).select("id").single();if(r||!t)throw null!=r?r:Error("insert failed");c=t.id;let{error:l}=await f.N.from("item_categories").insert({item_id:c,category_id:e});if(l)throw l;return!0}catch(e){return c&&await f.N.from("items").delete().eq("id",c),console.error(e),alert(t("item_list.no_user_session")),!1}finally{l(!1)}},[e,r,t]),isCreating:r}}(t),u=(0,a.useCallback)(async e=>{await c(e)&&(r(),o(e=>e+1))},[c,r]);return(0,l.jsx)("section",{className:"relative z-[70] p-4 sm:p-5 space-y-3",children:(0,l.jsx)(k,{initial:{title:"",description:"",place:"",tags:[]},submitting:d,submitLabel:n("item_create.add"),onSubmit:u,showIconSubmit:!0},s)})}function L(e){var t,r;let{page:a,setPage:n,totalPages:o}=e,{t:c}=(0,i.s)();return o<=1?null:(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,l.jsx)("button",{disabled:1===a,onClick:()=>n(a-1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:null!=(t=c("item_list.previous"))?t:"Previous",children:(0,l.jsx)(s.Ay,{icon:s.AT.ChevronLeft,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),Array.from({length:o},(e,t)=>t+1).map(e=>(0,l.jsx)("button",{onClick:()=>n(e),className:"min-w-9 h-9 px-2 flex items-center justify-center rounded-xl shadow-sm "+(e===a?"bg-primary text-primary-foreground":"bg-primary/60 text-primary-foreground hover:bg-primary"),"aria-current":e===a?"page":void 0,children:e},e)),(0,l.jsx)("button",{disabled:a===o,onClick:()=>n(a+1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:null!=(r=c("item_list.next"))?r:"Next",children:(0,l.jsx)(s.Ay,{icon:s.AT.ChevronRight,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function P(e){let{isOpen:t,onClose:r,onUpload:a,busy:n,onEdit:o,onDelete:c}=e,{t:d}=(0,i.s)();return(0,l.jsxs)("div",{className:["absolute top-3 right-3 flex items-center gap-2 transition-opacity",t?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none","sm:opacity-0 sm:pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto"].join(" "),children:[(0,l.jsx)("button",{className:"sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-card border text-foreground shadow",onClick:r,"aria-label":d("common.close"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none","aria-hidden":"true"})}),(0,l.jsxs)("label",{className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 transition cursor-pointer",title:d("item_list.add_image"),children:[(0,l.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:n,onChange:e=>{var t;let l=null==(t=e.target.files)?void 0:t[0];l&&a(l),r()}}),n?(0,l.jsx)("div",{className:"w-4 h-4 border-2 border-primary-foreground/40 border-t-primary-foreground rounded-full animate-spin"}):(0,l.jsx)(s.Ay,{icon:s.AT.Add,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),(0,l.jsx)("button",{onClick:()=>{o(),r()},className:"w-9 h-9 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 flex items-center justify-center",title:d("item_list.edit"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),(0,l.jsx)("button",{onClick:()=>{c(),r()},className:"w-9 h-9 rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600 flex items-center justify-center",title:d("item_list.delete"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]})}function W(e){let{imgs:t,isOpen:r,onOpenModal:a,onDelete:n,deletingPath:o,busy:c}=e,{t:d}=(0,i.s)();return t.length?(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:t.map(e=>(0,l.jsxs)("div",{className:"relative group",onClick:()=>a(e.urlFull),role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&a(e.urlFull)},children:[(0,l.jsx)(x.default,{src:e.urlThumb||e.urlFull,alt:d("item_list.image_alt").replace("{idx}",""),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer"}),(0,l.jsx)("button",{title:d("item_list.delete"),onClick:t=>{t.stopPropagation(),n(e)},disabled:o===e.pathFull||c,className:[r?"opacity-100":"opacity-0","sm:opacity-0 sm:group-hover:opacity-100 absolute top-1 right-1 w-7 h-7 flex items-center justify-center rounded-lg bg-red-600 text-white shadow disabled:opacity-60 transition"].join(" "),children:o===e.pathFull?(0,l.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,l.jsx)(s.Ay,{icon:s.AT.Trash,className:"w-4 h-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]},e.pathFull))}):(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:d("item_list.no_images")})}function D(e){let{item:t,imgs:r,busy:n,deletingPath:i,onUpload:o,onEditItem:c,onDeleteItem:d,onDeleteImage:u,onOpenModal:m,i18n:{t:p}}=e,[h,f]=(0,a.useState)(!1);return(0,l.jsxs)("li",{className:"group relative rounded-2xl border bg-card/70 dark:bg-card/60 bg-neutral-100/50 dark:bg-neutral-800/50 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,l.jsx)("div",{className:"font-medium pr-16 truncate",children:t.title}),(0,l.jsx)("button",{className:"absolute top-3 right-3 sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-muted text-foreground shadow ".concat(h?"hidden":""),onClick:()=>f(!0),"aria-label":p("item_list.more_actions"),children:(0,l.jsx)(s.Ay,{icon:s.AT.More,className:"w-5 h-5",fill:"currentColor","aria-hidden":"true"})}),(0,l.jsx)(P,{isOpen:h,onClose:()=>f(!1),onUpload:o,busy:n,onEdit:c,onDelete:d}),t.description&&(0,l.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:t.description}),t.place&&(0,l.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,l.jsx)(s.Ay,{icon:s.AT.Pin,className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true"}),(0,l.jsx)("span",{className:"truncate",children:t.place})]}),!!t.tags.length&&(0,l.jsx)("div",{className:"flex flex-wrap gap-1.5",children:t.tags.map(e=>(0,l.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(0,l.jsx)(W,{imgs:r,isOpen:h,onOpenModal:m,onDelete:u,deletingPath:i,busy:n})]})}function U(e){let{url:t,onClose:r}=e,{t:a}=(0,i.s)();return t&&"undefined"!=typeof document?y.createPortal((0,l.jsxs)("div",{className:"fixed inset-0 z-[500] flex flex-col items-center justify-center bg-background/90 backdrop-blur",onClick:r,children:[(0,l.jsx)(x.default,{src:t,alt:a("item_list.full_size_image_alt"),unoptimized:!0,width:0,height:0,sizes:"100vw",className:"w-auto h-auto max-w-full max-h-full object-contain rounded-xl shadow-lg"}),(0,l.jsx)("button",{className:"mt-4 w-10 h-10 flex items-center justify-center rounded-xl bg-card text-card-foreground hover:bg-card/80 transition",title:a("item_list.close_modal"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]}),document.body):null}var R=r(1802);r(8413);var I=r(6647),z=r(3548),M=r(9931);let B=e=>{if("string"==typeof e)return e;if(e&&"string"==typeof e.src)return e.src;throw Error("Unsupported image import format")},F=e=>{let{markers:t,currentLocation:n,command:i}=e,s=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useRef)(null),m=(0,a.useRef)(t),p=(0,a.useRef)(n),[h,f]=(0,a.useState)(!1),g=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{u.current=null!=i?i:null},[i]),(0,a.useEffect)(()=>{m.current=t},[t]),(0,a.useEffect)(()=>{p.current=n},[n]),(0,a.useEffect)(()=>{let e=!1;return(async()=>{if(!s.current||c.current)return;let t=(await r.e(761).then(r.t.bind(r,5752,23))).default;if(e)return;o.current=t,delete t.Icon.Default.prototype._getIconUrl,t.Icon.Default.mergeOptions({iconRetinaUrl:B(I.A),iconUrl:B(z.A),shadowUrl:B(M.A)});let l=t.map(s.current).setView([51.505,-.09],13);c.current=l,l.createPane("currentLocation");let a=l.getPane("currentLocation");a&&(a.style.zIndex="650"),t.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(l),d.current=t.layerGroup().addTo(l),f(!0),requestAnimationFrame(()=>l.invalidateSize());let n=o.current,i=u.current;n&&i&&requestAnimationFrame(()=>{if("fitAll"===i){let e=[];m.current.forEach(t=>e.push([t.lat,t.lng]));let t=p.current;if(t&&e.push([t.lat,t.lng]),e.length>0){let t=n.latLngBounds(e).pad(.015);t.isValid()&&l.fitBounds(t,{padding:[8,8]})}}else if("fitCurrent"===i){let e=p.current;if(!e)return;let t=n.latLng(e.lat,e.lng).toBounds(1e5);l.fitBounds(t,{padding:[8,8]})}})})(),()=>{e=!0}},[]),(0,a.useEffect)(()=>{let e=o.current;if(!h||!e||!c.current||!d.current)return;d.current.clearLayers();let r=[];if(t.forEach(t=>{e.marker([t.lat,t.lng]).addTo(d.current).bindPopup(t.popupText),r.push([t.lat,t.lng])}),n){let{lat:t,lng:l}=n,a=e.circleMarker([t,l],{radius:8,weight:2,color:"#b91c1c",fillColor:"#ef4444",fillOpacity:1,pane:"currentLocation"}).addTo(d.current);n.popupText&&a.bindPopup(n.popupText),r.push([t,l])}if(!g.current&&r.length>0){let t=e.latLngBounds(r).pad(.015);t.isValid()&&c.current.fitBounds(t,{padding:[8,8]}),g.current=!0}},[t,n,h]),(0,a.useEffect)(()=>{let e=o.current,t=c.current;if(h&&e&&t&&i){if("fitAll"===i){let r=[];m.current.forEach(e=>r.push([e.lat,e.lng]));let l=p.current;if(l&&r.push([l.lat,l.lng]),r.length>0){let l=e.latLngBounds(r).pad(.015);l.isValid()&&t.fitBounds(l,{padding:[8,8]})}}else if("fitCurrent"===i){let r=p.current;if(!r)return;let l=e.latLng(r.lat,r.lng).toBounds(1e5);t.fitBounds(l,{padding:[8,8]})}}},[i,h]),(0,l.jsx)("div",{ref:s,style:{height:"400px",width:"100%"}})};function O(e){var t;let{categoryId:r}=e,{t:n}=(0,i.s)(),[o,c]=function(e,t){let[r,l]=(0,a.useState)(t);return(0,a.useEffect)(()=>{try{let t=localStorage.getItem(e);"1"===t&&l(!0),"0"===t&&l(!1)}catch(e){}},[e]),(0,a.useEffect)(()=>{try{localStorage.setItem(e,r?"1":"0")}catch(e){}},[e,r]),[r,l]}("cb_open_".concat(r),!1),[d,u]=(0,a.useState)(!1),{places:m,loading:p}=function(e){let[t,r]=(0,a.useState)([]),[l,n]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{n(!0);try{var e;let{data:t,error:l}=await f.N.from("items").select("place").eq("user_id",null==(e=(await f.N.auth.getUser()).data.user)?void 0:e.id).not("place","is",null).neq("place","");if(l)throw l;let a=Array.from(new Set(t.map(e=>e.place))),n=await Promise.all(a.map(async e=>{try{let t=new URL("https://photon.komoot.io/api/");t.searchParams.set("q",e),t.searchParams.set("limit","1");let r=await fetch(t.toString());if(!r.ok)return null;let l=await r.json();if(l.features&&l.features.length>0){let[t,r]=l.features[0].geometry.coordinates;return{name:e,lat:r,lng:t}}return null}catch(e){return null}}));r(n.filter(e=>null!==e))}catch(e){r([])}finally{n(!1)}})()},[e]),{places:t,loading:l}}(r),[h,g]=(0,a.useState)("fitAll"),[x,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!d||!navigator.geolocation)return;let e=!1;navigator.geolocation.getCurrentPosition(t=>{e||b({lat:t.coords.latitude,lng:t.coords.longitude})},()=>{},{enableHighAccuracy:!0,timeout:12e3,maximumAge:0});let t=navigator.geolocation.watchPosition(t=>{e||b({lat:t.coords.latitude,lng:t.coords.longitude})},()=>{},{enableHighAccuracy:!0,timeout:2e4,maximumAge:0}),r=window.setTimeout(()=>{null!=t&&navigator.geolocation.clearWatch(t)},1e4);return()=>{e=!0,window.clearTimeout(r),null!=t&&navigator.geolocation.clearWatch(t)}},[d]);let[y,w]=(0,a.useState)(""),[v,j]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=setTimeout(()=>j(y.trim()),200);return()=>clearTimeout(e)},[y]);let{items:N,page:_,setPage:C,totalPages:A,reload:P,setItems:W}=function(e,t){let[r,l]=(0,a.useState)([]),[n,i]=(0,a.useState)(0),[s,o]=(0,a.useState)(1),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(0);(0,a.useEffect)(()=>o(1),[e,t]);let m=(0,a.useMemo)(()=>Math.ceil(n/6),[n]),p=(0,a.useCallback)(async()=>{let r=++u.current;d(!0);let a=(s-1)*6,n=t.trim(),o=f.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",e);if(n){let e=n.replace(/[%_]/g,"\\$&"),t="%".concat(e,"%");o=o.or("title.ilike.".concat(t,",description.ilike.").concat(t,",place.ilike.").concat(t,",tags_text.ilike.").concat(t))}let{data:c,error:m,count:p}=await o.order("created_at",{ascending:!1}).range(a,a+6-1).returns();r===u.current&&(d(!1),m||(l((null!=c?c:[]).map(e=>{var t,r;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(r=e.tags)?r:[]}})),i(p||0)))},[e,s,t]);return(0,a.useEffect)(()=>{p()},[p]),{items:r,loading:c,page:s,setPage:o,totalPages:m,reload:p,setItems:l}}(r,v),I=(0,a.useCallback)(()=>{c(!1),P()},[c,P]),{images:z,refreshAllImages:M,uploadImage:B,deleteImage:O,busy:q,deletingPath:K}=function(){let{t:e}=(0,i.s)(),[t,r]=(0,a.useState)(null),[l,n]=(0,a.useState)(null),[s,o]=(0,a.useState)({}),c=(0,a.useCallback)(async e=>{var t,r,l,a;let{data:n}=await f.N.auth.getUser(),i=null==(t=n.user)?void 0:t.id;if(!i)return;let s="".concat(i,"/").concat(e),{data:c,error:d}=await f.N.storage.from("item-images").list(s,{limit:48,sortBy:{column:"created_at",order:"desc"}});if(d)return;if(!(null==c?void 0:c.length))return void o(t=>({...t,[e]:[]}));let u=new Map;for(let e of c){let t=e.name,l=t.endsWith(".thumb.webp")?t.replace(/\.thumb\.webp$/,""):t.replace(/\.webp$/,""),a=null!=(r=u.get(l))?r:{};t.endsWith(".thumb.webp")?a.thumb={name:t}:(t.endsWith(".webp"),a.full={name:t}),u.set(l,a)}let m=[];for(let[,{full:e,thumb:t}]of u){let r,n;if(!e)continue;let i="".concat(s,"/").concat(e.name),{data:o}=await f.N.storage.from("item-images").createSignedUrl(i,3600),c=null!=(l=null==o?void 0:o.signedUrl)?l:"";if(t){r="".concat(s,"/").concat(t.name);let{data:e}=await f.N.storage.from("item-images").createSignedUrl(r,3600);n=null!=(a=null==e?void 0:e.signedUrl)?a:void 0}m.push({pathFull:i,urlFull:c,pathThumb:r,urlThumb:n})}o(t=>({...t,[e]:m}))},[]),d=(0,a.useCallback)(async e=>{await Promise.all(e.map(c))},[c]),u=(0,a.useCallback)(async(t,l)=>{try{var a;r(t);let{data:n}=await f.N.auth.getUser(),i=null==(a=n.user)?void 0:a.id;if(!i)throw Error(e("item_list.no_user_session"));let s=await (0,R.A)(l,{maxWidthOrHeight:1e3,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),o=await (0,R.A)(l,{maxWidthOrHeight:250,initialQuality:.75,fileType:"image/webp",useWebWorker:!0}),d=crypto.randomUUID(),u="".concat(i,"/").concat(t,"/").concat(d),m=await f.N.storage.from("item-images").upload("".concat(u,".webp"),s);if(m.error)throw m.error;let p=await f.N.storage.from("item-images").upload("".concat(u,".thumb.webp"),o);p.error&&console.warn("Thumbnail upload failed:",p.error),await c(t)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{r(null)}},[c,e]);return{images:s,refreshItemImages:c,refreshAllImages:d,uploadImage:u,deleteImage:(0,a.useCallback)(async(e,t)=>{try{n(t.pathFull);let r=[t.pathFull,...t.pathThumb?[t.pathThumb]:[]],{error:l}=await f.N.storage.from("item-images").remove(r);if(l)return void alert(l.message);o(r=>({...r,[e]:(r[e]||[]).filter(e=>e.pathFull!==t.pathFull)}))}finally{n(null)}},[]),busy:t,deletingPath:l}}();(0,a.useEffect)(()=>{N.length&&M(N.map(e=>e.id))},[N,M]);let[H,V]=(0,a.useState)(!1),[G,$]=(0,a.useState)(null),[Q,J]=(0,a.useState)(!1),[X,Y]=(0,a.useState)(null),Z=async e=>{if(G&&!Q){J(!0);try{let t={title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags},{error:r}=await f.N.from("items").update(t).eq("id",G.id);if(r)return void alert(r.message);W(e=>e.map(e=>e.id===G.id?{...e,...t}:e)),V(!1),$(null)}finally{J(!1)}}},ee=async e=>{confirm(n("item_list.confirm_delete"))&&(await f.N.from("items").delete().eq("id",e),await P())};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("button",{type:"button",onClick:()=>c(!0),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":n("item_create.new_entry"),title:n("item_create.new_entry"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Plus,className:"w-4 h-4"})}),(0,l.jsx)("button",{type:"button",onClick:()=>u(!0),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary/10 text-primary/80 shadow-sm hover:brightness-110","aria-label":n("item_list.open_map"),title:n("item_list.open_map"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Map,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),(0,l.jsx)("div",{className:"flex-1 min-w-[6rem] sm:min-w-[12rem]",children:(0,l.jsx)(E,{value:y,onChange:w})})]}),(0,l.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-2 gap-3",children:N.map(e=>{var t;return(0,l.jsx)(D,{item:e,imgs:null!=(t=z[e.id])?t:[],busy:q===e.id,deletingPath:K,onUpload:t=>B(e.id,t),onEditItem:()=>{var t,r,l;$({id:e.id,values:{title:e.title,description:null!=(t=e.description)?t:"",place:null!=(r=e.place)?r:"",tags:null!=(l=e.tags)?l:[]}}),V(!0)},onDeleteItem:()=>void ee(e.id),onDeleteImage:t=>void O(e.id,t),onOpenModal:Y,i18n:{t:n}},e.id)})}),(0,l.jsx)(L,{page:_,setPage:C,totalPages:A}),(0,l.jsx)(U,{url:X,onClose:()=>Y(null)}),(0,l.jsx)(S,{open:H,onOpenChange:e=>{V(e),e||$(null)},title:n("item_list.edit_item"),closeLabel:n("common.close_x"),children:(0,l.jsx)("section",{className:"relative z-[50]",children:(0,l.jsx)(k,{initial:null!=(t=null==G?void 0:G.values)?t:{title:"",description:"",place:"",tags:[]},submitLabel:n("common.save"),submitting:Q,onSubmit:Z,onCancel:()=>{V(!1),$(null)},showIconSubmit:!0},null==G?void 0:G.id)})}),(0,l.jsx)(S,{open:d,onOpenChange:u,title:n("item_list.map_title"),closeLabel:n("common.close_x"),children:p?(0,l.jsx)("p",{children:n("common.loading")}):d?(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(F,{command:h,markers:m.map(e=>({lat:e.lat,lng:e.lng,popupText:e.name})),currentLocation:x?{lat:x.lat,lng:x.lng,popupText:n("item_list.you_are_here")}:void 0}),(0,l.jsxs)("div",{className:"absolute top-2 right-2 z-[1000] bg-white/50 backdrop-blur rounded-lg flex gap-1 p-1",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{x&&(g("fitCurrent"),setTimeout(()=>g(null),0))},className:"w-9 h-9 flex items-center justify-center rounded-lg bg-primary/10 text-primary/80 shadow-sm hover:brightness-110 disabled:opacity-50","aria-label":n("item_list.zoom_to_current_location"),title:n("item_list.zoom_to_current_location"),disabled:!x,children:(0,l.jsx)(s.Ay,{icon:s.AT.Gps,className:"w-5 h-5"})}),(0,l.jsx)("button",{type:"button",onClick:()=>{g("fitAll"),setTimeout(()=>g(null),0)},className:"w-9 h-9 flex items-center justify-center rounded-lg bg-primary/10 text-primary/80 shadow-sm hover:brightness-110","aria-label":n("item_list.frame_all_pins"),title:n("item_list.frame_all_pins"),children:(0,l.jsx)(s.Ay,{icon:s.AT.Frame,className:"w-5 h-5"})})]})]}):null}),(0,l.jsx)(S,{open:o,onOpenChange:c,title:n("item_create.new_entry"),closeLabel:n("common.close_x"),children:(0,l.jsx)(T,{categoryId:r,onCreated:I})})]})}var q=r(9669);function K(){var e;let{user:t,loading:r}=function(){let[e,t]=(0,a.useState)(null),[r,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let e=!0;(async()=>{var r,a,n;let{data:i}=await f.N.auth.getUser();if(!e)return;let s=i.user;t(s?{id:s.id,email:null!=(a=s.email)?a:null,name:null!=(n=null==(r=s.user_metadata)?void 0:r.name)?n:null}:null),l(!1)})();let{data:r}=f.N.auth.onAuthStateChange((e,r)=>{var l,a,n;let i=null==r?void 0:r.user;t(i?{id:i.id,email:null!=(a=i.email)?a:null,name:null!=(n=null==(l=i.user_metadata)?void 0:l.name)?n:null}:null)});return()=>{e=!1,r.subscription.unsubscribe()}},[]),{user:e,loading:r}}(),s=(0,n.useRouter)(),{t:o}=(0,i.s)(),[c,d]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{try{let{error:e}=await f.N.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message)}catch(e){console.error("Unexpected error during sign-out:",e)}finally{s.replace("/login")}},[s]);if(r)return(0,l.jsx)(q.A,{label:o("item_list.loading")});if(!t)return null;let m=!!c,p={...t,email:null!=(e=t.email)?e:""};return(0,l.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,l.jsx)(b,{user:p,onSignOut:u}),(0,l.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,l.jsx)(g,{selectedCat:c,onSelect:d}),m?(0,l.jsxs)("section",{className:"relative z-50 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,l.jsx)("h2",{className:"text-base font-semibold",children:o("page.entries")})}),(0,l.jsx)(O,{categoryId:c})]}):(0,l.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:o("page.choose_category")}),(0,l.jsx)("p",{className:"text-sm opacity-70",children:o("page.add_collectibles")})]})]})})]}),(0,l.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:o("page.footer")})]})}}},e=>{e.O(0,[484,192,460,846,441,964,358],()=>e(e.s=6707)),_N_E=e.O()}]);