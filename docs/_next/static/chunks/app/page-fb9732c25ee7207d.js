(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{101:(e,t,r)=>{"use strict";r.d(t,{g:()=>i,I18nProvider:()=>n});var a=r(5155),l=r(2115);let s={de:JSON.parse('{"page":{"entries":"Eintr\xe4ge","choose_category":"Kategorie w\xe4hlen","add_collectibles":"Dann kannst du neue Sammlerst\xfccke hinzuf\xfcgen und Bilder hochladen.","footer":"Sammeln • Ordnen • Behalten"},"header":{"title":"CollectionBuddy","sign_out":"Abmelden"},"category_select":{"title":"Kategorie","select_placeholder":"Kategorie w\xe4hlen oder erstellen","new_category":"Neue Kategorie","confirm_delete":"Diese Kategorie wirklich l\xf6schen?","load_error":"Kategorien konnten nicht geladen werden.","create_error":"Kategorie konnte nicht erstellt werden.","delete_error":"Kategorie konnte nicht gel\xf6scht werden.","open_category":"Kategorie \xf6ffnen"},"item_create":{"new_entry":"Neuer Eintrag","title":"Titel","description":"Beschreibung","place_placeholder":"Ort (z. B. K\xf6ln)","searching":"Suche…","no_results":"Keine Treffer","remove_tag":"Tag {tag} entfernen","tags_placeholder":"Tags eingeben… (Enter/Komma)"},"item_list":{"confirm_delete":"Diesen Gegenstand l\xf6schen?","no_user_session":"Keine Benutzersitzung","image_alt":"Bild {idx}","full_size_image_alt":"Vollbild","close_modal":"Schlie\xdfen","loading":"Wird geladen…","no_images":"Keine Bilder"},"google_sign_in_button":{"sign_in_with_google":"Mit Google anmelden"},"login_page":{"circle_text":"CollectionBuddy • Sammeln • Ordnen • Behalten • Deine Sch\xe4tze im Blick • ","checking_login":"Anmeldung wird gepr\xfcft…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Dein digitales Sammelalbum f\xfcr M\xfcnzen, Pl\xfcschtiere, Briefmarken und alles, was dir am Herzen liegt."},"layout":{"description":"Sammeln • Ordnen • Behalten"}}'),en:JSON.parse('{"page":{"entries":"Entries","choose_category":"Choose category","add_collectibles":"Then you can add new collectibles and upload pictures.","footer":"Collect • Organize • Keep"},"header":{"title":"CollectionBuddy","sign_out":"Sign out"},"category_select":{"title":"Category","select_placeholder":"Select or create category","new_category":"New category","confirm_delete":"Really delete this category?","load_error":"Could not load categories.","create_error":"Could not create category.","delete_error":"Could not delete category.","open_category":"Open category"},"item_create":{"new_entry":"New entry","title":"Title","description":"Description","place_placeholder":"City (e.g. Cologne)","searching":"Searching…","no_results":"No results","remove_tag":"Remove tag {tag}","tags_placeholder":"Enter tags… (Enter/Comma)"},"item_list":{"confirm_delete":"Delete this item?","no_user_session":"No user session","image_alt":"Image {idx}","full_size_image_alt":"Full size image","close_modal":"Close","loading":"Loading…","no_images":"No images"},"google_sign_in_button":{"sign_in_with_google":"Sign in with Google"},"login_page":{"circle_text":"CollectionBuddy • Collect • Organize • Keep • Your treasures at a glance • ","checking_login":"Checking login…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Your digital scrapbook for coins, stuffed animals, stamps and everything you love."},"layout":{"description":"Collect • Organize • Keep"}}')},i=(0,l.createContext)(void 0),n=e=>{let{children:t}=e,[r,n]=(0,l.useState)("de");(0,l.useEffect)(()=>{let e=navigator.language.split("-")[0];e in s&&n(e)},[]);let o=(0,l.useCallback)(e=>{let t=e.split("."),a=s[r];for(let r of t)if("object"!=typeof a||null===a||!(r in a))return e;else{let t=a[r];if("string"==typeof t)a=t;else{if("object"!=typeof t||null===t)return e;a=t}}return"string"==typeof a?a:e},[r]);return(0,a.jsx)(i.Provider,{value:{lang:r,setLang:n,t:o},children:t})}},2184:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(5155),l=r(5875);function s(e){let{label:t}=e,{t:r}=(0,l.s)();return(0,a.jsxs)("div",{className:"fixed inset-0 z-100 flex flex-col items-center justify-center gap-3 bg-black/60 backdrop-blur-sm",children:[(0,a.jsx)("div",{className:"animate-spin h-8 w-8 rounded-full border-2 border-white/80 border-t-transparent"}),(0,a.jsx)("span",{className:"text-white text-lg font-medium",children:null!=t?t:r("item_list.loading")})]})}},5875:(e,t,r)=>{"use strict";r.d(t,{s:()=>s});var a=r(2115),l=r(101);let s=()=>{let e=(0,a.useContext)(l.g);if(!e)throw Error("useI18n must be used within an I18nProvider");return e}},5983:(e,t,r)=>{"use strict";r.d(t,{N:()=>a});let a=(0,r(2354).UU)("https://mopbqdyfjvdfpffhetyf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vcGJxZHlmanZkZnBmZmhldHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MzQ2NDUsImV4cCI6MjA3MDQxMDY0NX0.qtzuwQn1QB3tOtN2u7mnEigMa2VBIyAxu_eU6cEXc68")},6601:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var a=r(5155),l=r(2115),s=r(5983),i=r(5695),n=r(2184),o=r(5875);function c(e){let{selectedCat:t,onSelect:r,sortedCats:l,isLoading:s,t:i,setExpanded:n}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;r(t),t&&n(!1)},disabled:s,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":i("category_select.select_placeholder"),children:[(0,a.jsx)("option",{value:"",children:i("category_select.select_placeholder")}),l.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"▾"})]})}function d(e){let{name:t,setName:r,createCategory:l,setExpanded:s,t:i}=e;return(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:i("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&l(),"Escape"===e.key&&s(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}function u(e){let{onClick:t,disabled:r,isCreating:l,label:s}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:s,children:l?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):"+"})}function m(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110",title:r,children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M20 6L9 17l-5-5"})})})}function h(e){let{title:t,name:r}=e;return(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,a.jsx)("div",{className:"font-medium truncate",children:r})]})}function g(e){let{onClick:t,disabled:r,label:l}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-red-500 text-white hover:bg-red-600 disabled:opacity-50",title:l,children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M3 6h18"}),(0,a.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,a.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,a.jsx)("path",{d:"M10 11v6M14 11v6"})]})})}function p(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"rounded-xl w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r,title:r,children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M12 20h9"}),(0,a.jsx)("path",{d:"M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]})})}function x(e){let{selectedCat:t,onSelect:r}=e,{t:i}=(0,o.s)(),[n,x]=(0,l.useState)([]),[f,b]=(0,l.useState)(""),[y,v]=(0,l.useState)(!1),[w,j]=(0,l.useState)(!1),[k,_]=(0,l.useState)(!1),[N,C]=(0,l.useState)(!t);(0,l.useEffect)(()=>{C(!t)},[t]);let S=(0,l.useMemo)(()=>[...n].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[n]),M=(0,l.useMemo)(()=>{var e;return t&&null!=(e=n.find(e=>e.id===t))?e:null},[n,t]),E=(0,l.useCallback)(async()=>{v(!0);try{let{data:e,error:t}=await s.N.from("categories").select("id,name");if(t)throw t;x(null!=e?e:[])}catch(e){console.error(e),alert(i("category_select.loadError"))}finally{v(!1)}},[i]);(0,l.useEffect)(()=>{E()},[E]);let B=async()=>{let e=f.trim();if(e&&!w){j(!0);try{let{data:t,error:a}=await s.N.from("categories").insert({name:e}).select("id,name").single();if(a)throw a;b(""),await E(),(null==t?void 0:t.id)&&(r(t.id),C(!1))}catch(e){console.error(e),alert(i("category_select.createError"))}finally{j(!1)}}},z=async()=>{if(t&&!k&&confirm(i("category_select.confirmDelete"))){_(!0);try{let{error:e}=await s.N.from("categories").delete().eq("id",t);if(e)throw e;r(null),await E(),C(!0)}catch(e){console.error(e),alert(i("category_select.deleteError"))}finally{_(!1)}}};return!N&&M?(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,a.jsx)(h,{title:i("category_select.title"),name:M.name}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(p,{onClick:()=>C(!0),label:i("category_select.open_category")})})]}):(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:i("category_select.title")}),(0,a.jsx)(c,{selectedCat:t,onSelect:r,sortedCats:S,isLoading:y,t:i,setExpanded:C}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d,{name:f,setName:b,createCategory:B,setExpanded:C,t:i}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&""!==t&&(0,a.jsx)(g,{onClick:z,disabled:k,label:i("category_select.delete")}),t&&""!==t&&""===f.trim()&&(0,a.jsx)(m,{onClick:()=>{C(!1),r(t)},label:i("category_select.set")}),(!t||""!==f.trim())&&(0,a.jsx)(u,{onClick:B,disabled:""===f.trim()||w,isCreating:w,label:i("category_select.add")})]})]})]})}var f=r(7650);function b(e){let{initial:t,submitting:r=!1,submitLabel:s,onSubmit:i,onCancel:n,showIconSubmit:c=!1}=e,{t:d,locale:u}=(0,o.s)(),[m,h]=(0,l.useState)(t.title),[g,p]=(0,l.useState)(t.description),[x,b]=(0,l.useState)(t.place),[y,v]=(0,l.useState)(t.tags),[w,j]=(0,l.useState)(!1),[k,_]=(0,l.useState)([]),[N,C]=(0,l.useState)(!1),[S,M]=(0,l.useState)(-1),E=(0,l.useRef)(null),B=(0,l.useRef)(null),z=(0,l.useRef)(null),L=(0,l.useRef)(null),[D,I]=(0,l.useState)(""),K=(0,l.useMemo)(()=>u&&"string"==typeof u?u:"undefined"!=typeof navigator&&navigator.language?navigator.language:"en",[u]),O=(0,l.useMemo)(()=>{let e=(K.split("-")[1]||"").toUpperCase();return new Set(["DE","AT","CH","LI","LU"]).has(e)?"de":"en"},[K]),A=(0,l.useMemo)(()=>{let e=Intl.DisplayNames;return e?new e([O],{type:"region"}):null},[O]),U=(0,l.useCallback)(e=>{let t=e.city||e.town||e.village||e.municipality||e.name||"",r=e.country||(e.countrycode&&A?A.of(e.countrycode.toUpperCase()):void 0),a=[e.state,r].filter(Boolean).join(", "),l="".concat(t,"|||").concat(a).toLowerCase().replace(/\s+/g," ").trim();return{city:t,line2:a,key:l}},[A]);(0,l.useEffect)(()=>{if(!w||x.trim().length<3){_([]),M(-1);return}let e=x.trim(),t=setTimeout(async()=>{try{var t;null==(t=E.current)||t.abort();let r=new AbortController;E.current=r,C(!0);let a=new URL("https://photon.komoot.io/api/");a.searchParams.set("q",e),a.searchParams.set("limit","5"),a.searchParams.set("lang",O);let l=await fetch(a.toString(),{signal:r.signal});if(!l.ok)throw Error("HTTP ".concat(l.status));let s=await l.json(),i=Array.from(new Map(s.features.map(e=>[e.properties.osm_id,e])).values()),n=new Set,o=[];for(let e of i){let{key:t}=U(e.properties);n.has(t)||(n.add(t),o.push(e))}_(o),M(-1)}catch(e){_([]),M(-1)}finally{C(!1)}},300);return()=>clearTimeout(t)},[x,w,O,U]),(0,l.useEffect)(()=>{let e=e=>{var t,r,a;let l=e.target,s=null==(t=z.current)?void 0:t.contains(l),i=null==(r=B.current)?void 0:r.contains(l),n=null==(a=L.current)?void 0:a.contains(l);s||i||n||j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let W=e=>{let{city:t,line2:r}=U(e.properties),a=r.split(", ").pop()||"";b(a?"".concat(t,", ").concat(a):t),_([]),M(-1),j(!1)},P=e=>v(t=>t.filter(t=>t!==e)),R=!!m.trim(),T="function"==typeof n;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsx)("input",{"aria-label":d("item_create.title"),value:m,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&R&&i({title:m,description:g,place:x,tags:y}),placeholder:d("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,a.jsx)("input",{"aria-label":d("item_create.description"),value:g,onChange:e=>p(e.target.value),onKeyDown:e=>"Enter"===e.key&&R&&i({title:m,description:g,place:x,tags:y}),placeholder:d("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"relative",ref:B,children:[(0,a.jsx)("input",{ref:z,"aria-label":d("item_create.place_placeholder"),value:x,onChange:e=>{let t=e.target.value;b(t),""===t.trim()&&(_([]),M(-1),j(!0))},onFocus:()=>j(!0),onKeyDown:e=>{if(k.length)if("ArrowDown"===e.key)e.preventDefault(),M(e=>(e+1)%k.length);else if("ArrowUp"===e.key)e.preventDefault(),M(e=>e<=0?k.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=S>=0?k[S]:k[0];t&&W(t)}else"Escape"===e.key&&(_([]),M(-1),j(!1))},placeholder:d("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),w&&(N||k.length>0)&&f.createPortal((()=>{var e;let t=null==(e=z.current)?void 0:e.getBoundingClientRect();return t?(0,a.jsxs)("div",{ref:L,className:"fixed rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden z-[2000]",style:{top:t.bottom,left:t.left,width:t.width},children:[N&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:d("item_create.searching")}),!N&&k.map((e,t)=>{let r=e.properties,l=r.city||r.town||r.village||r.municipality||r.name,s=[r.state,r.country].filter(Boolean).join(", ");return(0,a.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>W(e),className:"block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ".concat(t===S?"bg-primary/10 dark:bg-primary/10":""),children:[(0,a.jsx)("div",{className:"font-medium",children:l}),(0,a.jsx)("div",{className:"opacity-70",children:s})]},r.osm_id)}),!N&&0===k.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:d("item_create.no_results")})]}):null})(),document.body)]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[y.map(e=>(0,a.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>P(e),className:"w-4 h-4 flex items-center justify-center rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600",title:d("item_create.remove_tag").replace("{tag}",e),children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-3 h-3",stroke:"currentColor",strokeWidth:"3",fill:"none",children:(0,a.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]},e)),(0,a.jsx)("input",{value:D,onChange:e=>I(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=D.trim();!t||y.includes(t)||(v(e=>[...e,t]),I(""))}else"Backspace"===e.key&&!D&&y.length>0&&P(y[y.length-1])},placeholder:0===y.length?d("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[n&&!c&&(0,a.jsx)("button",{type:"button",onClick:n,className:"h-9 px-3 rounded-xl border shadow-sm hover:bg-muted/50",children:d("common.cancel")}),c?(0,a.jsx)("button",{type:"button",disabled:r||!R,onClick:()=>R&&i({title:m,description:g,place:x,tags:y}),className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:s,children:r?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):T?(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,a.jsx)("path",{d:"M20 6L9 17l-5-5"})}):(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,a.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}):(0,a.jsx)("button",{type:"button",disabled:r||!R,onClick:()=>R&&i({title:m,description:g,place:x,tags:y}),className:"h-9 px-3 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-60",children:s})]})]})}function y(e){let{categoryId:t,onCreated:r}=e,{t:i}=(0,o.s)(),[n,c]=(0,l.useState)(!1),d=(0,l.useCallback)(async e=>{if(!n){c(!0);try{let{data:a,error:l}=await s.N.from("items").insert({title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags}).select("id").single();if(l||!a)return;let{error:i}=await s.N.from("item_categories").insert({item_id:a.id,category_id:t});if(i)return;r()}finally{c(!1)}}},[t,n,r]);return(0,a.jsx)("section",{className:"p-4 sm:p-5 space-y-3 z-70 relative",children:(0,a.jsx)(b,{initial:{title:"",description:"",place:"",tags:[]},submitting:n,submitLabel:i("item_create.add"),onSubmit:d,showIconSubmit:!0})})}var v=r(6766),w=r(1802);function j(e){let{open:t,onOpenChange:r,title:l,closeLabel:s,children:i}=e;return"undefined"==typeof document?null:f.createPortal((0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-500 bg-black/40 backdrop-blur-sm transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),onClick:()=>r(!1)}),(0,a.jsx)("div",{className:"fixed inset-0 z-600 flex items-center justify-center p-4 transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),children:(0,a.jsxs)("div",{className:"bg-background rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90dvh] flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:l}),(0,a.jsx)("button",{className:"rounded-md px-3 py-1 text-sm border",onClick:()=>r(!1),"aria-label":s,children:s})]}),(0,a.jsx)("div",{className:"p-4 overflow-auto",children:i})]})})]}),document.body)}function k(e){var t;let{categoryId:r}=e,[i,n]=(0,l.useState)([]),[c,d]=(0,l.useState)(1),[u,m]=(0,l.useState)(0),[h,g]=(0,l.useState)(null),[p,x]=(0,l.useState)(null),[y,k]=(0,l.useState)({}),[_,N]=(0,l.useState)(!1),{t:C}=(0,o.s)(),[S,M]=(0,l.useState)(null),[E,B]=(0,l.useState)(!1),[z,L]=(0,l.useState)(!1),[D,I]=(0,l.useState)(null);(0,l.useEffect)(()=>{s.N.auth.getUser().then(e=>{var t,r;let{data:a}=e;return g(null!=(r=null==(t=a.user)?void 0:t.id)?r:null)})},[]),(0,l.useEffect)(()=>d(1),[r]);let K=(0,l.useCallback)(async()=>{N(!0);let e=(c-1)*6,{data:t,error:a,count:l}=await s.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",r).order("created_at",{ascending:!1}).range(e,e+6-1).returns();N(!1),a||(n((null!=t?t:[]).map(e=>{var t,r;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(r=e.tags)?r:[]}})),m(l||0))},[r,c]);(0,l.useEffect)(()=>{K()},[K]);let O=(0,l.useCallback)(async e=>{var t;let{data:r}=await s.N.auth.getUser(),a=null==(t=r.user)?void 0:t.id;if(!a)return;let l="".concat(a,"/").concat(e),{data:i,error:n}=await s.N.storage.from("item-images").list(l,{limit:12,sortBy:{column:"created_at",order:"desc"}});if(n)return;if(!(null==i?void 0:i.length))return void k(t=>({...t,[e]:[]}));let o=i.map(e=>"".concat(l,"/").concat(e.name)),c=await Promise.all(o.map(async e=>{let{data:t,error:r}=await s.N.storage.from("item-images").createSignedUrl(e,3600);return r?"":(null==t?void 0:t.signedUrl)||""}));k(t=>({...t,[e]:c.filter(Boolean)}))},[]),A=(0,l.useCallback)(async e=>{await Promise.all(e.map(e=>O(e)))},[O]);(0,l.useEffect)(()=>{i.length&&h&&A(i.map(e=>e.id))},[i,h,A]);let U=(0,l.useCallback)(async e=>{confirm(C("item_list.confirm_delete"))&&(await s.N.from("items").delete().eq("id",e),await K())},[K,C]),W=(0,l.useCallback)(async(e,t)=>{try{var r;x(e);let{data:a}=await s.N.auth.getUser(),l=null==(r=a.user)?void 0:r.id;if(!l)throw Error(C("item_list.no_user_session"));let i=await (0,w.A)(t,{maxWidthOrHeight:500,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),n="".concat(l,"/").concat(e,"/").concat(crypto.randomUUID(),"-").concat(i.name),{error:o}=await s.N.storage.from("item-images").upload(n,i);if(o)throw o;await O(e)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{x(null)}},[O,C]),P=(0,l.useMemo)(()=>Math.ceil(u/6),[u]),R=async e=>{if(D&&!E){B(!0);try{let t={title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags},{error:r}=await s.N.from("items").update(t).eq("id",D.id);if(r)return void alert(r.message);n(e=>e.map(e=>e.id===D.id?{...e,...t}:e)),L(!1),I(null)}finally{B(!1)}}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-2 gap-3",children:i.map(e=>{var t;return(0,a.jsxs)("li",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 bg-neutral-100/50 dark:bg-neutral-800/50 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.title}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("label",{className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 transition cursor-pointer",title:C("item_list.add_image"),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:!h||p===e.id,onChange:t=>{var r;let a=null==(r=t.target.files)?void 0:r[0];a&&(k(t=>({...t,[e.id]:[URL.createObjectURL(a),...t[e.id]||[]]})),W(e.id,a))}}),p===e.id?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-primary-foreground/40 border-t-primary-foreground rounded-full animate-spin"}):(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{d:"M4 4h16v16H4z"}),(0,a.jsx)("path",{d:"M12 8v8M8 12h8"})]})]}),(0,a.jsx)("button",{onClick:()=>{var t,r;I({id:e.id,values:{title:e.title,description:null!=(t=e.description)?t:"",place:null!=(r=e.place)?r:"",tags:Array.isArray(e.tags)?e.tags:[]}}),L(!0)},className:"w-9 h-9 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 flex items-center justify-center",title:C("item_list.edit"),children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M12 20h9"}),(0,a.jsx)("path",{d:"M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"})]})}),(0,a.jsx)("button",{onClick:()=>U(e.id),className:"w-9 h-9 rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600 flex items-center justify-center",title:C("item_list.delete"),children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("path",{d:"M3 6h18"}),(0,a.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,a.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,a.jsx)("path",{d:"M10 11v6M14 11v6"})]})})]})]}),e.description&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:e.description}),e.place&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true",children:[(0,a.jsx)("path",{d:"M12 21s-7-6.2-7-11a7 7 0 1 1 14 0c0 4.8-7 11-7 11z",fill:"none",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("circle",{cx:"12",cy:"10",r:"2",fill:"currentColor"})]}),(0,a.jsx)("span",{className:"truncate",children:e.place})]}),Array.isArray(e.tags)&&e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(null==(t=y[e.id])?void 0:t.length)?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:y[e.id].map((e,t)=>(0,a.jsx)(v.default,{src:e,alt:C("item_list.image_alt").replace("{idx}","".concat(t+1)),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer",onClick:()=>M(e)},t))}):(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:_?C("item_list.loading"):C("item_list.no_images")})]},e.id)})}),P>1&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,a.jsx)("button",{disabled:1===c,onClick:()=>d(e=>e-1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:C("item_list.previous"),children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none",children:(0,a.jsx)("path",{d:"M15 18l-6-6 6-6"})})}),Array.from({length:P},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>d(e),className:"min-w-9 h-9 px-2 flex items-center justify-center rounded-xl shadow-sm "+(e===c?"bg-primary text-primary-foreground":"bg-primary/60 text-primary-foreground hover:bg-primary"),children:e},e)),(0,a.jsx)("button",{disabled:c===P,onClick:()=>d(e=>e+1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:C("item_list.next"),children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none",children:(0,a.jsx)("path",{d:"M9 18l6-6-6-6"})})})]}),S&&"undefined"!=typeof document&&f.createPortal((0,a.jsxs)("div",{className:"fixed inset-0 z-500 flex flex-col items-center justify-center bg-background/90 backdrop-blur",onClick:()=>M(null),children:[(0,a.jsx)(v.default,{src:S,alt:C("item_list.full_size_image_alt"),unoptimized:!0,width:0,height:0,sizes:"100vw",className:"max-w-[500px] max-h-[500px] w-auto h-auto object-contain rounded-xl shadow-lg"}),(0,a.jsx)("button",{className:"mt-4 w-10 h-10 flex items-center justify-center rounded-xl bg-card text-card-foreground hover:bg-card/80 transition",title:C("item_list.close_modal"),children:(0,a.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none",children:(0,a.jsx)("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),document.body),(0,a.jsx)(j,{open:z,onOpenChange:e=>{L(e),e||I(null)},title:C("item_list.edit_item"),closeLabel:"X",children:(0,a.jsx)("section",{className:"relative z-50",children:(0,a.jsx)(b,{initial:null!=(t=null==D?void 0:D.values)?t:{title:"",description:"",place:"",tags:[]},submitLabel:C("common.save"),submitting:E,onSubmit:R,onCancel:()=>{L(!1),I(null)},showIconSubmit:!0},null==D?void 0:D.id)})})]})}function _(e){let{user:t,onSignOut:r}=e,[s,i]=(0,l.useState)(!1),{t:n}=(0,o.s)();return(0,a.jsx)("header",{className:"sticky top-0 z-400 backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,a.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:n("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,a.jsx)("span",{className:"font-semibold tracking-tight",children:n("header.title")})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>i(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",className:"w-5 h-5",children:[(0,a.jsx)("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,a.jsx)("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,a.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,a.jsx)("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),(0,a.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:t.email}),(0,a.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"▾"})]}),s&&(0,a.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,a.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:t.email}),(0,a.jsx)("button",{onClick:r,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",children:n("header.sign_out")})]})]})]})})}function N(){let{user:e,loading:t}=function(){let e=(0,i.useRouter)(),[t,r]=(0,l.useState)(null),[a,n]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=!0,t=t=>{var a;e&&(r(null!=(a=null==t?void 0:t.user)?a:null),n(!1))};(async()=>{try{let{data:e,error:r}=await s.N.auth.getSession();r?(console.error("Error fetching session:",r.message),t(null)):t(e.session)}catch(e){console.error("Unexpected error fetching session:",e),t(null)}})();let{data:a}=s.N.auth.onAuthStateChange((e,r)=>t(r));return()=>{e=!1,a.subscription.unsubscribe()}},[]),(0,l.useEffect)(()=>{a||t||(console.warn("Session invalid or expired. Redirecting to login."),e.replace("/login"))},[t,a,e]),{user:t,loading:a}}(),[r,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(0),{t:m}=(0,o.s)(),h=(0,i.useRouter)(),[g,p]=function(e,t){let[r,a]=(0,l.useState)(t);return(0,l.useEffect)(()=>{try{let t=localStorage.getItem(e);"1"===t&&a(!0),"0"===t&&a(!1)}catch(e){}},[e]),(0,l.useEffect)(()=>{try{localStorage.setItem(e,r?"1":"0")}catch(e){}},[e,r]),[r,a]}((0,l.useMemo)(()=>r?"cb_open_".concat(r):"cb_open_none",[r]),!1),f=(0,l.useCallback)(async()=>{try{let{error:e}=await s.N.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message),setTimeout(()=>h.replace("/login"),100)}catch(e){console.error("Unexpected error during sign-out:",e),h.replace("/login")}},[h]),b=(0,l.useCallback)(()=>{p(!1),u(e=>e+1)},[p]);return t?(0,a.jsx)(n.A,{}):e?(0,a.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,a.jsx)(_,{user:e,onSignOut:f}),(0,a.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,a.jsx)(x,{selectedCat:r,onSelect:c}),r?(0,a.jsxs)("section",{className:"relative z-50 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:m("page.entries")}),(0,a.jsx)("button",{onClick:()=>p(!0),className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110",children:"+"})]}),(0,a.jsx)(k,{categoryId:r},d)]}):(0,a.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:m("page.choose_category")}),(0,a.jsx)("p",{className:"text-sm opacity-70",children:m("page.add_collectibles")})]})]})})]}),r&&(0,a.jsx)(j,{open:g,onOpenChange:p,title:m("item_create.new_entry"),closeLabel:"X",children:(0,a.jsx)(y,{categoryId:r,onCreated:b})}),(0,a.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:m("page.footer")})]}):null}},6707:(e,t,r)=>{Promise.resolve().then(r.bind(r,6601))}},e=>{e.O(0,[192,145,441,964,358],()=>e(e.s=6707)),_N_E=e.O()}]);