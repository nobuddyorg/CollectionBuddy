(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{101:(e,t,a)=>{"use strict";a.d(t,{g:()=>n,I18nProvider:()=>i});var r=a(5155),l=a(2115);let s={de:JSON.parse('{"page":{"entries":"Eintr\xe4ge","choose_category":"Kategorie w\xe4hlen","add_collectibles":"Dann kannst du neue Sammlerst\xfccke hinzuf\xfcgen und Bilder hochladen.","footer":"Sammeln • Ordnen • Behalten"},"header":{"title":"CollectionBuddy","sign_out":"Abmelden"},"category_select":{"title":"Kategorie","select_placeholder":"Kategorie w\xe4hlen oder erstellen","new_category":"Neue Kategorie","add":"Hinzuf\xfcgen","delete":"Kategorie l\xf6schen","confirm_delete":"Diese Kategorie wirklich l\xf6schen?","load_error":"Kategorien konnten nicht geladen werden.","create_error":"Kategorie konnte nicht erstellt werden.","delete_error":"Kategorie konnte nicht gel\xf6scht werden.","open_category":"Kategorie \xf6ffnen","set":"Festlegen","cancel":"Abbrechen"},"item_create":{"new_entry":"Neuer Eintrag","title":"Titel","description":"Beschreibung","place_placeholder":"Ort (z. B. K\xf6ln)","searching":"Suche…","no_results":"Keine Treffer","remove_tag":"Tag {tag} entfernen","tags_placeholder":"Tags eingeben… (Enter/Komma)","adding":"F\xfcge hinzu…","add":"Hinzuf\xfcgen"},"item_list":{"confirm_delete":"Diesen Gegenstand l\xf6schen?","delete":"L\xf6schen","no_user_session":"Keine Benutzersitzung","uploading":"Lade hoch…","add_image":"Bild hinzuf\xfcgen","image_alt":"Bild {idx}","loading":"Wird geladen…","no_images":"Keine Bilder","previous":"Zur\xfcck","next":"Weiter"},"google_sign_in_button":{"sign_in_with_google":"Mit Google anmelden"},"login_page":{"circle_text":"CollectionBuddy • Sammeln • Ordnen • Behalten • Deine Sch\xe4tze im Blick • ","checking_login":"Anmeldung wird gepr\xfcft…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Dein digitales Sammelalbum f\xfcr M\xfcnzen, Pl\xfcschtiere, Briefmarken und alles, was dir am Herzen liegt."},"layout":{"description":"Sammeln • Ordnen • Behalten"}}'),en:JSON.parse('{"page":{"entries":"Entries","choose_category":"Choose category","add_collectibles":"Then you can add new collectibles and upload pictures.","footer":"Collect • Organize • Keep"},"header":{"title":"CollectionBuddy","sign_out":"Sign out"},"category_select":{"title":"Category","select_placeholder":"Select or create category","new_category":"New category","add":"Add","delete":"Delete category","confirm_delete":"Really delete this category?","load_error":"Could not load categories.","create_error":"Could not create category.","delete_error":"Could not delete category.","open_category":"Open category","set":"Set","cancel":"Cancel"},"item_create":{"new_entry":"New entry","title":"Title","description":"Description","place_placeholder":"City (e.g. Cologne)","searching":"Searching…","no_results":"No results","remove_tag":"Remove tag {tag}","tags_placeholder":"Enter tags… (Enter/Comma)","adding":"Adding…","add":"Add"},"item_list":{"confirm_delete":"Delete this item?","delete":"Delete","no_user_session":"No user session","uploading":"Uploading…","add_image":"Add image","image_alt":"Image {idx}","loading":"Loading…","no_images":"No images","previous":"Previous","next":"Next"},"google_sign_in_button":{"sign_in_with_google":"Sign in with Google"},"login_page":{"circle_text":"CollectionBuddy • Collect • Organize • Keep • Your treasures at a glance • ","checking_login":"Checking login…","title_collection":"Collection","title_buddy":"Buddy","subtitle":"Your digital scrapbook for coins, stuffed animals, stamps and everything you love."},"layout":{"description":"Collect • Organize • Keep"}}')},n=(0,l.createContext)(void 0),i=e=>{let{children:t}=e,[a,i]=(0,l.useState)("de");(0,l.useEffect)(()=>{let e=navigator.language.split("-")[0];e in s&&i(e)},[]);let o=(0,l.useCallback)(e=>{let t=e.split("."),r=s[a];for(let a of t)if("object"!=typeof r||null===r||!(a in r))return e;else{let t=r[a];if("string"==typeof t)r=t;else{if("object"!=typeof t||null===t)return e;r=t}}return"string"==typeof r?r:e},[a]);return(0,r.jsx)(n.Provider,{value:{lang:a,setLang:i,t:o},children:t})}},2184:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(5155),l=a(5875);function s(e){let{label:t}=e,{t:a}=(0,l.s)();return(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col items-center justify-center gap-3 bg-black/60 backdrop-blur-sm",children:[(0,r.jsx)("div",{className:"animate-spin h-8 w-8 rounded-full border-2 border-white/80 border-t-transparent"}),(0,r.jsx)("span",{className:"text-white text-lg font-medium",children:null!=t?t:a("item_list.loading")})]})}},5875:(e,t,a)=>{"use strict";a.d(t,{s:()=>s});var r=a(2115),l=a(101);let s=()=>{let e=(0,r.useContext)(l.g);if(!e)throw Error("useI18n must be used within an I18nProvider");return e}},5983:(e,t,a)=>{"use strict";a.d(t,{N:()=>r});let r=(0,a(2354).UU)("https://mopbqdyfjvdfpffhetyf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vcGJxZHlmanZkZnBmZmhldHlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ4MzQ2NDUsImV4cCI6MjA3MDQxMDY0NX0.qtzuwQn1QB3tOtN2u7mnEigMa2VBIyAxu_eU6cEXc68")},9109:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var r=a(5155),l=a(2115),s=a(5983),n=a(5695),i=a(2184),o=a(5875);function c(e){let{selectedCat:t,onSelect:a,sortedCats:l,isLoading:s,t:n,setExpanded:i}=e;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;a(t),t&&i(!1)},disabled:s,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-white/60 dark:bg-neutral-800/70 outline-none focus:border-neutral-400 dark:focus:border-neutral-600 transition","aria-label":n("category_select.select_placeholder"),children:[(0,r.jsx)("option",{value:"",children:n("category_select.select_placeholder")}),l.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"▾"})]})}function d(e){let{name:t,setName:a,createCategory:l,setExpanded:s,t:n}=e;return(0,r.jsx)("input",{value:t,onChange:e=>a(e.target.value),placeholder:n("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&l(),"Escape"===e.key&&s(!1)},className:"w-full rounded-xl border px-3 py-2 bg-white/60 dark:bg-neutral-800/70 outline-none focus:border-neutral-400 dark:focus:border-neutral-600"})}function u(e){let{onClick:t,disabled:a,isCreating:l,label:s}=e;return(0,r.jsx)("button",{onClick:t,disabled:a,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center bg-black text-white hover:brightness-110 active:scale-[0.99] disabled:opacity-60",children:l?"…":(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,r.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),(0,r.jsx)("span",{className:"hidden sm:inline",children:s})]})})}function m(e){let{onClick:t,label:a}=e;return(0,r.jsxs)("button",{onClick:t,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center border bg-white/60 dark:bg-neutral-800/70 hover:bg-neutral-100 dark:hover:bg-neutral-700",children:[(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M20 6L9 17l-5-5"})}),(0,r.jsx)("span",{className:"hidden sm:inline",children:a})]})}function h(e){let{title:t,name:a}=e;return(0,r.jsxs)("div",{className:"truncate",children:[(0,r.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,r.jsx)("div",{className:"font-medium truncate",children:a})]})}function g(e){let{onClick:t,disabled:a,label:l}=e;return(0,r.jsxs)("button",{onClick:t,disabled:a,className:"rounded-xl w-10 h-10 sm:w-auto sm:px-4 sm:py-2 flex items-center justify-center border text-red-600 border-red-500/40 bg-white/60 dark:bg-neutral-800/70 hover:bg-red-50 dark:hover:bg-red-950/30 disabled:opacity-60",children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,r.jsx)("path",{d:"M3 6h18"}),(0,r.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,r.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,r.jsx)("path",{d:"M10 11v6M14 11v6"})]}),(0,r.jsx)("span",{className:"hidden sm:inline",children:l})]})}function p(e){let{onClick:t,label:a}=e;return(0,r.jsx)("button",{onClick:t,className:"rounded-full w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center border bg-white/60 dark:bg-neutral-800/70 hover:bg-neutral-100 dark:hover:bg-neutral-700","aria-label":a,title:a,children:(0,r.jsx)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})})})}function x(e){let{selectedCat:t,onSelect:a}=e,{t:n}=(0,o.s)(),[i,x]=(0,l.useState)([]),[b,f]=(0,l.useState)(""),[y,j]=(0,l.useState)(!1),[v,w]=(0,l.useState)(!1),[k,_]=(0,l.useState)(!1),[N,C]=(0,l.useState)(!t);(0,l.useEffect)(()=>{C(!t)},[t]);let S=(0,l.useMemo)(()=>[...i].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[i]),E=(0,l.useMemo)(()=>{var e;return t&&null!=(e=i.find(e=>e.id===t))?e:null},[i,t]),B=(0,l.useCallback)(async()=>{j(!0);try{let{data:e,error:t}=await s.N.from("categories").select("id,name");if(t)throw t;x(null!=e?e:[])}catch(e){console.error(e),alert(n("category_select.loadError"))}finally{j(!1)}},[n]);(0,l.useEffect)(()=>{B()},[B]);let M=async()=>{let e=b.trim();if(e&&!v){w(!0);try{let{data:t,error:r}=await s.N.from("categories").insert({name:e}).select("id,name").single();if(r)throw r;f(""),await B(),(null==t?void 0:t.id)&&(a(t.id),C(!1))}catch(e){console.error(e),alert(n("category_select.createError"))}finally{w(!1)}}},z=async()=>{if(t&&!k&&confirm(n("category_select.confirmDelete"))){_(!0);try{let{error:e}=await s.N.from("categories").delete().eq("id",t);if(e)throw e;a(null),await B(),C(!0)}catch(e){console.error(e),alert(n("category_select.deleteError"))}finally{_(!1)}}};return!N&&E?(0,r.jsxs)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,r.jsx)(h,{title:n("category_select.title"),name:E.name}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(p,{onClick:()=>C(!0),label:n("category_select.open_category")})})]}):(0,r.jsxs)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,r.jsx)("h2",{className:"text-base font-semibold",children:n("category_select.title")}),(0,r.jsx)(c,{selectedCat:t,onSelect:a,sortedCats:S,isLoading:y,t:n,setExpanded:C}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d,{name:b,setName:f,createCategory:M,setExpanded:C,t:n}),(0,r.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&""!==t&&(0,r.jsx)(g,{onClick:z,disabled:k,label:n("category_select.delete")}),t&&""!==t&&""===b.trim()&&(0,r.jsx)(m,{onClick:()=>{C(!1),a(t)},label:n("category_select.set")}),(!t||""!==b.trim())&&(0,r.jsx)(u,{onClick:M,disabled:""===b.trim()||v,isCreating:v,label:n("category_select.add")})]})]})]})}function b(e){let{categoryId:t,onCreated:a}=e,[n,i]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[h,g]=(0,l.useState)(!1),[p,x]=(0,l.useState)([]),[b,f]=(0,l.useState)(!1),[y,j]=(0,l.useState)(-1),v=(0,l.useRef)(null),w=(0,l.useRef)(null),k=(0,l.useRef)(null),[_,N]=(0,l.useState)([]),[C,S]=(0,l.useState)(""),[E,B]=(0,l.useState)(!1),{t:M}=(0,o.s)(),z=e=>N(t=>t.filter(t=>t!==e));(0,l.useEffect)(()=>{if(!h||u.trim().length<3){x([]),j(-1);return}let e=u.trim(),t=setTimeout(async()=>{try{var t;null==(t=v.current)||t.abort();let a=new AbortController;v.current=a,f(!0);let r=new URL("https://photon.komoot.io/api/");r.searchParams.set("q",e),r.searchParams.set("limit","5"),r.searchParams.set("lang","de");let l=await fetch(r.toString(),{signal:a.signal});if(!l.ok)throw Error("HTTP ".concat(l.status));let s=await l.json();x(s.features),j(-1)}catch(e){x([]),j(-1)}finally{f(!1)}},300);return()=>clearTimeout(t)},[u,h]),(0,l.useEffect)(()=>{let e=e=>{w.current&&!w.current.contains(e.target)&&k.current&&!k.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let D=e=>{let t=e.properties,a=t.city||t.town||t.village||t.municipality||t.name;m((t.country?"".concat(a,", ").concat(t.country):a)||""),x([]),j(-1),g(!1)},L=(0,l.useCallback)(async()=>{let e=n.trim();if(e&&!E){B(!0);try{let{data:r,error:l}=await s.N.from("items").insert({title:e,description:c.trim()||null,place:u.trim()||null,tags:_}).select("id").single();if(l||!r)return;let{error:n}=await s.N.from("item_categories").insert({item_id:r.id,category_id:t});if(n)return;i(""),d(""),m(""),N([]),S(""),a()}finally{B(!1)}}},[n,c,u,_,t,E,a]),I=(0,l.useMemo)(()=>!!n.trim(),[n]);return(0,r.jsxs)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur p-4 sm:p-5 shadow-sm space-y-3",children:[(0,r.jsx)("h2",{className:"text-base font-semibold mb-1",children:M("item_create.new_entry")}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,r.jsx)("input",{"aria-label":M("item_create.title"),value:n,onChange:e=>i(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),placeholder:M("item_create.title"),className:"rounded-xl border px-3 py-2 bg-white/60 dark:bg-neutral-800/70 outline-none focus:border-neutral-400 dark:focus:border-neutral-600"}),(0,r.jsx)("input",{"aria-label":M("item_create.description"),value:c,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&L(),placeholder:M("item_create.description"),className:"rounded-xl border px-3 py-2 bg-white/60 dark:bg-neutral-800/70 outline-none focus:border-neutral-400 dark:focus:border-neutral-600"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{className:"relative",ref:w,children:[(0,r.jsx)("input",{ref:k,"aria-label":M("item_create.place_placeholder"),value:u,onChange:e=>{let t=e.target.value;m(t),""===t.trim()&&(x([]),j(-1),g(!0))},onFocus:()=>g(!0),onKeyDown:e=>{if(p.length)if("ArrowDown"===e.key)e.preventDefault(),j(e=>(e+1)%p.length);else if("ArrowUp"===e.key)e.preventDefault(),j(e=>e<=0?p.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=y>=0?p[y]:p[0];t&&D(t)}else"Escape"===e.key&&(x([]),j(-1),g(!1))},placeholder:M("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-white/60 dark:bg-neutral-800/70 outline-none focus:border-neutral-400 dark:focus:border-neutral-600",autoComplete:"off"}),h&&(b||p.length>0)&&(0,r.jsxs)("div",{className:"absolute z-[9999] mt-1 w-full rounded-xl border bg-white dark:bg-neutral-900 shadow-lg overflow-hidden",children:[b&&(0,r.jsx)("div",{className:"px-3 py-2 text-sm opacity-70",children:M("item_create.searching")}),!b&&p.map((e,t)=>{let a=e.properties,l=a.city||a.town||a.village||a.municipality||a.name,s=[a.state,a.country].filter(Boolean).join(", ");return(0,r.jsxs)("button",{type:"button",onMouseDown:e=>e.preventDefault(),onClick:()=>D(e),className:"block w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-800 ".concat(t===y?"bg-neutral-100 dark:bg-neutral-800":""),children:[(0,r.jsx)("div",{className:"font-medium",children:l}),(0,r.jsx)("div",{className:"opacity-70",children:s})]},a.osm_id)}),!b&&0===p.length&&(0,r.jsx)("div",{className:"px-3 py-2 text-sm opacity-70",children:M("item_create.no_results")})]})]}),(0,r.jsxs)("div",{className:"rounded-xl border bg-white/60 dark:bg-neutral-800/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-neutral-400 dark:focus-within:border-neutral-600",children:[_.map(e=>(0,r.jsxs)("span",{className:"flex items-center gap-1 bg-neutral-200 dark:bg-neutral-700 rounded-full px-2 py-0.5 text-sm",children:[e,(0,r.jsx)("button",{type:"button",onClick:()=>z(e),className:"text-neutral-600 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-white","aria-label":M("item_create.remove_tag").replace("{tag}",e),children:"\xd7"})]},e)),(0,r.jsx)("input",{value:C,onChange:e=>S(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=C.trim();!t||_.includes(t)||(N(e=>[...e,t]),S(""))}else"Backspace"===e.key&&!C&&_.length>0&&z(_[_.length-1])},placeholder:0===_.length?M("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:L,disabled:E||!I,className:"rounded-xl px-4 py-2 bg-black text-white hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center gap-2",children:E?M("item_create.adding"):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,r.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),(0,r.jsx)("span",{className:"hidden sm:inline",children:M("item_create.add")})]})})})]})}var f=a(6766),y=a(1802);function j(e){let{categoryId:t}=e,[a,n]=(0,l.useState)([]),[i,c]=(0,l.useState)(1),[d,u]=(0,l.useState)(0),[m,h]=(0,l.useState)(null),[g,p]=(0,l.useState)(null),[x,b]=(0,l.useState)({}),[j,v]=(0,l.useState)(!1),{t:w}=(0,o.s)(),[k,_]=(0,l.useState)(null);(0,l.useEffect)(()=>{s.N.auth.getUser().then(e=>{var t,a;let{data:r}=e;return h(null!=(a=null==(t=r.user)?void 0:t.id)?a:null)})},[]),(0,l.useEffect)(()=>{c(1)},[t]);let N=(0,l.useCallback)(async()=>{v(!0);let e=(i-1)*6,{data:a,error:r,count:l}=await s.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",t).order("created_at",{ascending:!1}).range(e,e+6-1).returns();v(!1),r||(n((null!=a?a:[]).map(e=>{var t,a;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(a=e.tags)?a:[]}})),u(l||0))},[t,i]);(0,l.useEffect)(()=>{N()},[N]);let C=(0,l.useCallback)(async e=>{var t;let{data:a}=await s.N.auth.getUser(),r=null==(t=a.user)?void 0:t.id;if(!r)return;let l="".concat(r,"/").concat(e),{data:n,error:i}=await s.N.storage.from("item-images").list(l,{limit:12,sortBy:{column:"created_at",order:"desc"}});if(i)return;if(!(null==n?void 0:n.length))return void b(t=>({...t,[e]:[]}));let o=n.map(e=>"".concat(l,"/").concat(e.name)),c=await Promise.all(o.map(async e=>{let{data:t,error:a}=await s.N.storage.from("item-images").createSignedUrl(e,3600);return a?"":(null==t?void 0:t.signedUrl)||""}));b(t=>({...t,[e]:c.filter(Boolean)}))},[]),S=(0,l.useCallback)(async e=>{await Promise.all(e.map(e=>C(e)))},[C]);(0,l.useEffect)(()=>{a.length&&m&&S(a.map(e=>e.id))},[a,m,S]);let E=(0,l.useCallback)(async e=>{confirm(w("item_list.confirm_delete"))&&(await s.N.from("items").delete().eq("id",e),await N())},[N,w]),B=(0,l.useCallback)(async(e,t)=>{try{var a;p(e);let{data:r}=await s.N.auth.getUser(),l=null==(a=r.user)?void 0:a.id;if(!l)throw Error(w("item_list.no_user_session"));let n=await (0,y.A)(t,{maxWidthOrHeight:500,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),i="".concat(l,"/").concat(e,"/").concat(crypto.randomUUID(),"-").concat(n.name),{error:o}=await s.N.storage.from("item-images").upload(i,n);if(o)throw o;await C(e)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{p(null)}},[C,w]),M=(0,l.useMemo)(()=>Math.ceil(d/6),[d]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:a.map(e=>{var t;return(0,r.jsxs)("li",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,r.jsx)("div",{className:"font-medium truncate",children:e.title}),(0,r.jsxs)("button",{onClick:()=>E(e.id),className:"rounded-lg border px-2 py-1 text-red-600 border-red-500/40 hover:bg-red-50 dark:hover:bg-red-950/30 flex items-center justify-center gap-2",children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,r.jsx)("path",{d:"M3 6h18"}),(0,r.jsx)("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,r.jsx)("path",{d:"M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"}),(0,r.jsx)("path",{d:"M10 11v6M14 11v6"})]}),(0,r.jsx)("span",{className:"hidden sm:inline",children:w("item_list.delete")})]})]}),e.description&&(0,r.jsx)("div",{className:"text-sm opacity-80 line-clamp-3",children:e.description}),e.place&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm opacity-80",children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true",children:[(0,r.jsx)("path",{d:"M12 21s-7-6.2-7-11a7 7 0 1 1 14 0c0 4.8-7 11-7 11z",fill:"none",stroke:"currentColor",strokeWidth:"2"}),(0,r.jsx)("circle",{cx:"12",cy:"10",r:"2",fill:"currentColor"})]}),(0,r.jsx)("span",{className:"truncate",children:e.place})]}),Array.isArray(e.tags)&&e.tags.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>(0,r.jsx)("span",{className:"inline-flex items-center gap-1 bg-neutral-200/80 dark:bg-neutral-700/70 rounded-full px-2 py-0.5 text-xs",children:e},e))}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("label",{className:"inline-flex cursor-pointer items-center rounded-xl border px-3 py-2 hover:bg-neutral-50 dark:hover:bg-neutral-800/60 transition",children:[(0,r.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:!m||g===e.id,onChange:t=>{var a;let r=null==(a=t.target.files)?void 0:a[0];r&&(b(t=>({...t,[e.id]:[URL.createObjectURL(r),...t[e.id]||[]]})),B(e.id,r))}}),g===e.id?(0,r.jsx)("span",{className:"text-sm",children:w("item_list.uploading")}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-5 h-5 sm:hidden","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M4 4h16v16H4z"}),(0,r.jsx)("path",{d:"M12 8v8M8 12h8"})]}),(0,r.jsx)("span",{className:"hidden sm:inline text-sm",children:w("item_list.add_image")})]})]})}),(null==(t=x[e.id])?void 0:t.length)?(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:x[e.id].map((e,t)=>(0,r.jsx)(f.default,{src:e,alt:w("item_list.image_alt").replace("{idx}","".concat(t+1)),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer",onClick:()=>_(e)},t))}):(0,r.jsx)("div",{className:"text-sm opacity-60",children:j?w("item_list.loading"):w("item_list.no_images")})]},e.id)})}),M>1&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,r.jsx)("button",{disabled:1===i,onClick:()=>c(e=>e-1),className:"rounded-xl border px-3 py-1 disabled:opacity-50",children:w("item_list.previous")}),Array.from({length:M},(e,t)=>t+1).map(e=>(0,r.jsx)("button",{onClick:()=>c(e),className:"rounded-xl border px-3 py-1 min-w-9 "+(e===i?"bg-black text-white":"hover:bg-neutral-50 dark:hover:bg-neutral-800/60"),children:e},e)),(0,r.jsx)("button",{disabled:i===M,onClick:()=>c(e=>e+1),className:"rounded-xl border px-3 py-1 disabled:opacity-50",children:w("item_list.next")})]}),k&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-80 flex items-center justify-center",onClick:()=>_(null),children:(0,r.jsx)(f.default,{src:k,alt:"Full size",width:1e3,height:1e3,unoptimized:!0,className:"max-w-full max-h-full rounded-xl shadow-lg"})})]})}function v(e){let{user:t,onSignOut:a}=e,[s,n]=(0,l.useState)(!1),{t:i}=(0,o.s)();return(0,r.jsx)("header",{className:"sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,r.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:i("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,r.jsx)("span",{className:"font-semibold tracking-tight",children:i("header.title")})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>n(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition",children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",className:"w-5 h-5",children:[(0,r.jsx)("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,r.jsx)("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,r.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,r.jsx)("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]}),(0,r.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:t.email}),(0,r.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"▾"})]}),s&&(0,r.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,r.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:t.email}),(0,r.jsx)("button",{onClick:a,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",children:i("header.sign_out")})]})]})]})})}function w(){let{user:e,loading:t}=function(){let e=(0,n.useRouter)(),[t,a]=(0,l.useState)(null),[r,i]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let t=!0,r=r=>{var l;if(!t)return;let s=null!=(l=null==r?void 0:r.user)?l:null;a(s),i(!1),s||e.replace("/login")};s.N.auth.getSession().then(e=>{let{data:t}=e;return r(t.session)});let{data:l}=s.N.auth.onAuthStateChange((e,t)=>r(t));return()=>{t=!1,l.subscription.unsubscribe()}},[e]),{user:t,loading:r}}(),[a,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(0),{t:m}=(0,o.s)(),h=(0,l.useCallback)(async()=>{await s.N.auth.signOut()},[]);return t?(0,r.jsx)(i.A,{}):e?(0,r.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,r.jsx)(v,{user:e,onSignOut:h}),(0,r.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,r.jsx)(x,{selectedCat:a,onSelect:c}),a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{categoryId:a,onCreated:()=>u(e=>e+1)}),(0,r.jsxs)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,r.jsx)("h2",{className:"text-base font-semibold mb-3",children:m("page.entries")}),(0,r.jsx)(j,{categoryId:a},d)]})]}):(0,r.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:m("page.choose_category")}),(0,r.jsx)("p",{className:"text-sm opacity-70",children:m("page.add_collectibles")})]})]})})]}),(0,r.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:m("page.footer")})]}):null}},9870:(e,t,a)=>{Promise.resolve().then(a.bind(a,9109))}},e=>{e.O(0,[192,145,441,964,358],()=>e(e.s=9870)),_N_E=e.O()}]);