(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6601:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var a=r(5155),l=r(2115),s=r(5983),i=r(5695),n=r(2184),o=r(5875),c=r(5671);function d(e){let{selectedCat:t,onSelect:r,sortedCats:l,isLoading:s,t:i,setExpanded:n}=e;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:null!=t?t:"",onChange:e=>{let t=e.target.value||null;r(t),t&&n(!1)},disabled:s,className:"w-full appearance-none rounded-xl border px-3 py-2 pr-10 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary transition","aria-label":i("category_select.select_placeholder"),children:[(0,a.jsx)("option",{value:"",children:i("category_select.select_placeholder")}),l.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("span",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-sm opacity-70",children:"â–¾"})]})}function u(e){let{name:t,setName:r,createCategory:l,setExpanded:s,t:i}=e;return(0,a.jsx)("input",{value:t,onChange:e=>r(e.target.value),placeholder:i("category_select.new_category"),onKeyDown:e=>{"Enter"===e.key&&l(),"Escape"===e.key&&s(!1)},className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})}function m(e){let{onClick:t,disabled:r,isCreating:l,label:s}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:s,children:l?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):"+"})}function p(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110",title:r,children:(0,a.jsx)(c.Ay,{icon:c.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})})}function h(e){let{title:t,name:r}=e;return(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("h2",{className:"text-base font-semibold mb-1",children:t}),(0,a.jsx)("div",{className:"font-medium truncate",children:r})]})}function g(e){let{onClick:t,disabled:r,label:l}=e;return(0,a.jsx)("button",{onClick:t,disabled:r,className:"w-8 h-8 flex items-center justify-center rounded-xl bg-red-500 text-white hover:bg-red-600 disabled:opacity-50",title:l,children:(0,a.jsx)(c.Ay,{icon:c.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function x(e){let{onClick:t,label:r}=e;return(0,a.jsx)("button",{onClick:t,className:"rounded-xl w-8 h-8 sm:w-9 sm:h-9 flex items-center justify-center bg-primary text-primary-foreground shadow-sm hover:brightness-110","aria-label":r,title:r,children:(0,a.jsx)(c.Ay,{icon:c.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})}function f(e){let{selectedCat:t,onSelect:r}=e,{t:i}=(0,o.s)(),[n,c]=(0,l.useState)([]),[f,b]=(0,l.useState)(""),[y,w]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[k,N]=(0,l.useState)(!1),[_,C]=(0,l.useState)(!t);(0,l.useEffect)(()=>{C(!t)},[t]);let S=(0,l.useMemo)(()=>[...n].sort((e,t)=>e.name.localeCompare(t.name,"de",{sensitivity:"base"})),[n]),E=(0,l.useMemo)(()=>{var e;return t&&null!=(e=n.find(e=>e.id===t))?e:null},[n,t]),A=(0,l.useCallback)(async()=>{w(!0);try{let{data:e,error:t}=await s.N.from("categories").select("id,name");if(t)throw t;let a=null!=e?e:[];c(a),1===a.length&&(r(a[0].id),C(!1))}catch(e){console.error(e),alert(i("category_select.loadError"))}finally{w(!1)}},[i,r]);(0,l.useEffect)(()=>{A()},[A]);let T=async()=>{let e=f.trim();if(e&&!j){v(!0);try{let{data:t,error:a}=await s.N.from("categories").insert({name:e}).select("id,name").single();if(a)throw a;b(""),await A(),(null==t?void 0:t.id)&&(r(t.id),C(!1))}catch(e){console.error(e),alert(i("category_select.createError"))}finally{v(!1)}}},L=async()=>{if(t&&!k&&confirm(i("category_select.confirmDelete"))){N(!0);try{let{error:e}=await s.N.from("categories").delete().eq("id",t);if(e)throw e;r(null),await A(),C(!0)}catch(e){console.error(e),alert(i("category_select.deleteError"))}finally{N(!1)}}};return!_&&E?(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 flex items-center justify-between",children:[(0,a.jsx)(h,{title:i("category_select.title"),name:E.name}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(x,{onClick:()=>C(!0),label:i("category_select.open_category")})})]}):(0,a.jsxs)("section",{className:"rounded-2xl border bg-card/70 dark:bg-card/60 backdrop-blur shadow-sm p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:i("category_select.title")}),(0,a.jsx)(d,{selectedCat:t,onSelect:r,sortedCats:S,isLoading:y,t:i,setExpanded:C}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u,{name:f,setName:b,createCategory:T,setExpanded:C,t:i}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[t&&""!==t&&(0,a.jsx)(g,{onClick:L,disabled:k,label:i("category_select.delete")}),t&&""!==t&&""===f.trim()&&(0,a.jsx)(p,{onClick:()=>{C(!1),r(t)},label:i("category_select.set")}),(!t||""!==f.trim())&&(0,a.jsx)(m,{onClick:T,disabled:""===f.trim()||j,isCreating:j,label:i("category_select.add")})]})]})]})}var b=r(7650);function y(e){let{initial:t,submitting:r=!1,submitLabel:s,onSubmit:i,onCancel:n,showIconSubmit:d=!1}=e,{t:u,locale:m}=(0,o.s)(),[p,h]=(0,l.useState)(t.title),[g,x]=(0,l.useState)(t.description),[f,y]=(0,l.useState)(t.place),[w,j]=(0,l.useState)(t.tags),[v,k]=(0,l.useState)(!1),[N,_]=(0,l.useState)([]),[C,S]=(0,l.useState)(!1),[E,A]=(0,l.useState)(-1),T=(0,l.useRef)(null),L=(0,l.useRef)(null),W=(0,l.useRef)(null),D=(0,l.useRef)(null),[I,U]=(0,l.useState)("");(0,l.useEffect)(()=>{h(t.title),x(t.description),y(t.place),j(t.tags)},[t]);let F=(0,l.useMemo)(()=>m&&"string"==typeof m?m:"undefined"!=typeof navigator&&navigator.language?navigator.language:"en",[m]),M=(0,l.useMemo)(()=>{let e=(F.split("-")[1]||"").toUpperCase();return new Set(["DE","AT","CH","LI","LU"]).has(e)?"de":"en"},[F]),P=(0,l.useMemo)(()=>{let e=Intl.DisplayNames;return e?new e([M],{type:"region"}):null},[M]),z=(0,l.useCallback)(e=>{let t=e.city||e.town||e.village||e.municipality||e.name||"",r=e.country||(e.countrycode&&P?P.of(e.countrycode.toUpperCase()):void 0),a=[e.state,r].filter(Boolean).join(", "),l="".concat(t,"|||").concat(a).toLowerCase().replace(/\s+/g," ").trim();return{city:t,line2:a,key:l}},[P]);(0,l.useEffect)(()=>{if(!v||f.trim().length<3){_([]),A(-1);return}let e=f.trim(),t=setTimeout(async()=>{try{var t;null==(t=T.current)||t.abort();let r=new AbortController;T.current=r,S(!0);let a=new URL("https://photon.komoot.io/api/");a.searchParams.set("q",e),a.searchParams.set("limit","5"),a.searchParams.set("lang",M);let l=await fetch(a.toString(),{signal:r.signal});if(!l.ok)throw Error("HTTP ".concat(l.status));let s=await l.json(),i=Array.from(new Map(s.features.map(e=>[e.properties.osm_id,e])).values()),n=new Set,o=[];for(let e of i){let{key:t}=z(e.properties);n.has(t)||(n.add(t),o.push(e))}_(o),A(-1)}catch(e){_([]),A(-1)}finally{S(!1)}},300);return()=>clearTimeout(t)},[f,v,M,z]),(0,l.useEffect)(()=>{let e=e=>{var t,r,a;let l=e.target,s=null==(t=W.current)?void 0:t.contains(l),i=null==(r=L.current)?void 0:r.contains(l),n=null==(a=D.current)?void 0:a.contains(l);s||i||n||k(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let R=e=>{let{city:t,line2:r}=z(e.properties),a=r.split(", ").pop()||"";y(a?"".concat(t,", ").concat(a):t),_([]),A(-1),k(!1)},O=e=>j(t=>t.filter(t=>t!==e)),B=!!p.trim(),K="function"==typeof n;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsx)("input",{"aria-label":u("item_create.title"),value:p,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&B&&i({title:p,description:g,place:f,tags:w}),placeholder:u("item_create.title"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"}),(0,a.jsx)("input",{"aria-label":u("item_create.description"),value:g,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&B&&i({title:p,description:g,place:f,tags:w}),placeholder:u("item_create.description"),className:"rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,a.jsxs)("div",{className:"relative",ref:L,children:[(0,a.jsx)("input",{ref:W,"aria-label":u("item_create.place_placeholder"),value:f,onChange:e=>{let t=e.target.value;y(t),""===t.trim()&&(_([]),A(-1),k(!0))},onFocus:()=>k(!0),onKeyDown:e=>{if(N.length)if("ArrowDown"===e.key)e.preventDefault(),A(e=>(e+1)%N.length);else if("ArrowUp"===e.key)e.preventDefault(),A(e=>e<=0?N.length-1:e-1);else if("Enter"===e.key){e.preventDefault();let t=E>=0?N[E]:N[0];t&&R(t)}else"Escape"===e.key&&(_([]),A(-1),k(!1))},placeholder:u("item_create.place_placeholder"),className:"w-full rounded-xl border px-3 py-2 bg-card/60 dark:bg-card/70 outline-none focus:border-primary dark:focus:border-primary",autoComplete:"off"}),v&&(C||N.length>0)&&b.createPortal((()=>{var e;let t=null==(e=W.current)?void 0:e.getBoundingClientRect();return t?(0,a.jsxs)("div",{ref:D,className:"fixed rounded-xl border bg-card dark:bg-card shadow-lg overflow-hidden z-[2000]",style:{top:t.bottom,left:t.left,width:t.width},children:[C&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:u("item_create.searching")}),!C&&N.map((e,t)=>{let r=e.properties,l=r.city||r.town||r.village||r.municipality||r.name,s=[r.state,r.country].filter(Boolean).join(", ");return(0,a.jsxs)("button",{type:"button",onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>R(e),className:"block w-full text-left px-3 py-2 text-sm hover:bg-primary/10 dark:hover:bg-primary/10 ".concat(t===E?"bg-primary/10 dark:bg-primary/10":""),children:[(0,a.jsx)("div",{className:"font-medium",children:l}),(0,a.jsx)("div",{className:"opacity-70",children:s})]},r.osm_id)}),!C&&0===N.length&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:u("item_create.no_results")})]}):null})(),document.body)]}),(0,a.jsxs)("div",{className:"rounded-xl border bg-card/60 dark:bg-card/70 px-2 py-1 flex flex-wrap items-center gap-1 focus-within:border-primary dark:focus-within:border-primary",children:[w.map(e=>(0,a.jsxs)("span",{className:"flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-sm",children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>O(e),className:"w-4 h-4 flex items-center justify-center rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600",title:u("item_create.remove_tag").replace("{tag}",e),children:(0,a.jsx)(c.Ay,{icon:c.AT.Close,className:"w-3 h-3",stroke:"currentColor",strokeWidth:"3",fill:"none"})})]},e)),(0,a.jsx)("input",{value:I,onChange:e=>U(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=I.trim();!t||w.includes(t)||(j(e=>[...e,t]),U(""))}else"Backspace"===e.key&&!I&&w.length>0&&O(w[w.length-1])},placeholder:0===w.length?u("item_create.tags_placeholder"):"",className:"flex-1 min-w-[100px] bg-transparent outline-none py-1 text-sm"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[n&&!d&&(0,a.jsx)("button",{type:"button",onClick:n,className:"h-9 px-3 rounded-xl border shadow-sm hover:bg-muted/50",children:u("common.cancel")}),d?(0,a.jsx)("button",{type:"button",disabled:r||!B,onClick:()=>B&&i({title:p,description:g,place:f,tags:w}),className:"w-10 h-10 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 active:scale-[0.99] disabled:opacity-60 flex items-center justify-center",title:s,children:r?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/40 border-t-white rounded-full animate-spin"}):K?(0,a.jsx)(c.Ay,{icon:c.AT.Check,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"}):(0,a.jsx)(c.Ay,{icon:c.AT.Plus,className:"w-6 h-6",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,a.jsx)("button",{type:"button",disabled:r||!B,onClick:()=>B&&i({title:p,description:g,place:f,tags:w}),className:"h-9 px-3 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-60",children:s})]})]})}function w(e){let{categoryId:t,onCreated:r}=e,{t:i}=(0,o.s)(),[n,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(0),m=(0,l.useCallback)(async e=>{if(!n){c(!0);try{let{data:a,error:l}=await s.N.from("items").insert({title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags}).select("id").single();if(l||!a)return;let{error:i}=await s.N.from("item_categories").insert({item_id:a.id,category_id:t});if(i)return;r(),u(e=>e+1)}finally{c(!1)}}},[t,n,r]);return(0,a.jsx)("section",{className:"p-4 sm:p-5 space-y-3 z-70 relative",children:(0,a.jsx)(y,{initial:{title:"",description:"",place:"",tags:[]},submitting:n,submitLabel:i("item_create.add"),onSubmit:m,showIconSubmit:!0},d)})}var j=r(6766),v=r(1802);function k(e){let{open:t,onOpenChange:r,title:l,closeLabel:s,children:i}=e;return"undefined"==typeof document?null:b.createPortal((0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-500 bg-black/40 backdrop-blur-sm transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),onClick:()=>r(!1)}),(0,a.jsx)("div",{className:"fixed inset-0 z-600 flex items-center justify-center p-4 transition-opacity ".concat(t?"opacity-100":"pointer-events-none opacity-0"),children:(0,a.jsxs)("div",{className:"bg-background rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90dvh] flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:l}),(0,a.jsx)("button",{className:"rounded-md px-3 py-1 text-sm border",onClick:()=>r(!1),"aria-label":s,children:s})]}),(0,a.jsx)("div",{className:"p-4 overflow-auto",children:i})]})})]}),document.body)}function N(e){var t;let{categoryId:r}=e,[i,n]=(0,l.useState)([]),[d,u]=(0,l.useState)(1),[m,p]=(0,l.useState)(0),[h,g]=(0,l.useState)(null),[x,f]=(0,l.useState)(null),[w,N]=(0,l.useState)({}),[_,C]=(0,l.useState)(!1),{t:S}=(0,o.s)(),[E,A]=(0,l.useState)(null),[T,L]=(0,l.useState)(!1),[W,D]=(0,l.useState)(null),[I,U]=(0,l.useState)({}),F=(0,l.useRef)(0),[M,P]=(0,l.useState)(!1),[z,R]=(0,l.useState)(null),[O,B]=(0,l.useState)(""),[K,q]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=setTimeout(()=>q(O.trim()),200);return()=>clearTimeout(e)},[O]),(0,l.useEffect)(()=>u(1),[r,K]),(0,l.useEffect)(()=>{s.N.auth.getUser().then(e=>{var t,r;let{data:a}=e;return g(null!=(r=null==(t=a.user)?void 0:t.id)?r:null)})},[]),(0,l.useEffect)(()=>u(1),[r]);let H=(0,l.useCallback)(async()=>{let e=++F.current;e===F.current&&C(!0);let t=(d-1)*6,a=K.trim(),l=s.N.from("items").select("id,title,description,place,tags,item_categories!inner(category_id)",{count:"exact"}).eq("item_categories.category_id",r);if(a){let e=a.replace(/[%_]/g,"\\$&"),t="%".concat(e,"%");l=l.or("title.ilike.".concat(t,",description.ilike.").concat(t,",place.ilike.").concat(t,",tags_text.ilike.").concat(t))}let{data:i,error:o,count:c}=await l.order("created_at",{ascending:!1}).range(t,t+6-1).returns();e===F.current&&(C(!1),o||(n((null!=i?i:[]).map(e=>{var t,r;return{id:e.id,title:e.title,description:e.description,place:null!=(t=e.place)?t:null,tags:null!=(r=e.tags)?r:[]}})),p(c||0)))},[r,d,K]);(0,l.useEffect)(()=>{H()},[H]);let $=(0,l.useCallback)(async e=>{var t,r,a,l;let{data:i}=await s.N.auth.getUser(),n=null==(t=i.user)?void 0:t.id;if(!n)return;let o="".concat(n,"/").concat(e),{data:c,error:d}=await s.N.storage.from("item-images").list(o,{limit:48,sortBy:{column:"created_at",order:"desc"}});if(d)return;if(!(null==c?void 0:c.length))return void N(t=>({...t,[e]:[]}));let u=new Map;for(let e of c){let t=e.name,a=t.endsWith(".thumb.webp")?t.replace(/\.thumb\.webp$/,""):t.replace(/\.webp$/,""),l=null!=(r=u.get(a))?r:{};t.endsWith(".thumb.webp")?l.thumb={name:t}:(t.endsWith(".webp"),l.full={name:t}),u.set(a,l)}let m=[];for(let[,{full:e,thumb:t}]of u){let r,i;if(!e)continue;let n="".concat(o,"/").concat(e.name),{data:c}=await s.N.storage.from("item-images").createSignedUrl(n,3600),d=null!=(a=null==c?void 0:c.signedUrl)?a:"";if(t){r="".concat(o,"/").concat(t.name);let{data:e}=await s.N.storage.from("item-images").createSignedUrl(r,3600);i=null!=(l=null==e?void 0:e.signedUrl)?l:void 0}m.push({pathFull:n,urlFull:d,pathThumb:r,urlThumb:i})}N(t=>({...t,[e]:m}))},[]),Q=(0,l.useCallback)(async e=>{await Promise.all(e.map(e=>$(e)))},[$]);(0,l.useEffect)(()=>{i.length&&h&&Q(i.map(e=>e.id))},[i,h,Q]);let X=(0,l.useCallback)(async e=>{confirm(S("item_list.confirm_delete"))&&(await s.N.from("items").delete().eq("id",e),await H())},[H,S]),G=(0,l.useCallback)(async(e,t)=>{try{var r;f(e);let{data:a}=await s.N.auth.getUser(),l=null==(r=a.user)?void 0:r.id;if(!l)throw Error(S("item_list.no_user_session"));let i=await (0,v.A)(t,{maxWidthOrHeight:1e3,initialQuality:.8,fileType:"image/webp",useWebWorker:!0}),n=await (0,v.A)(t,{maxWidthOrHeight:250,initialQuality:.75,fileType:"image/webp",useWebWorker:!0}),o=crypto.randomUUID(),c="".concat(l,"/").concat(e,"/").concat(o),d=await s.N.storage.from("item-images").upload("".concat(c,".webp"),i);if(d.error)throw d.error;let u=await s.N.storage.from("item-images").upload("".concat(c,".thumb.webp"),n);u.error&&console.warn("Thumbnail upload failed:",u.error),await $(e)}catch(e){alert(e instanceof Error?e.message:String(e))}finally{f(null)}},[$,S]),J=(0,l.useCallback)(async(e,t)=>{if(confirm(S("item_list.confirm_delete")))try{D(t.pathFull);let r=[t.pathFull,...t.pathThumb?[t.pathThumb]:[]],{error:a}=await s.N.storage.from("item-images").remove(r);if(a)return void alert(a.message);N(r=>({...r,[e]:(r[e]||[]).filter(e=>e.pathFull!==t.pathFull)})),E===t.urlFull&&A(null)}finally{D(null)}},[S,E]),V=(0,l.useMemo)(()=>Math.ceil(m/6),[m]),Y=async e=>{if(z&&!T){L(!0);try{let t={title:e.title.trim(),description:e.description.trim()||null,place:e.place.trim()||null,tags:e.tags},{error:r}=await s.N.from("items").update(t).eq("id",z.id);if(r)return void alert(r.message);n(e=>e.map(e=>e.id===z.id?{...e,...t}:e)),P(!1),R(null),U(e=>({...e,[z.id]:!1}))}finally{L(!1)}}},Z=e=>U(t=>({...t,[e]:!1}));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{value:O,onChange:e=>B(e.target.value),placeholder:S("item_list.search_placeholder"),className:"w-full rounded-xl border bg-background px-3 py-2 shadow-sm"}),(0,a.jsx)("ul",{className:"grid sm:grid-cols-2 lg:grid-cols-2 gap-3",children:i.map(e=>{var t,r,l;let s=!!I[e.id];return(0,a.jsxs)("li",{className:"group relative rounded-2xl border bg-card/70 dark:bg-card/60 bg-neutral-100/50 dark:bg-neutral-800/50 backdrop-blur p-3 shadow-sm space-y-3",children:[(0,a.jsx)("div",{className:"font-medium pr-16 truncate",children:e.title}),(0,a.jsx)("button",{className:"absolute top-3 right-3 sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-muted text-foreground shadow ".concat(s?"hidden":""),onClick:()=>{let t;return t=e.id,U(e=>({...e,[t]:!e[t]}))},"aria-label":null!=(r=S("item_list.more_actions"))?r:"More actions",children:(0,a.jsx)(c.In,{icon:c.AT.More,className:"w-5 h-5",fill:"currentColor","aria-hidden":"true"})}),(0,a.jsxs)("div",{className:["absolute top-3 right-3 flex items-center gap-2 transition-opacity",s?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none","sm:opacity-0 sm:pointer-events-none sm:group-hover:opacity-100 sm:group-hover:pointer-events-auto"].join(" "),children:[(0,a.jsx)("button",{className:"sm:hidden w-9 h-9 flex items-center justify-center rounded-xl bg-card border text-foreground shadow",onClick:()=>Z(e.id),"aria-label":null!=(l=S("common.close"))?l:"Close",children:(0,a.jsx)(c.In,{icon:c.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none","aria-hidden":"true"})}),(0,a.jsxs)("label",{className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 transition cursor-pointer",title:S("item_list.add_image"),children:[(0,a.jsx)("input",{type:"file",accept:"image/*",className:"hidden",disabled:!h||x===e.id,onChange:t=>{var r;let a=null==(r=t.target.files)?void 0:r[0];a&&(G(e.id,a),Z(e.id))}}),x===e.id?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-primary-foreground/40 border-t-primary-foreground rounded-full animate-spin"}):(0,a.jsx)(c.In,{icon:c.AT.Add,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,a.jsx)("button",{onClick:()=>{var t,r;R({id:e.id,values:{title:e.title,description:null!=(t=e.description)?t:"",place:null!=(r=e.place)?r:"",tags:Array.isArray(e.tags)?e.tags:[]}}),P(!0),Z(e.id)},className:"w-9 h-9 rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 flex items-center justify-center",title:S("item_list.edit"),children:(0,a.jsx)(c.In,{icon:c.AT.Edit,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})}),(0,a.jsx)("button",{onClick:()=>{X(e.id),Z(e.id)},className:"w-9 h-9 rounded-xl bg-red-500 text-white shadow-sm hover:bg-red-600 flex items-center justify-center",title:S("item_list.delete"),children:(0,a.jsx)(c.In,{icon:c.AT.Trash,className:"w-5 h-5","aria-hidden":"true",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round"})})]}),e.description&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground line-clamp-3",children:e.description}),e.place&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(c.In,{icon:c.AT.Pin,className:"w-4 h-4 shrink-0 opacity-80","aria-hidden":"true"}),(0,a.jsx)("span",{className:"truncate",children:e.place})]}),Array.isArray(e.tags)&&e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e.tags.map(e=>(0,a.jsx)("span",{className:"inline-flex items-center gap-1 bg-primary/10 dark:bg-primary/20 text-primary rounded-full px-2 py-0.5 text-xs",children:e},e))}),(null==(t=w[e.id])?void 0:t.length)?(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:w[e.id].map(t=>(0,a.jsxs)("div",{className:"relative group",onClick:()=>A(t.urlFull),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&A(t.urlFull)},children:[(0,a.jsx)(j.default,{src:t.urlThumb||t.urlFull,alt:S("item_list.image_alt").replace("{idx}",""),width:160,height:160,unoptimized:!0,className:"h-20 w-full object-cover rounded-xl cursor-pointer"}),(0,a.jsx)("button",{title:S("item_list.delete"),onClick:r=>{r.stopPropagation(),J(e.id,t)},disabled:W===t.pathFull||x===e.id,className:[s?"opacity-100":"opacity-0","sm:opacity-0 sm:group-hover:opacity-100 absolute top-1 right-1 w-7 h-7 flex items-center justify-center rounded-lg bg-red-600 text-white shadow disabled:opacity-60 transition"].join(" "),children:W===t.pathFull?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white/40 border-t-white rounded-full animate-spin"}):(0,a.jsx)(c.In,{icon:c.AT.Trash,className:"w-4 h-4",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]},t.pathFull))}):(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:_?S("item_list.loading"):S("item_list.no_images")})]},e.id)})}),V>1&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 items-center justify-center",children:[(0,a.jsx)("button",{disabled:1===d,onClick:()=>u(e=>e-1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:S("item_list.previous"),children:(0,a.jsx)(c.In,{icon:c.AT.ChevronLeft,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})}),Array.from({length:V},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>u(e),className:"min-w-9 h-9 px-2 flex items-center justify-center rounded-xl shadow-sm "+(e===d?"bg-primary text-primary-foreground":"bg-primary/60 text-primary-foreground hover:bg-primary"),children:e},e)),(0,a.jsx)("button",{disabled:d===V,onClick:()=>u(e=>e+1),className:"w-9 h-9 flex items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-sm hover:brightness-110 disabled:opacity-50",title:S("item_list.next"),children:(0,a.jsx)(c.In,{icon:c.AT.ChevronRight,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]}),E&&"undefined"!=typeof document&&b.createPortal((0,a.jsxs)("div",{className:"fixed inset-0 z-500 flex flex-col items-center justify-center bg-background/90 backdrop-blur",onClick:()=>A(null),children:[(0,a.jsx)(j.default,{src:E,alt:S("item_list.full_size_image_alt"),unoptimized:!0,width:0,height:0,sizes:"100vw",className:"w-auto h-auto max-w-full max-h-full object-contain rounded-xl shadow-lg"}),(0,a.jsx)("button",{className:"mt-4 w-10 h-10 flex items-center justify-center rounded-xl bg-card text-card-foreground hover:bg-card/80 transition",title:S("item_list.close_modal"),children:(0,a.jsx)(c.In,{icon:c.AT.Close,className:"w-5 h-5",stroke:"currentColor",strokeWidth:"2",fill:"none"})})]}),document.body),(0,a.jsx)(k,{open:M,onOpenChange:e=>{P(e),e||R(null)},title:S("item_list.edit_item"),closeLabel:"X",children:(0,a.jsx)("section",{className:"relative z-50",children:(0,a.jsx)(y,{initial:null!=(t=null==z?void 0:z.values)?t:{title:"",description:"",place:"",tags:[]},submitLabel:S("common.save"),submitting:T,onSubmit:Y,onCancel:()=>{P(!1),R(null)},showIconSubmit:!0},null==z?void 0:z.id)})})]})}function _(e){let{user:t,onSignOut:r}=e,[s,i]=(0,l.useState)(!1),{t:n}=(0,o.s)();return(0,a.jsx)("header",{className:"sticky top-0 z-400 backdrop-blur supports-[backdrop-filter]:bg-white/40 dark:supports-[backdrop-filter]:bg-neutral-900/70 border-b border-black/5 dark:border-white/10",children:(0,a.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.default,{src:(e=>{let t=e.startsWith("/")?e:"/".concat(e);return"".concat("/CollectionBuddy").concat(t)})("/logo.png"),alt:n("header.title"),width:28,height:28,className:"object-contain",priority:!0}),(0,a.jsx)("span",{className:"font-semibold tracking-tight",children:n("header.title")})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>i(e=>!e),className:"group flex items-center gap-2 rounded-xl px-2.5 py-1.5 bg-white/70 dark:bg-neutral-900/60 border border-black/10 dark:border-white/10 shadow-sm hover:shadow transition",children:[(0,a.jsx)(c.Ay,{icon:c.AT.Google,className:"w-5 h-5"}),(0,a.jsx)("span",{className:"text-sm opacity-80 max-sm:hidden",children:t.email}),(0,a.jsx)("span",{className:"text-xs opacity-60 group-hover:opacity-100",children:"â–¾"})]}),s&&(0,a.jsxs)("div",{role:"menu",className:"absolute right-0 mt-2 w-56 rounded-xl border border-black/10 dark:border-white/10 bg-white/90 dark:bg-neutral-900/90 backdrop-blur p-1 shadow-lg",children:[(0,a.jsx)("div",{className:"px-3 py-2 text-xs opacity-70 truncate",children:t.email}),(0,a.jsx)("button",{onClick:r,className:"w-full text-left px-3 py-2 rounded-lg hover:bg-stone-100 dark:hover:bg-neutral-800 text-sm",children:n("header.sign_out")})]})]})]})})}function C(){let{user:e,loading:t}=function(){let e=(0,i.useRouter)(),[t,r]=(0,l.useState)(null),[a,n]=(0,l.useState)(!0);return(0,l.useEffect)(()=>{let e=!0,t=t=>{var a;e&&(r(null!=(a=null==t?void 0:t.user)?a:null),n(!1))};(async()=>{try{let{data:e,error:r}=await s.N.auth.getSession();r?(console.error("Error fetching session:",r.message),t(null)):t(e.session)}catch(e){console.error("Unexpected error fetching session:",e),t(null)}})();let{data:a}=s.N.auth.onAuthStateChange((e,r)=>t(r));return()=>{e=!1,a.subscription.unsubscribe()}},[]),(0,l.useEffect)(()=>{a||t||(console.warn("Session invalid or expired. Redirecting to login."),e.replace("/login"))},[t,a,e]),{user:t,loading:a}}(),[r,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(0),{t:m}=(0,o.s)(),p=(0,i.useRouter)(),[h,g]=function(e,t){let[r,a]=(0,l.useState)(t);return(0,l.useEffect)(()=>{try{let t=localStorage.getItem(e);"1"===t&&a(!0),"0"===t&&a(!1)}catch(e){}},[e]),(0,l.useEffect)(()=>{try{localStorage.setItem(e,r?"1":"0")}catch(e){}},[e,r]),[r,a]}((0,l.useMemo)(()=>r?"cb_open_".concat(r):"cb_open_none",[r]),!1),x=(0,l.useCallback)(async()=>{try{let{error:e}=await s.N.auth.signOut({scope:"local"});e&&console.error("Sign-out failed:",e.message),setTimeout(()=>p.replace("/login"),100)}catch(e){console.error("Unexpected error during sign-out:",e),p.replace("/login")}},[p]),b=(0,l.useCallback)(()=>{g(!1),u(e=>e+1)},[g]);return t?(0,a.jsx)(n.A,{}):e?(0,a.jsxs)("div",{className:"min-h-[100dvh] bg-gradient-to-b from-amber-50 via-white to-stone-50 dark:from-neutral-950 dark:via-neutral-950 dark:to-neutral-900 text-neutral-900 dark:text-neutral-100",children:[(0,a.jsx)(_,{user:e,onSignOut:x}),(0,a.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-6 sm:py-8 space-y-6",children:[(0,a.jsx)(f,{selectedCat:r,onSelect:c}),r?(0,a.jsxs)("section",{className:"relative z-50 rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-4 sm:p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-base font-semibold",children:m("page.entries")}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"rounded-xl px-3 py-1.5 bg-primary text-primary-foreground shadow-sm hover:brightness-110",children:"+"})]}),(0,a.jsx)(N,{categoryId:r},d)]}):(0,a.jsx)("section",{className:"rounded-2xl border bg-white/70 dark:bg-neutral-900/60 backdrop-blur shadow-sm p-10 grid place-items-center text-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)("div",{className:"h-16 w-16 rounded-full bg-amber-500/90 ring-8 ring-amber-200/40 dark:ring-amber-900/20 grid place-items-center text-3xl",children:"\uD83E\uDDFA"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:m("page.choose_category")}),(0,a.jsx)("p",{className:"text-sm opacity-70",children:m("page.add_collectibles")})]})]})})]}),r&&(0,a.jsx)(k,{open:h,onOpenChange:g,title:m("item_create.new_entry"),closeLabel:"X",children:(0,a.jsx)(w,{categoryId:r,onCreated:b})}),(0,a.jsx)("footer",{className:"px-4 py-8 text-center text-xs opacity-60",children:m("page.footer")})]}):null}},6707:(e,t,r)=>{Promise.resolve().then(r.bind(r,6601))}},e=>{e.O(0,[192,145,602,441,964,358],()=>e(e.s=6707)),_N_E=e.O()}]);